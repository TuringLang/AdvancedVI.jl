<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Scaling to Large Datasets · AdvancedVI.jl</title><meta name="title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta property="og:title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta property="twitter:title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta name="description" content="Documentation for AdvancedVI.jl."/><meta property="og:description" content="Documentation for AdvancedVI.jl."/><meta property="twitter:description" content="Documentation for AdvancedVI.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body>
<!-- NAVBAR START -->
<style>
    @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap');

    /* Documenter.jl CSS Overrides */
    html {
        scroll-padding-top: calc(var(--navbar-height) + 1rem);
    }
    .docs-sidebar, #documenter {
        margin-top: var(--navbar-height);
    }
    .docs-version-selector {
        margin-bottom: 60px !important;
    }
    @media screen and (max-width: 1056px) {
        .docs-version-selector {
            margin-bottom: 60px !important;
        }
        .docs-sidebar {
            margin-top: 0 !important;
        }
    }
    /* End of Documenter.jl Tweaks */

    /* Color and Font Variables */
    :root {
        --heading-color: #6c757d;
        --item-color: rgb(165, 165, 165);
        --primary-bg: white;
        --hover-color: #8faad2;
        --deprecated-bg: #ff4d4d;
        --deprecated-text: white;
        --icon-color: #6c757d;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e9ecef;
        
        /* Typography */
        --font-family: "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        --nav-link-font-size: 1.0625rem;
        --turing-title-font-size: 21.25px;
        --icon-font-size: 1.25rem;
        --dropdown-arrow-font-size: 0.6875rem;
        --badge-font-size: 0.75rem;

        /* Sizing and Spacing */
        --navbar-height: 3.75rem;
        --logo-height: 31px;
        --logo-width: auto;
        --logo-padding-top: 7px;
        --logo-margin-left: 0.8rem;
        --title-margin-left: 0.4px;
        --title-nav-spacing: 1.1rem;
        --nav-item-margin-left: 1.3rem;
        --icon-margin-left: 1rem;
        --dropdown-padding: 1.875rem;
        --dropdown-item-width: 12.5rem;
        --dropdown-subitem-width: 15.625rem;
        --dropdown-subitem-padding: 0.125rem 0.625rem;
    }

    /* Dark Theme Variable Overrides */
    html.theme--documenter-dark {
        --heading-color: #e0e0e0;
        --item-color: #bdbdbd;
        --primary-bg: #1f2424;
        --hover-color: #ffffff;
        --icon-color: #e0e0e0;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #424242;
    }

    /* Catppuccin Theme Overrides */
    html.theme--catppuccin-latte {
        --heading-color: #4c4f69;
        --primary-bg: #eff1f5;
        --icon-color: #4c4f69;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e6e9ef;
    }
    html.theme--catppuccin-frappe {
        --heading-color: #c6d0f5;
        --primary-bg: #303446;
        --icon-color: #c6d0f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #51576d;
    }
    html.theme--catppuccin-macchiato {
        --heading-color: #cad3f5;
        --primary-bg: #24273a;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #494d64;
    }
    html.theme--catppuccin-mocha {
        --heading-color: #cad3f5;
        --primary-bg: #1e1e2e;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #45475a;
    }


    /* Main Navigation Bar */
    .ext-navigation {
        font-family: var(--font-family);
        position: fixed;
        height: var(--navbar-height);
        top: 0;
        width: 100%;
        background-color: var(--primary-bg);
        z-index: 1000;
        box-shadow: 0 2px 4px var(--shadow-color);
        display: flex;
        align-items: center;
        padding: 0 1.0625rem;
        transition: transform 0.3s, background-color 0.3s;
    }

    nav.ext-navigation .ext-navbar-logo {
        margin-left: var(--logo-margin-left);
        height: auto;
        max-height: var(--logo-height);
        width: auto;
        padding-top: var(--logo-padding-top);
    }
    
    /* Theme-aware logo text color */
    .ext-navbar-logo .logo-text {
        fill: var(--heading-color);
    }
    
    .ext-navbar-title {
        color: var(--heading-color) !important;
        font-size: var(--turing-title-font-size) !important;
        margin-left: var(--title-margin-left);
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .ext-navbar-title:hover {
        color: var(--hover-color) !important;
    }

    .ext-nav-links {
        display: flex;
        align-items: center;
        list-style-type: none;
        margin: 0;
        padding: 0;
        flex-grow: 1;
        margin-left: var(--title-nav-spacing);
    }

    .ext-nav-links li:first-child {
        margin-left: 0 !important;
    }

    .ext-nav-links li {
        margin-left: var(--nav-item-margin-left) !important;
    }

    .ext-nav-link {
        color: var(--heading-color) !important;
        text-decoration: none;
        font-size: var(--nav-link-font-size) !important;
        transition: color 0.2s ease;
        cursor: pointer;
    }

    .ext-nav-link:hover,
    .ext-navbar-item-single a:hover,
    .ext-navbar-icons a:hover {
        color: var(--hover-color) !important;
    }

    .ext-navbar-item-single a {
        color: var(--heading-color) !important;
    }
    
    .ext-navbar-icons {
        display: flex;
        align-items: center;
    }

    .ext-navbar-icons a {
        color: var(--icon-color) !important;
        font-size: var(--icon-font-size) !important;
        transition: color 0.2s ease;
        margin-left: var(--icon-margin-left);
    }

    .ext-menu-toggle {
        display: none;
        font-size: 1.5rem;
        color: var(--heading-color);
        cursor: pointer;
    }

    .ext-dropdown {
        display: none;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        padding: var(--dropdown-padding);
        position: absolute;
        top: var(--navbar-height);
        width: 100%;
        left: 0;
        background-color: var(--primary-bg);
        line-height: 1.875rem;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s;
        transform: translateY(-0.625rem);
        box-shadow: 0 4px 6px var(--shadow-color);
    }

    #library-handler::after {
        content: "▼";
        font-size: var(--dropdown-arrow-font-size);
        margin-left: 0.3125rem;
        transition: transform 0.3s ease-in-out;
    }

    #library-handler.open::after {
        content: "▲";
    }

    .ext-dropdown.show {
        display: grid;
        opacity: 1;
        transform: translateY(0);
    }

    .ext-dropdown ul {
        width: var(--dropdown-item-width);
        margin-bottom: 1.25rem;
    }

    .ext-dropdown ul li {
        text-align: left;
        display: flex;
        align-items: center;
    }

    .ext-dropdown ul a li {
        color: var(--item-color);
        width: var(--dropdown-subitem-width);
        border-radius: 3px;
        padding: var(--dropdown-subitem-padding);
        transition: background-color 0.2s ease;
    }

    .ext-dropdown ul a li:hover {
        background-color: var(--dropdown-hover-bg);
    }

    .ext-dropdown-item-heading {
        color: var(--heading-color);
        text-align: center;
    }

    .deprecated-badge {
        background-color: var(--deprecated-bg);
        color: var(--deprecated-text);
        font-size: var(--badge-font-size);
        padding: .1rem;
        border-radius: 3px;
        margin-left: 0.5rem;
        line-height: 1;
    }

    @media (max-width: 966px) {
        .ext-dropdown {
            grid-template-columns: 1fr 1fr 1fr;
        }
    }

    @media (max-width: 768px) {
        .ext-nav-links {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            background-color: var(--primary-bg);
            position: absolute;
            top: var(--navbar-height);
            left: 0;
            padding: 0.625rem 0;
            height: auto;
            overflow-y: auto;
            box-shadow: 0 4px 6px var(--shadow-color);
            margin-left: 0;
        }

        .ext-nav-links.show {
            display: flex;
        }

        .ext-nav-links li {
            margin: 0.625rem 0 !important;
            text-align: center;
        }
        
        .ext-menu-toggle {
            display: block;
            margin-left: auto;
        }

        .ext-navigation.hide {
            transform: translateY(calc(-1 * var(--navbar-height)));
        }

        .ext-dropdown {
            position: static;
            display: block;
            opacity: 1;
            transform: none;
            box-shadow: none;
            grid-template-columns: 1fr;
            padding: 0.625rem;
            text-align: center;
        }

        .ext-dropdown ul {
            width: auto;
            display: inline-block;
            margin: 0 auto 0.3125rem;
            text-align: left;
        }
    }
</style>
<nav class="ext-navigation">
    <a href="https://turinglang.org/">
        <svg width="4333" height="1145" viewBox="0 0 4333 1145" fill="none" xmlns="http://www.w3.org/2000/svg" class="ext-navbar-logo">
            <path class="logo-text" d="M0.44603 193.181V66.9868H663.471V193.181H406.62V898H257.297V193.181H0.44603ZM1097.24 635.874V274.74H1244.13V898H1101.7V787.225H1095.21C1081.14 822.121 1058.01 850.66 1025.82 872.842C993.902 895.024 954.542 906.115 907.744 906.115C866.896 906.115 830.783 897.053 799.403 878.929C768.295 860.534 743.948 833.889 726.365 798.993C708.782 763.826 699.99 721.356 699.99 671.581V274.74H846.878V648.858C846.878 688.353 857.699 719.733 879.34 742.997C900.981 766.261 929.385 777.893 964.551 777.893C986.192 777.893 1007.16 772.618 1027.45 762.068C1047.73 751.518 1064.37 735.828 1077.35 714.999C1090.61 693.899 1097.24 667.524 1097.24 635.874ZM1395.17 898V274.74H1537.6V378.617H1544.09C1555.45 342.639 1574.93 314.911 1602.52 295.434C1630.38 275.687 1662.17 265.813 1697.88 265.813C1705.99 265.813 1715.05 266.219 1725.06 267.031C1735.34 267.572 1743.86 268.518 1750.63 269.871V404.992C1744.4 402.828 1734.53 400.934 1721 399.311C1707.75 397.417 1694.9 396.471 1682.46 396.471C1655.68 396.471 1631.6 402.287 1610.23 413.919C1589.13 425.28 1572.49 441.105 1560.32 461.393C1548.15 481.682 1542.06 505.081 1542.06 531.591V898H1395.17ZM1848.21 898V274.74H1995.1V898H1848.21ZM1922.06 186.283C1898.8 186.283 1878.78 178.573 1862.01 163.154C1845.24 147.464 1836.85 128.664 1836.85 106.752C1836.85 84.5701 1845.24 65.7695 1862.01 50.3503C1878.78 34.6606 1898.8 26.8158 1922.06 26.8158C1945.6 26.8158 1965.61 34.6606 1982.12 50.3503C1998.89 65.7695 2007.27 84.5701 2007.27 106.752C2007.27 128.664 1998.89 147.464 1982.12 163.154C1965.61 178.573 1945.6 186.283 1922.06 186.283ZM2293.04 532.809V898H2146.15V274.74H2286.54V380.646H2293.85C2308.18 345.75 2331.04 318.022 2362.42 297.463C2394.07 276.904 2433.16 266.625 2479.69 266.625C2522.7 266.625 2560.17 275.822 2592.09 294.217C2624.28 312.612 2649.17 339.257 2666.75 374.153C2684.6 409.049 2693.39 451.385 2693.12 501.159V898H2546.24V523.882C2546.24 482.223 2535.41 449.626 2513.77 426.092C2492.4 402.557 2462.78 390.79 2424.91 390.79C2399.21 390.79 2376.35 396.471 2356.34 407.832C2336.59 418.923 2321.03 435.019 2309.67 456.119C2298.58 477.218 2293.04 502.782 2293.04 532.809ZM3113.5 1144.71C3060.75 1144.71 3015.44 1137.54 2977.57 1123.2C2939.7 1109.13 2909.26 1090.2 2886.27 1066.39C2863.28 1042.59 2847.32 1016.21 2838.39 987.269L2970.67 955.213C2976.62 967.386 2985.28 979.424 2996.64 991.327C3008 1003.5 3023.28 1013.51 3042.49 1021.35C3061.97 1029.47 3086.45 1033.53 3115.93 1033.53C3157.59 1033.53 3192.08 1023.38 3219.4 1003.09C3246.73 983.076 3260.39 950.074 3260.39 904.087V786.008H3253.08C3245.51 801.157 3234.42 816.711 3219.81 832.671C3205.47 848.632 3186.4 862.022 3162.6 872.842C3139.06 883.663 3109.44 889.073 3073.73 889.073C3025.85 889.073 2982.44 877.847 2943.48 855.394C2904.8 832.671 2873.96 798.857 2850.97 753.952C2828.24 708.777 2816.88 652.24 2816.88 584.341C2816.88 515.902 2828.24 458.147 2850.97 411.078C2873.96 363.739 2904.93 327.896 2943.89 303.55C2982.84 278.933 3026.26 266.625 3074.14 266.625C3110.66 266.625 3140.69 272.847 3164.22 285.29C3188.03 297.463 3206.96 312.206 3221.03 329.519C3235.09 346.561 3245.78 362.657 3253.08 377.805H3261.2V274.74H3406.06V908.144C3406.06 961.435 3393.34 1005.53 3367.92 1040.42C3342.49 1075.32 3307.73 1101.43 3263.63 1118.74C3219.54 1136.05 3169.5 1144.71 3113.5 1144.71ZM3114.72 773.835C3145.83 773.835 3172.34 766.261 3194.25 751.112C3216.16 735.963 3232.79 714.187 3244.16 685.783C3255.52 657.379 3261.2 623.295 3261.2 583.53C3261.2 544.305 3255.52 509.95 3244.16 480.465C3233.07 450.979 3216.56 428.12 3194.65 411.89C3173.01 395.389 3146.37 387.138 3114.72 387.138C3081.98 387.138 3054.66 395.659 3032.75 412.701C3010.84 429.744 2994.34 453.143 2983.25 482.899C2972.16 512.385 2966.61 545.929 2966.61 583.53C2966.61 621.672 2972.16 655.08 2983.25 683.754C2994.61 712.158 3011.25 734.34 3033.16 750.3C3055.34 765.99 3082.53 773.835 3114.72 773.835ZM3647.08 906.927C3622.47 906.927 3601.37 898.271 3583.78 880.958C3566.2 863.645 3557.54 842.545 3557.82 817.658C3557.54 793.312 3566.2 772.482 3583.78 755.17C3601.37 737.857 3622.47 729.2 3647.08 729.2C3670.89 729.2 3691.58 737.857 3709.17 755.17C3727.02 772.482 3736.08 793.312 3736.35 817.658C3736.08 834.159 3731.75 849.173 3723.37 862.698C3715.25 876.224 3704.43 887.044 3690.91 895.16C3677.65 903.004 3663.04 906.927 3647.08 906.927ZM3888.01 274.74H4034.9V933.708C4034.9 978.613 4026.38 1015.67 4009.33 1044.89C3992.29 1074.1 3967.67 1095.88 3935.48 1110.22C3903.29 1124.55 3864.2 1131.72 3818.22 1131.72C3812.81 1131.72 3807.8 1131.59 3803.2 1131.32C3798.6 1131.32 3793.6 1131.18 3788.19 1130.91V1011.21C3792.25 1011.48 3795.9 1011.62 3799.15 1011.62C3802.39 1011.89 3805.77 1012.02 3809.29 1012.02C3837.42 1012.02 3857.58 1005.12 3869.75 991.327C3881.92 977.801 3888.01 957.918 3888.01 931.679V274.74ZM3961.05 186.283C3937.51 186.283 3917.36 178.573 3900.59 163.154C3884.09 147.464 3875.84 128.664 3875.84 106.752C3875.84 84.5701 3884.09 65.7695 3900.59 50.3503C3917.36 34.6606 3937.51 26.8158 3961.05 26.8158C3984.31 26.8158 4004.19 34.6606 4020.7 50.3503C4037.47 65.7695 4045.85 84.5701 4045.85 106.752C4045.85 128.664 4037.47 147.464 4020.7 163.154C4004.19 178.573 3984.31 186.283 3961.05 186.283ZM4332.83 66.9868V898H4185.94V66.9868H4332.83Z" fill="currentColor"/>
            <path d="M4076 108.5C4076 168.424 4027.42 217 3967.5 217C3907.58 217 3859 168.424 3859 108.5C3859 48.5762 3907.58 0 3967.5 0C4027.42 0 4076 48.5762 4076 108.5Z" fill="#389725"/>
            <path d="M3755 814.5C3755 874.424 3706.42 923 3646.5 923C3586.58 923 3538 874.424 3538 814.5C3538 754.576 3586.58 706 3646.5 706C3706.42 706 3755 754.576 3755 814.5Z" fill="#9457B1"/>
            <path d="M2030 108.5C2030 168.424 1981.42 217 1921.5 217C1861.58 217 1813 168.424 1813 108.5C1813 48.5762 1861.58 0 1921.5 0C1981.42 0 2030 48.5762 2030 108.5Z" fill="#CA3B33"/>
        </svg>
    </a>
    <!-- <a class="ext-navbar-title" href="https://turinglang.org/">Turing.jl</a> -->
    
    <ul class="ext-nav-links">
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/getting-started/">Get Started</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/tutorials/">Tutorials</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/faq/">FAQ</a></li>
        <li>
            <p class="ext-nav-link" id="library-handler">Libraries</p>
            <div class="ext-dropdown" id="ext-dropdown-items">
                <ul>
                    <li class="ext-dropdown-item-heading">Modelling Languages</li>
                    <a href="https://turinglang.org/DynamicPPL.jl/"><li>DynamicPPL</li></a>
                    <a href="https://turinglang.org/JuliaBUGS.jl/"><li>JuliaBUGS</li></a>
                    <a href="https://turinglang.org/TuringGLM.jl/"><li>TuringGLM</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">MCMC</li>
                    <a href="https://turinglang.org/AdvancedHMC.jl/"><li>AdvancedHMC</li></a>
                    <a href="https://turinglang.org/AbstractMCMC.jl/"><li>AbstractMCMC</li></a>
                    <a href="https://github.com/theogf/ThermodynamicIntegration.jl"><li>ThermodynamicIntegration</li></a>
                    <a href="https://turinglang.org/AdvancedPS.jl/"><li>AdvancedPS</li></a>
                    <a href="https://turinglang.org/SliceSampling.jl/"><li>SliceSampling</li></a>
                    <a href="https://turinglang.org/EllipticalSliceSampling.jl/"><li>EllipticalSliceSampling</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Diagnostics</li>
                    <a href="https://turinglang.org/MCMCChains.jl/"><li>MCMCChains</li></a>
                    <a href="https://turinglang.org/MCMCDiagnosticTools.jl/"><li>MCMCDiagnosticTools</li></a>
                    <a href="https://turinglang.org/ParetoSmooth.jl/"><li>ParetoSmooth</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Gaussian Processes</li>
                    <a href="https://juliagaussianprocesses.github.io/AbstractGPs.jl/"><li>AbstractGPs</li></a>
                    <a href="https://juliagaussianprocesses.github.io/KernelFunctions.jl/"><li>KernelFunctions</li></a>
                    <a href="https://juliagaussianprocesses.github.io/ApproximateGPs.jl/"><li>ApproximateGPs</li></a>
                </ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Bijectors.jl/">Bijectors</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/TuringCallbacks.jl/">TuringCallbacks</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Deprecated/TuringBenchmarking/">TuringBenchmarking</a><span class="deprecated-badge">Deprecated</span></li></ul>
            </div>
        </li>
        <li><a class="ext-nav-link" href="https://turinglang.org/news/">News</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/team/">Team</a></li>
    </ul>

    <div class="ext-navbar-icons">
        <a href="https://x.com/TuringLang" aria-label="Turing on X"><i class="fa-brands fa-x-twitter"></i></a>
        <a href="https://discourse.julialang.org/c/domain/probprog/48" aria-label="Turing on Discourse"><i class="fa-brands fa-discourse"></i></a>
        <a href="https://julialang.slack.com/archives/CCYDC34A0" aria-label="Turing on Slack"><i class="fa-brands fa-slack"></i></a>
        <a href="https://github.com/TuringLang/" aria-label="Turing.jl on GitHub"><i class="fa-brands fa-github"></i></a>
    </div>

    <span class="ext-menu-toggle"><i class="fa-solid fa-bars"></i></span>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const menuToggle = document.querySelector(".ext-menu-toggle");
        const navLinks = document.querySelector(".ext-nav-links");
        const nav = document.querySelector(".ext-navigation");
        const libraryHandler = document.getElementById("library-handler");
        const dropdownContainer = document.getElementById("ext-dropdown-items");
        let lastScrollY = window.scrollY;

        function closeDropdown() {
            if (dropdownContainer.classList.contains("show")) {
                libraryHandler.classList.remove("open");
                dropdownContainer.classList.remove("show");
                setTimeout(() => {
                    if (!dropdownContainer.classList.contains("show")) {
                        dropdownContainer.style.display = "none";
                    }
                }, 300);
            }
        }

        function openDropdown() {
            dropdownContainer.style.display = "grid";
            libraryHandler.classList.add("open");
            setTimeout(() => {
                dropdownContainer.classList.add("show");
            }, 10);
        }

        function setAppropriateHeight() {
            if (window.innerWidth <= 768) {
                const viewportHeight = window.innerHeight;
                const navHeight = nav.offsetHeight;
                navLinks.style.maxHeight = `${viewportHeight - navHeight}px`;
                navLinks.style.overflowY = "auto";
            } else {
                navLinks.style.maxHeight = "";
                navLinks.style.overflowY = "";
            }
        }

        menuToggle.addEventListener("click", (event) => {
            event.stopPropagation();
            navLinks.classList.toggle("show");
            if (navLinks.classList.contains("show")) {
                setAppropriateHeight();
                closeDropdown();
                dropdownContainer.style.display = "none";
            }
        });

        libraryHandler.addEventListener("click", (event) => {
            event.stopPropagation();
            event.preventDefault();
            if (dropdownContainer.classList.contains("show")) {
                closeDropdown();
            } else {
                openDropdown();
            }
            setAppropriateHeight();
        });

        // Close all menus if a click is registered outside the navigation bar.
        document.addEventListener("click", (event) => {
            if (!nav.contains(event.target)) {
                navLinks.classList.remove("show");
                closeDropdown();
            }
        });

        // Hide navigation bar on scroll down in mobile view.
        window.addEventListener("scroll", () => {
            if (window.innerWidth <= 768) {
                if (window.scrollY > lastScrollY && window.scrollY > nav.offsetHeight){
                    nav.classList.add("hide");
                } else {
                    nav.classList.remove("hide");
                }
                lastScrollY = window.scrollY;
            }
        });

        window.addEventListener("resize", setAppropriateHeight);
    });
</script>
<!-- NAVBAR END -->


<div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AdvancedVI.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">AdvancedVI</a></li><li><a class="tocitem" href="../../general/">General Usage</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../basic/">Basic Example</a></li><li class="is-active"><a class="tocitem" href>Scaling to Large Datasets</a><ul class="internal"><li><a class="tocitem" href="#Setting-Up-Subsampling"><span>Setting Up Subsampling</span></a></li><li><a class="tocitem" href="#Scalable-Inference-via-AdvancedVI"><span>Scalable Inference via AdvancedVI</span></a></li></ul></li><li><a class="tocitem" href="../stan/">Stan Models</a></li><li><a class="tocitem" href="../flows/">Normalizing Flows</a></li><li><a class="tocitem" href="../constrained/">Dealing with Constrained Posteriors</a></li></ul></li><li><span class="tocitem">Algorithms</span><ul><li><a class="tocitem" href="../../klminrepgraddescent/"><code>KLMinRepGradDescent</code></a></li><li><a class="tocitem" href="../../klminrepgradproxdescent/"><code>KLMinRepGradProxDescent</code></a></li><li><a class="tocitem" href="../../klminscoregraddescent/"><code>KLMinScoreGradDescent</code></a></li><li><a class="tocitem" href="../../klminwassfwdbwd/"><code>KLMinWassFwdBwd</code></a></li><li><a class="tocitem" href="../../klminnaturalgraddescent/"><code>KLMinNaturalGradDescent</code></a></li><li><a class="tocitem" href="../../klminsqrtnaturalgraddescent/"><code>KLMinSqrtNaturalGradDescent</code></a></li><li><a class="tocitem" href="../../fisherminbatchmatch/"><code>FisherMinBatchMatch</code></a></li></ul></li><li><a class="tocitem" href="../../families/">Variational Families</a></li><li><a class="tocitem" href="../../optimization/">Optimization</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Scaling to Large Datasets</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Scaling to Large Datasets</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TuringLang/AdvancedVI.jl/blob/main/docs/src/tutorials/subsampling.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Scaling-to-Large-Datasets-with-Subsampling"><a class="docs-heading-anchor" href="#Scaling-to-Large-Datasets-with-Subsampling">Scaling to Large Datasets with Subsampling</a><a id="Scaling-to-Large-Datasets-with-Subsampling-1"></a><a class="docs-heading-anchor-permalink" href="#Scaling-to-Large-Datasets-with-Subsampling" title="Permalink"></a></h1><p>In this tutorial, we will show how to use <code>AdvancedVI</code> on problems with large datasets. Variational inference (VI) has a long and successful history<sup class="footnote-reference"><a id="citeref-HBWP2013" href="#footnote-HBWP2013" class="footnote-ref">[HBWP2013]</a><span class="footnote-preview" id="fn-HBWP2013"></span></sup><sup class="footnote-reference"><a id="citeref-TL2014" href="#footnote-TL2014" class="footnote-ref">[TL2014]</a><span class="footnote-preview" id="fn-TL2014"></span></sup><sup class="footnote-reference"><a id="citeref-HBB2010" href="#footnote-HBB2010" class="footnote-ref">[HBB2010]</a><span class="footnote-preview" id="fn-HBB2010"></span></sup> in large scale inference using (minibatch) subsampling. In this tutorial, we will see how to perform subsampling with <code>KLMinRepGradProxDescent</code>, which was originally described in the paper by Titsias and Lázaro-Gredilla<sup class="footnote-reference"><a id="citeref-TL2014" href="#footnote-TL2014" class="footnote-ref">[TL2014]</a><span class="footnote-preview" id="fn-TL2014"></span></sup>; Kucukelbir <em>et al</em><sup class="footnote-reference"><a id="citeref-KTRGB2017" href="#footnote-KTRGB2017" class="footnote-ref">[KTRGB2017]</a><span class="footnote-preview" id="fn-KTRGB2017"></span></sup>.</p><h2 id="Setting-Up-Subsampling"><a class="docs-heading-anchor" href="#Setting-Up-Subsampling">Setting Up Subsampling</a><a id="Setting-Up-Subsampling-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-Up-Subsampling" title="Permalink"></a></h2><p>We will consider a typical hierarchical logistic regression example.</p><pre><code class="language-julia hljs">using LogDensityProblems: LogDensityProblems
using Distributions
using FillArrays

struct LogReg{XType,YType}
    X::XType
    y::YType
    n_data::Int
end

function LogDensityProblems.logdensity(model::LogReg, θ)
    (; X, y, n_data) = model
    n, d = size(X)
    β, logσ = θ[1:size(X, 2)], θ[end]
    σ = exp(logσ)

    logprior_β = logpdf(MvNormal(Zeros(d), σ), β)
    logprior_σ = logpdf(Normal(0, 3), σ)

    logit = X*β
    loglike_y = mapreduce((li, yi) -&gt; logpdf(BernoulliLogit(li), yi), +, logit, y)
    return n_data/n*loglike_y + logprior_β + logprior_σ
end

function LogDensityProblems.dimension(model::LogReg)
    return size(prob.X, 2) + 1
end

function LogDensityProblems.capabilities(::Type{&lt;:LogReg})
    return LogDensityProblems.LogDensityOrder{0}()
end
nothing</code></pre><p>Notice that, to use subsampling, we need be able to rescale the likelihood strength. That is, for the gradient of the log-density with a batch of data points of size <code>n</code> to be an unbiased estimate of the gradient using the full dataset of size <code>n_data</code>, we need to scale the likelihood by <code>n_data/n</code>. This part is critical to ensure that the algorithm correctly approximates the posterior with the full dataset.</p><p>For the dataset, we will use one that is larger than that used in the <a href="../basic/#basic">Basic Example</a>. This is to properly assess the advantage of subsampling. In particular, we will utilize the &quot;Phishing&quot; dataset<sup class="footnote-reference"><a id="citeref-Tan2018" href="#footnote-Tan2018" class="footnote-ref">[Tan2018]</a><span class="footnote-preview" id="fn-Tan2018"></span></sup>, which consists of 10000 data points, each with 48 features. The goal is to predict whether the features of a specific website indicate whether it is a phishing website or a legitimate one. The <a href="https://www.openml.org/search?type=data&amp;status=active&amp;id=46722">dataset</a> id on the <a href="https://github.com/JuliaAI/OpenML.jl"><code>OpenML</code></a> repository is 46722.</p><pre><code class="language-julia hljs">using OpenML: OpenML
using DataFrames: DataFrames

data = Array(DataFrames.DataFrame(OpenML.load(46722)))
X = Matrix{Float64}(data[:, 2:end])
y = Vector{Bool}(data[:, end])
nothing</code></pre><p>The features start from the seoncd column, while the last column are the class labels.</p><p>Let&#39;s also apply some basic pre-processing.</p><pre><code class="language-julia hljs">using Statistics

X = (X .- mean(X; dims=2)) ./ std(X; dims=2)
X = hcat(X, ones(size(X, 1)))
nothing</code></pre><p>Let&#39;s now istantiate the model and set up automatic differentiation using <a href="https://github.com/tpapp/LogDensityProblemsAD.jl?tab=readme-ov-file"><code>LogDensityProblemsAD</code></a>.</p><pre><code class="language-julia hljs">using ADTypes, ReverseDiff
using LogDensityProblemsAD

prob = LogReg(X, y, size(X, 1))
prob_ad = LogDensityProblemsAD.ADgradient(
    ADTypes.AutoReverseDiff(), prob; x=randn(LogDensityProblems.dimension(prob))
)
nothing</code></pre><p>To enable subsampling, <code>LogReg</code> has to implement the method <code>AdvancedVI.subsample</code>. For our model, this is fairly simple: We only need to select the rows of <code>X</code> and the elements of <code>y</code> corresponding to the batch of data points. As subtle point here is that we wrapped <code>prob</code> with <code>LogDensityProblemsAD.ADgradient</code> into <code>prob_ad</code>. Therefore, <code>AdvancedVI</code> sees <code>prob_ad</code> and not <code>prob</code>. This means we have to specialize <code>AdvancedVI.subsample</code> to <code>typeof(prob_ad)</code> and not <code>LogReg</code>.</p><pre><code class="language-julia hljs">using Accessors
using AdvancedVI

function AdvancedVI.subsample(prob::typeof(prob_ad), idx)
    (; X, y, n_data) = parent(prob_ad)
    prob′ = @set prob.ℓ.X = X[idx, :]
    prob′′ = @set prob′.ℓ.y = y[idx]
    return prob′′
end
nothing</code></pre><div class="admonition is-info" id="Info-2ff349d416b1f545"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-2ff349d416b1f545" title="Permalink"></a></header><div class="admonition-body"><p>The default implementation of <code>AdvancedVI.subsample</code> is <code>AdvancedVI.subsample(model, idx) = model</code>. Therefore, if the specialization of <code>AdvancedVI.subsample</code> is not set up properly, <code>AdvancedVI</code> will silently use full-batch gradients instead of subsampling. It is thus useful to check whether the right specialization of <code>AdvancedVI.subsample</code> is being called.</p></div></div><h2 id="Scalable-Inference-via-AdvancedVI"><a class="docs-heading-anchor" href="#Scalable-Inference-via-AdvancedVI">Scalable Inference via AdvancedVI</a><a id="Scalable-Inference-via-AdvancedVI-1"></a><a class="docs-heading-anchor-permalink" href="#Scalable-Inference-via-AdvancedVI" title="Permalink"></a></h2><p>In this example, we will compare the convergence speed of <code>KLMinRepGradProxDescent</code> with and without subsampling. Subsampling can be turned on by supplying a subsampling strategy. Here, we will use <code>ReshufflingBatchSubsampling</code>, which implements random reshuffling. We will us a batch size of 32, which results in <code>313 = length(subsampling) = ceil(Int, size(X,2)/32)</code> steps per epoch.</p><pre><code class="language-julia hljs">dataset = 1:size(prob.X, 1)
batchsize = 32
subsampling = ReshufflingBatchSubsampling(dataset, batchsize)
alg_sub = KLMinRepGradProxDescent(ADTypes.AutoReverseDiff(; compile=true); subsampling)
nothing</code></pre><p>Recall that each epoch is 313 steps. When using <code>ReshufflingBatchSubsampling</code>, it is best to choose the number of iterations to be a multiple of the number of steps <code>length(subsampling)</code> in an epoch. This is due to a peculiar property of <code>ReshufflingBatchSubsampling</code>: the objective value tends to <em>increase</em> during an epoch, and come down nearing the end. (Theoretically, this is due to conditionally <em>biased</em> nature of random reshuffling<sup class="footnote-reference"><a id="citeref-MKR2020" href="#footnote-MKR2020" class="footnote-ref">[MKR2020]</a><span class="footnote-preview" id="fn-MKR2020"></span></sup>.) Therefore, the objective value is minimized exactly after the last step of each epoch.</p><pre><code class="language-julia hljs">num_epochs = 10
max_iter = num_epochs * length(subsampling)
nothing</code></pre><p>If we don&#39;t supply a subsampling strategy to <code>KLMinRepGradProxDescent</code>, subsampling will not be used.</p><pre><code class="language-julia hljs">alg_full = KLMinRepGradProxDescent(ADTypes.AutoReverseDiff(; compile=true))
nothing</code></pre><p>The variational family will be set up as follows:</p><pre><code class="language-julia hljs">using LinearAlgebra

d = LogDensityProblems.dimension(prob_ad)
q = FullRankGaussian(zeros(d), LowerTriangular(Matrix{Float64}(0.6*I, d, d)))
nothing</code></pre><p>It now remains to run VI. For comparison, we will record both the ELBO (with a large number of Monte Carlo samples) and the prediction accuracy.</p><pre><code class="language-julia hljs">using StatsFuns: StatsFuns

logging_interval = 100
time_begin = nothing

&quot;&quot;&quot;
    logistic_prediction(X, μ_β, Σ_β)

Approximate the posterior predictive probability for a logistic link function using Mackay&#39;s approximation (Bishop p. 220).
&quot;&quot;&quot;
function logistic_prediction(X, μ_β, Σ_β)
    xtΣx = sum((prob.X*Σ_β) .* prob.X; dims=2)[:, 1]
    κ = @. 1/sqrt(1 + π/8*xtΣx)
    return StatsFuns.logistic.(κ .* X*μ_β)
end

function callback(; iteration, averaged_params, restructure, kwargs...)
    if mod(iteration, logging_interval) == 1

        # Use the averaged parameters (the eventual output of the algorithm)
        q_avg = restructure(averaged_params)

        # Compute predictions using
        μ_β = mean(q_avg)[1:(end - 1)] # posterior mean of β
        Σ_β = cov(q_avg)[1:(end - 1), end - 1] # marginal posterior covariance of β
        y_pred = logistic_prediction(X, μ_β, Σ_β) .&gt; 0.5

        # Prediction accuracy
        acc = mean(y_pred .== prob.y)

        # Higher fidelity estimate of the ELBO on the averaged parameters
        n_samples = 256
        elbo_callback = -estimate_objective(alg_full, q_avg, prob; n_samples)

        (elbo_callback=elbo_callback, accuracy=acc, time_elapsed=time() - time_begin)
    else
        nothing
    end
end

time_begin = time()
_, info_full, _ = AdvancedVI.optimize(
    alg_full, max_iter, prob_ad, q; show_progress=true, callback
);

time_begin = time()
_, info_sub, _ = AdvancedVI.optimize(
    alg_sub, max_iter, prob_ad, q; show_progress=true, callback
);
nothing</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Optimizing   0%|                               |  ETA: 0:34:56 ( 0.67  s/it)
        elbo: -16353.885138100246
   iteration: 2

Optimizing   3%|█                              |  ETA: 0:01:21 (26.59 ms/it)
        elbo: -12700.869390768446
   iteration: 102

Optimizing   4%|█▎                             |  ETA: 0:01:08 (22.59 ms/it)
        elbo: -31159.425477474957
   iteration: 129

Optimizing   5%|█▍                             |  ETA: 0:01:04 (21.30 ms/it)
        elbo: -10168.810598583015
   iteration: 142

Optimizing   5%|█▌                             |  ETA: 0:01:00 (20.18 ms/it)
        elbo: -13637.530948582025
   iteration: 155

Optimizing   5%|█▋                             |  ETA: 0:00:57 (19.24 ms/it)
        elbo: -12150.939032515395
   iteration: 168

Optimizing   6%|█▊                             |  ETA: 0:00:54 (18.33 ms/it)
        elbo: -7760.317261029756
   iteration: 182

Optimizing   6%|█▉                             |  ETA: 0:00:52 (17.68 ms/it)
        elbo: -7981.57317286139
   iteration: 195

Optimizing   7%|██                             |  ETA: 0:00:51 (17.49 ms/it)
        elbo: -12856.40706467937
   iteration: 207

Optimizing   7%|██▏                            |  ETA: 0:00:49 (16.96 ms/it)
        elbo: -7518.895592159675
   iteration: 220

Optimizing   7%|██▍                            |  ETA: 0:00:47 (16.39 ms/it)
        elbo: -12011.87156593729
   iteration: 234

Optimizing   8%|██▌                            |  ETA: 0:00:46 (15.93 ms/it)
        elbo: -6700.134260965938
   iteration: 248

Optimizing   8%|██▋                            |  ETA: 0:00:45 (15.54 ms/it)
        elbo: -7962.82448926776
   iteration: 261

Optimizing   9%|██▊                            |  ETA: 0:00:43 (15.14 ms/it)
        elbo: -7571.324385892865
   iteration: 275

Optimizing   9%|██▉                            |  ETA: 0:00:42 (14.77 ms/it)
        elbo: -6887.623537575183
   iteration: 289

Optimizing  10%|███                            |  ETA: 0:00:42 (14.74 ms/it)
        elbo: -6467.7216203123635
   iteration: 302

Optimizing  10%|███▏                           |  ETA: 0:00:41 (14.41 ms/it)
        elbo: -6772.909274538202
   iteration: 316

Optimizing  11%|███▎                           |  ETA: 0:00:40 (14.16 ms/it)
        elbo: -6608.083534876587
   iteration: 330

Optimizing  11%|███▍                           |  ETA: 0:00:39 (13.92 ms/it)
        elbo: -6352.2344073279555
   iteration: 343

Optimizing  11%|███▌                           |  ETA: 0:00:38 (13.70 ms/it)
        elbo: -6737.691889109635
   iteration: 356

Optimizing  12%|███▋                           |  ETA: 0:00:37 (13.47 ms/it)
        elbo: -7217.656579105879
   iteration: 370

Optimizing  12%|███▊                           |  ETA: 0:00:36 (13.26 ms/it)
        elbo: -6713.439880248591
   iteration: 384

Optimizing  13%|████                           |  ETA: 0:00:36 (13.05 ms/it)
        elbo: -8227.367187415324
   iteration: 398

Optimizing  13%|████▏                          |  ETA: 0:00:36 (13.08 ms/it)
        elbo: -7494.220067732346
   iteration: 411

Optimizing  14%|████▎                          |  ETA: 0:00:35 (12.90 ms/it)
        elbo: -7240.718446606591
   iteration: 425

Optimizing  14%|████▍                          |  ETA: 0:00:34 (12.73 ms/it)
        elbo: -6856.202950273748
   iteration: 439

Optimizing  14%|████▌                          |  ETA: 0:00:34 (12.57 ms/it)
        elbo: -7317.031394691917
   iteration: 453

Optimizing  15%|████▋                          |  ETA: 0:00:33 (12.42 ms/it)
        elbo: -6721.088656354006
   iteration: 467

Optimizing  15%|████▊                          |  ETA: 0:00:33 (12.28 ms/it)
        elbo: -7228.925468422033
   iteration: 481

Optimizing  16%|████▉                          |  ETA: 0:00:32 (12.19 ms/it)
        elbo: -6518.723345025893
   iteration: 493

Optimizing  16%|█████                          |  ETA: 0:00:32 (12.27 ms/it)
        elbo: -6864.413383498642
   iteration: 505

Optimizing  17%|█████▏                         |  ETA: 0:00:32 (12.16 ms/it)
        elbo: -7881.872651931888
   iteration: 518

Optimizing  17%|█████▎                         |  ETA: 0:00:31 (12.03 ms/it)
        elbo: -7368.548958952798
   iteration: 532

Optimizing  17%|█████▍                         |  ETA: 0:00:31 (11.92 ms/it)
        elbo: -6858.422070958211
   iteration: 546

Optimizing  18%|█████▌                         |  ETA: 0:00:30 (11.81 ms/it)
        elbo: -6399.547516668095
   iteration: 560

Optimizing  18%|█████▋                         |  ETA: 0:00:30 (11.70 ms/it)
        elbo: -6814.420764728253
   iteration: 574

Optimizing  19%|█████▉                         |  ETA: 0:00:29 (11.60 ms/it)
        elbo: -6784.58307404088
   iteration: 588

Optimizing  19%|██████                         |  ETA: 0:00:30 (11.72 ms/it)
   elbo_callback: -6631.631423718524
        accuracy: 0.7113
    time_elapsed: 7.160772085189819
            elbo: -6643.043787492432
       iteration: 601




Optimizing  19%|██████                         |  ETA: 0:00:32 (12.56 ms/it)
        elbo: -6212.802935760378
   iteration: 607

Optimizing  20%|██████▏                        |  ETA: 0:00:31 (12.46 ms/it)
        elbo: -6509.729556881173
   iteration: 620

Optimizing  20%|██████▎                        |  ETA: 0:00:31 (12.37 ms/it)
        elbo: -6517.051346771498
   iteration: 633

Optimizing  21%|██████▍                        |  ETA: 0:00:30 (12.26 ms/it)
        elbo: -7006.036794829789
   iteration: 647

Optimizing  21%|██████▌                        |  ETA: 0:00:30 (12.17 ms/it)
        elbo: -6076.695415109412
   iteration: 660

Optimizing  22%|██████▋                        |  ETA: 0:00:30 (12.08 ms/it)
        elbo: -6913.594729230534
   iteration: 674

Optimizing  22%|██████▊                        |  ETA: 0:00:29 (12.00 ms/it)
        elbo: -6434.676108329899
   iteration: 687

Optimizing  22%|███████                        |  ETA: 0:00:29 (12.04 ms/it)
   elbo_callback: -6557.489688509655
        accuracy: 0.7201
    time_elapsed: 8.55577802658081
            elbo: -6300.060380445388
       iteration: 701




Optimizing  23%|███████▏                       |  ETA: 0:00:29 (11.95 ms/it)
        elbo: -6964.997206619316
   iteration: 715

Optimizing  23%|███████▎                       |  ETA: 0:00:29 (11.87 ms/it)
        elbo: -6762.426214989363
   iteration: 729

Optimizing  24%|███████▍                       |  ETA: 0:00:28 (11.80 ms/it)
        elbo: -6629.264014519156
   iteration: 742

Optimizing  24%|███████▌                       |  ETA: 0:00:28 (11.72 ms/it)
        elbo: -7104.351085060784
   iteration: 756

Optimizing  25%|███████▋                       |  ETA: 0:00:28 (11.65 ms/it)
        elbo: -7077.642188864721
   iteration: 769

Optimizing  25%|███████▊                       |  ETA: 0:00:27 (11.59 ms/it)
        elbo: -6315.04587999883
   iteration: 783

Optimizing  25%|███████▉                       |  ETA: 0:00:27 (11.52 ms/it)
        elbo: -6343.327158469397
   iteration: 797

Optimizing  26%|████████                       |  ETA: 0:00:27 (11.57 ms/it)
        elbo: -7332.30019360681
   iteration: 809

Optimizing  26%|████████▏                      |  ETA: 0:00:27 (11.50 ms/it)
        elbo: -6095.724108528993
   iteration: 823

Optimizing  27%|████████▎                      |  ETA: 0:00:26 (11.45 ms/it)
        elbo: -7331.470195467627
   iteration: 836

Optimizing  27%|████████▍                      |  ETA: 0:00:26 (11.38 ms/it)
        elbo: -6188.5365389386525
   iteration: 850

Optimizing  28%|████████▌                      |  ETA: 0:00:26 (11.33 ms/it)
        elbo: -6774.8549586220315
   iteration: 863

Optimizing  28%|████████▋                      |  ETA: 0:00:25 (11.26 ms/it)
        elbo: -6739.042954595149
   iteration: 877

Optimizing  28%|████████▉                      |  ETA: 0:00:25 (11.21 ms/it)
        elbo: -6573.9966678147175
   iteration: 890

Optimizing  29%|█████████                      |  ETA: 0:00:25 (11.25 ms/it)
        elbo: -6965.375574841535
   iteration: 903

Optimizing  29%|█████████▏                     |  ETA: 0:00:25 (11.20 ms/it)
        elbo: -6121.09378855257
   iteration: 917

Optimizing  30%|█████████▎                     |  ETA: 0:00:24 (11.14 ms/it)
        elbo: -6548.111339795967
   iteration: 931

Optimizing  30%|█████████▍                     |  ETA: 0:00:24 (11.09 ms/it)
        elbo: -6178.269083105101
   iteration: 945

Optimizing  31%|█████████▌                     |  ETA: 0:00:24 (11.04 ms/it)
        elbo: -6415.706929579833
   iteration: 959

Optimizing  31%|█████████▋                     |  ETA: 0:00:24 (10.99 ms/it)
        elbo: -6707.073315218807
   iteration: 972

Optimizing  32%|█████████▊                     |  ETA: 0:00:23 (10.94 ms/it)
        elbo: -6971.5786407170535
   iteration: 986

Optimizing  32%|█████████▉                     |  ETA: 0:00:23 (10.89 ms/it)
        elbo: -6772.766788732636
   iteration: 1000

Optimizing  32%|██████████                     |  ETA: 0:00:23 (10.94 ms/it)
        elbo: -6446.999138250758
   iteration: 1013

Optimizing  33%|██████████▏                    |  ETA: 0:00:23 (10.89 ms/it)
        elbo: -6455.57122147864
   iteration: 1027

Optimizing  33%|██████████▎                    |  ETA: 0:00:23 (10.84 ms/it)
        elbo: -6584.154960783651
   iteration: 1041

Optimizing  34%|██████████▌                    |  ETA: 0:00:22 (10.80 ms/it)
        elbo: -5797.7844334202455
   iteration: 1055

Optimizing  34%|██████████▋                    |  ETA: 0:00:22 (10.76 ms/it)
        elbo: -6882.531053806186
   iteration: 1069

Optimizing  35%|██████████▊                    |  ETA: 0:00:22 (10.72 ms/it)
        elbo: -6575.519462804403
   iteration: 1083

Optimizing  35%|██████████▉                    |  ETA: 0:00:22 (10.68 ms/it)
        elbo: -6476.253062585494
   iteration: 1096

Optimizing  35%|███████████                    |  ETA: 0:00:22 (10.72 ms/it)
        elbo: -6578.29791387371
   iteration: 1109

Optimizing  36%|███████████▏                   |  ETA: 0:00:21 (10.68 ms/it)
        elbo: -6490.545177920427
   iteration: 1123

Optimizing  36%|███████████▎                   |  ETA: 0:00:21 (10.64 ms/it)
        elbo: -6262.747125711478
   iteration: 1137

Optimizing  37%|███████████▍                   |  ETA: 0:00:21 (10.60 ms/it)
        elbo: -6392.486660452109
   iteration: 1151

Optimizing  37%|███████████▌                   |  ETA: 0:00:21 (10.57 ms/it)
        elbo: -5962.860652573236
   iteration: 1165

Optimizing  38%|███████████▋                   |  ETA: 0:00:21 (10.53 ms/it)
        elbo: -6089.469224077749
   iteration: 1179

Optimizing  38%|███████████▉                   |  ETA: 0:00:20 (10.50 ms/it)
        elbo: -6097.242126917333
   iteration: 1193

Optimizing  38%|███████████▉                   |  ETA: 0:00:20 (10.54 ms/it)
        elbo: -7887.613089982461
   iteration: 1205

Optimizing  39%|████████████▏                  |  ETA: 0:00:20 (10.50 ms/it)
        elbo: -6642.519084385564
   iteration: 1219

Optimizing  39%|████████████▎                  |  ETA: 0:00:20 (10.47 ms/it)
        elbo: -6139.887287655115
   iteration: 1233

Optimizing  40%|████████████▍                  |  ETA: 0:00:20 (10.43 ms/it)
        elbo: -6817.198671072678
   iteration: 1247

Optimizing  40%|████████████▌                  |  ETA: 0:00:19 (10.40 ms/it)
        elbo: -6841.3710762047895
   iteration: 1261

Optimizing  41%|████████████▋                  |  ETA: 0:00:19 (10.36 ms/it)
        elbo: -6267.76371446094
   iteration: 1275

Optimizing  41%|████████████▊                  |  ETA: 0:00:19 (10.34 ms/it)
        elbo: -6587.611418463241
   iteration: 1289

Optimizing  42%|████████████▉                  |  ETA: 0:00:19 (10.37 ms/it)
   elbo_callback: -6290.568401092527
        accuracy: 0.7436
    time_elapsed: 13.614607095718384
            elbo: -5880.379659832004
       iteration: 1301




Optimizing  42%|█████████████                  |  ETA: 0:00:19 (10.34 ms/it)
        elbo: -6134.916003160194
   iteration: 1315

Optimizing  42%|█████████████▏                 |  ETA: 0:00:19 (10.31 ms/it)
        elbo: -6338.08564710941
   iteration: 1329

Optimizing  43%|█████████████▎                 |  ETA: 0:00:18 (10.28 ms/it)
        elbo: -6329.845958427589
   iteration: 1343

Optimizing  43%|█████████████▌                 |  ETA: 0:00:18 (10.25 ms/it)
        elbo: -6856.488978131357
   iteration: 1357

Optimizing  44%|█████████████▋                 |  ETA: 0:00:18 (10.22 ms/it)
        elbo: -6878.077811219066
   iteration: 1371

Optimizing  44%|█████████████▊                 |  ETA: 0:00:18 (10.19 ms/it)
        elbo: -6240.360536044486
   iteration: 1385

Optimizing  45%|█████████████▉                 |  ETA: 0:00:18 (10.17 ms/it)
        elbo: -6103.619599034367
   iteration: 1399

Optimizing  45%|██████████████                 |  ETA: 0:00:18 (10.20 ms/it)
        elbo: -6657.395317893022
   iteration: 1413

Optimizing  46%|██████████████▏                |  ETA: 0:00:17 (10.17 ms/it)
        elbo: -6099.680109463677
   iteration: 1427

Optimizing  46%|██████████████▎                |  ETA: 0:00:17 (10.14 ms/it)
        elbo: -6049.170262432474
   iteration: 1441

Optimizing  46%|██████████████▍                |  ETA: 0:00:17 (10.11 ms/it)
        elbo: -6638.3941927322485
   iteration: 1455

Optimizing  47%|██████████████▌                |  ETA: 0:00:17 (10.09 ms/it)
        elbo: -9660.656289731589
   iteration: 1469

Optimizing  47%|██████████████▊                |  ETA: 0:00:17 (10.06 ms/it)
        elbo: -10186.939117060723
   iteration: 1483

Optimizing  48%|██████████████▉                |  ETA: 0:00:16 (10.04 ms/it)
        elbo: -6695.3904635408635
   iteration: 1497

Optimizing  48%|███████████████                |  ETA: 0:00:16 (10.07 ms/it)
        elbo: -7441.138767701895
   iteration: 1511

Optimizing  49%|███████████████▏               |  ETA: 0:00:16 (10.04 ms/it)
        elbo: -10028.055026959553
   iteration: 1526

Optimizing  49%|███████████████▎               |  ETA: 0:00:16 (10.02 ms/it)
        elbo: -6289.126994503239
   iteration: 1540

Optimizing  50%|███████████████▍               |  ETA: 0:00:16 ( 9.99 ms/it)
        elbo: -10379.34120083251
   iteration: 1554

Optimizing  50%|███████████████▌               |  ETA: 0:00:16 ( 9.97 ms/it)
        elbo: -6197.619238020842
   iteration: 1568

Optimizing  51%|███████████████▋               |  ETA: 0:00:15 ( 9.95 ms/it)
        elbo: -7795.167513553216
   iteration: 1582

Optimizing  51%|███████████████▊               |  ETA: 0:00:15 ( 9.92 ms/it)
        elbo: -5774.382167458267
   iteration: 1596

Optimizing  51%|████████████████               |  ETA: 0:00:15 ( 9.95 ms/it)
        elbo: -6534.0341696860705
   iteration: 1610

Optimizing  52%|████████████████▏              |  ETA: 0:00:15 ( 9.93 ms/it)
        elbo: -6570.473211813137
   iteration: 1625

Optimizing  52%|████████████████▎              |  ETA: 0:00:15 ( 9.91 ms/it)
        elbo: -7556.325263443737
   iteration: 1639

Optimizing  53%|████████████████▍              |  ETA: 0:00:15 ( 9.89 ms/it)
        elbo: -5959.287029119306
   iteration: 1653

Optimizing  53%|████████████████▌              |  ETA: 0:00:14 ( 9.86 ms/it)
        elbo: -5990.258302699692
   iteration: 1667

Optimizing  54%|████████████████▋              |  ETA: 0:00:14 ( 9.84 ms/it)
        elbo: -6060.116152327692
   iteration: 1681

Optimizing  54%|████████████████▊              |  ETA: 0:00:14 ( 9.82 ms/it)
        elbo: -6157.042487939049
   iteration: 1695

Optimizing  55%|████████████████▉              |  ETA: 0:00:14 ( 9.85 ms/it)
        elbo: -6176.671243951459
   iteration: 1709

Optimizing  55%|█████████████████▏             |  ETA: 0:00:14 ( 9.83 ms/it)
        elbo: -7734.603077004728
   iteration: 1724

Optimizing  56%|█████████████████▎             |  ETA: 0:00:14 ( 9.81 ms/it)
        elbo: -10824.464826942112
   iteration: 1738

Optimizing  56%|█████████████████▍             |  ETA: 0:00:13 ( 9.79 ms/it)
        elbo: -9388.662291529352
   iteration: 1753

Optimizing  56%|█████████████████▌             |  ETA: 0:00:13 ( 9.77 ms/it)
        elbo: -5876.332824674442
   iteration: 1767

Optimizing  57%|█████████████████▋             |  ETA: 0:00:13 ( 9.75 ms/it)
        elbo: -8669.967480168147
   iteration: 1781

Optimizing  57%|█████████████████▊             |  ETA: 0:00:13 ( 9.73 ms/it)
        elbo: -6732.096031471471
   iteration: 1795

Optimizing  58%|█████████████████▉             |  ETA: 0:00:13 ( 9.76 ms/it)
        elbo: -7498.331141178234
   iteration: 1809

Optimizing  58%|██████████████████             |  ETA: 0:00:13 ( 9.74 ms/it)
        elbo: -6340.8665325085685
   iteration: 1823

Optimizing  59%|██████████████████▎            |  ETA: 0:00:13 ( 9.72 ms/it)
        elbo: -6023.161134778915
   iteration: 1837

Optimizing  59%|██████████████████▍            |  ETA: 0:00:12 ( 9.70 ms/it)
        elbo: -5910.490915622098
   iteration: 1851

Optimizing  60%|██████████████████▌            |  ETA: 0:00:12 ( 9.69 ms/it)
        elbo: -5649.168121859056
   iteration: 1865

Optimizing  60%|██████████████████▋            |  ETA: 0:00:12 ( 9.67 ms/it)
        elbo: -5844.2981095161
   iteration: 1879

Optimizing  60%|██████████████████▊            |  ETA: 0:00:12 ( 9.65 ms/it)
        elbo: -6259.132960216724
   iteration: 1893

Optimizing  61%|██████████████████▉            |  ETA: 0:00:12 ( 9.68 ms/it)
        elbo: -5913.412997091922
   iteration: 1907

Optimizing  61%|███████████████████            |  ETA: 0:00:12 ( 9.66 ms/it)
        elbo: -6592.1382283501935
   iteration: 1921

Optimizing  62%|███████████████████▏           |  ETA: 0:00:12 ( 9.65 ms/it)
        elbo: -6164.270556709351
   iteration: 1935

Optimizing  62%|███████████████████▎           |  ETA: 0:00:11 ( 9.63 ms/it)
        elbo: -7831.868940562204
   iteration: 1949

Optimizing  63%|███████████████████▌           |  ETA: 0:00:11 ( 9.61 ms/it)
        elbo: -6814.359735373028
   iteration: 1963

Optimizing  63%|███████████████████▋           |  ETA: 0:00:11 ( 9.60 ms/it)
        elbo: -6149.880748877296
   iteration: 1977

Optimizing  64%|███████████████████▊           |  ETA: 0:00:11 ( 9.58 ms/it)
        elbo: -6420.815344240298
   iteration: 1991

Optimizing  64%|███████████████████▉           |  ETA: 0:00:11 ( 9.61 ms/it)
        elbo: -6641.458194967121
   iteration: 2005

Optimizing  65%|████████████████████           |  ETA: 0:00:11 ( 9.59 ms/it)
        elbo: -6181.705743244213
   iteration: 2019

Optimizing  65%|████████████████████▏          |  ETA: 0:00:11 ( 9.58 ms/it)
        elbo: -6689.15767517288
   iteration: 2033

Optimizing  65%|████████████████████▎          |  ETA: 0:00:10 ( 9.56 ms/it)
        elbo: -7623.895892355456
   iteration: 2047

Optimizing  66%|████████████████████▍          |  ETA: 0:00:10 ( 9.55 ms/it)
        elbo: -5386.433268271491
   iteration: 2061

Optimizing  66%|████████████████████▌          |  ETA: 0:00:10 ( 9.53 ms/it)
        elbo: -5573.448927713834
   iteration: 2075

Optimizing  67%|████████████████████▊          |  ETA: 0:00:10 ( 9.52 ms/it)
        elbo: -6833.503440076713
   iteration: 2089

Optimizing  67%|████████████████████▉          |  ETA: 0:00:10 ( 9.54 ms/it)
        elbo: -5700.5769389317
   iteration: 2103

Optimizing  68%|█████████████████████          |  ETA: 0:00:10 ( 9.52 ms/it)
        elbo: -6367.263715193269
   iteration: 2118

Optimizing  68%|█████████████████████▏         |  ETA: 0:00:09 ( 9.51 ms/it)
        elbo: -6969.212180538109
   iteration: 2132

Optimizing  69%|█████████████████████▎         |  ETA: 0:00:09 ( 9.50 ms/it)
        elbo: -5401.56447818567
   iteration: 2146

Optimizing  69%|█████████████████████▍         |  ETA: 0:00:09 ( 9.48 ms/it)
        elbo: -5536.464276150373
   iteration: 2160

Optimizing  69%|█████████████████████▌         |  ETA: 0:00:09 ( 9.47 ms/it)
        elbo: -7581.224941891257
   iteration: 2173

Optimizing  70%|█████████████████████▋         |  ETA: 0:00:09 ( 9.46 ms/it)
        elbo: -6191.353440377914
   iteration: 2187

Optimizing  70%|█████████████████████▊         |  ETA: 0:00:09 ( 9.49 ms/it)
   elbo_callback: -5891.101901736554
        accuracy: 0.777
    time_elapsed: 21.00828194618225
            elbo: -5735.587566116166
       iteration: 2201




Optimizing  71%|██████████████████████         |  ETA: 0:00:09 ( 9.48 ms/it)
        elbo: -7178.511171721106
   iteration: 2215

Optimizing  71%|██████████████████████▏        |  ETA: 0:00:09 ( 9.47 ms/it)
        elbo: -6595.498105582543
   iteration: 2229

Optimizing  72%|██████████████████████▎        |  ETA: 0:00:08 ( 9.45 ms/it)
        elbo: -6067.625077726544
   iteration: 2243

Optimizing  72%|██████████████████████▍        |  ETA: 0:00:08 ( 9.44 ms/it)
        elbo: -5920.356199223494
   iteration: 2257

Optimizing  73%|██████████████████████▌        |  ETA: 0:00:08 ( 9.43 ms/it)
        elbo: -10608.822192964064
   iteration: 2271

Optimizing  73%|██████████████████████▋        |  ETA: 0:00:08 ( 9.42 ms/it)
        elbo: -7436.17946374001
   iteration: 2285

Optimizing  73%|██████████████████████▊        |  ETA: 0:00:08 ( 9.41 ms/it)
        elbo: -5742.496556629128
   iteration: 2299

Optimizing  74%|██████████████████████▉        |  ETA: 0:00:08 ( 9.44 ms/it)
        elbo: -5599.911041347126
   iteration: 2311

Optimizing  74%|███████████████████████        |  ETA: 0:00:08 ( 9.42 ms/it)
        elbo: -5740.542480413031
   iteration: 2325

Optimizing  75%|███████████████████████▏       |  ETA: 0:00:07 ( 9.41 ms/it)
        elbo: -5752.355728427854
   iteration: 2339

Optimizing  75%|███████████████████████▎       |  ETA: 0:00:07 ( 9.40 ms/it)
        elbo: -9285.956336331506
   iteration: 2353

Optimizing  76%|███████████████████████▌       |  ETA: 0:00:07 ( 9.39 ms/it)
        elbo: -5450.366528082826
   iteration: 2367

Optimizing  76%|███████████████████████▋       |  ETA: 0:00:07 ( 9.38 ms/it)
        elbo: -5359.058306602848
   iteration: 2381

Optimizing  77%|███████████████████████▊       |  ETA: 0:00:07 ( 9.36 ms/it)
        elbo: -6956.75655660771
   iteration: 2395

Optimizing  77%|███████████████████████▉       |  ETA: 0:00:07 ( 9.39 ms/it)
        elbo: -7303.136728904406
   iteration: 2408

Optimizing  77%|████████████████████████       |  ETA: 0:00:07 ( 9.38 ms/it)
        elbo: -5388.232364151303
   iteration: 2422

Optimizing  78%|████████████████████████▏      |  ETA: 0:00:06 ( 9.37 ms/it)
        elbo: -6031.572442464075
   iteration: 2437

Optimizing  78%|████████████████████████▎      |  ETA: 0:00:06 ( 9.36 ms/it)
        elbo: -11602.173137416154
   iteration: 2451

Optimizing  79%|████████████████████████▍      |  ETA: 0:00:06 ( 9.35 ms/it)
        elbo: -6405.923575860778
   iteration: 2465

Optimizing  79%|████████████████████████▌      |  ETA: 0:00:06 ( 9.34 ms/it)
        elbo: -5585.6098755432
   iteration: 2479

Optimizing  80%|████████████████████████▊      |  ETA: 0:00:06 ( 9.33 ms/it)
        elbo: -7742.163664835956
   iteration: 2493

Optimizing  80%|████████████████████████▊      |  ETA: 0:00:06 ( 9.35 ms/it)
        elbo: -7001.266322963957
   iteration: 2505

Optimizing  80%|█████████████████████████      |  ETA: 0:00:06 ( 9.34 ms/it)
        elbo: -10081.036648557578
   iteration: 2519

Optimizing  81%|█████████████████████████▏     |  ETA: 0:00:06 ( 9.33 ms/it)
        elbo: -16008.598620179051
   iteration: 2533

Optimizing  81%|█████████████████████████▎     |  ETA: 0:00:05 ( 9.32 ms/it)
        elbo: -6756.850389648723
   iteration: 2547

Optimizing  82%|█████████████████████████▍     |  ETA: 0:00:05 ( 9.31 ms/it)
        elbo: -5596.359700595187
   iteration: 2561

Optimizing  82%|█████████████████████████▌     |  ETA: 0:00:05 ( 9.30 ms/it)
        elbo: -5691.377113448549
   iteration: 2575

Optimizing  83%|█████████████████████████▋     |  ETA: 0:00:05 ( 9.29 ms/it)
        elbo: -5724.206023906035
   iteration: 2589

Optimizing  83%|█████████████████████████▊     |  ETA: 0:00:05 ( 9.32 ms/it)
   elbo_callback: -5790.677586235675
        accuracy: 0.7807
    time_elapsed: 24.345591068267822
            elbo: -5736.689962804503
       iteration: 2601




Optimizing  84%|█████████████████████████▉     |  ETA: 0:00:05 ( 9.30 ms/it)
        elbo: -5879.136754193218
   iteration: 2615

Optimizing  84%|██████████████████████████     |  ETA: 0:00:05 ( 9.30 ms/it)
        elbo: -7053.938591681539
   iteration: 2629

Optimizing  84%|██████████████████████████▏    |  ETA: 0:00:05 ( 9.29 ms/it)
        elbo: -6693.010672707819
   iteration: 2643

Optimizing  85%|██████████████████████████▍    |  ETA: 0:00:04 ( 9.28 ms/it)
        elbo: -5828.489605501418
   iteration: 2657

Optimizing  85%|██████████████████████████▌    |  ETA: 0:00:04 ( 9.27 ms/it)
        elbo: -6573.275137766915
   iteration: 2671

Optimizing  86%|██████████████████████████▋    |  ETA: 0:00:04 ( 9.26 ms/it)
        elbo: -6741.369599349635
   iteration: 2685

Optimizing  86%|██████████████████████████▊    |  ETA: 0:00:04 ( 9.25 ms/it)
        elbo: -5316.385866684943
   iteration: 2699

Optimizing  87%|██████████████████████████▉    |  ETA: 0:00:04 ( 9.27 ms/it)
        elbo: -5667.733151249465
   iteration: 2713

Optimizing  87%|███████████████████████████    |  ETA: 0:00:04 ( 9.26 ms/it)
        elbo: -5536.023448598663
   iteration: 2727

Optimizing  88%|███████████████████████████▏   |  ETA: 0:00:04 ( 9.25 ms/it)
        elbo: -9843.62557301415
   iteration: 2741

Optimizing  88%|███████████████████████████▎   |  ETA: 0:00:03 ( 9.24 ms/it)
        elbo: -6748.438353658028
   iteration: 2755

Optimizing  88%|███████████████████████████▍   |  ETA: 0:00:03 ( 9.23 ms/it)
        elbo: -5860.70083672156
   iteration: 2769

Optimizing  89%|███████████████████████████▋   |  ETA: 0:00:03 ( 9.22 ms/it)
        elbo: -5612.8921951809025
   iteration: 2783

Optimizing  89%|███████████████████████████▊   |  ETA: 0:00:03 ( 9.21 ms/it)
        elbo: -7441.913902490908
   iteration: 2797

Optimizing  90%|███████████████████████████▉   |  ETA: 0:00:03 ( 9.23 ms/it)
        elbo: -5904.7371244413125
   iteration: 2809

Optimizing  90%|████████████████████████████   |  ETA: 0:00:03 ( 9.22 ms/it)
        elbo: -5612.078074751727
   iteration: 2823

Optimizing  91%|████████████████████████████▏  |  ETA: 0:00:03 ( 9.21 ms/it)
        elbo: -5650.079417701492
   iteration: 2837

Optimizing  91%|████████████████████████████▎  |  ETA: 0:00:03 ( 9.20 ms/it)
        elbo: -17716.80568217085
   iteration: 2851

Optimizing  92%|████████████████████████████▍  |  ETA: 0:00:02 ( 9.20 ms/it)
        elbo: -6389.199543653786
   iteration: 2865

Optimizing  92%|████████████████████████████▌  |  ETA: 0:00:02 ( 9.19 ms/it)
        elbo: -6279.967574407683
   iteration: 2879

Optimizing  92%|████████████████████████████▋  |  ETA: 0:00:02 ( 9.18 ms/it)
        elbo: -7052.155652500301
   iteration: 2893

Optimizing  93%|████████████████████████████▊  |  ETA: 0:00:02 ( 9.20 ms/it)
        elbo: -5714.152936322502
   iteration: 2907

Optimizing  93%|████████████████████████████▉  |  ETA: 0:00:02 ( 9.19 ms/it)
        elbo: -6536.632294470176
   iteration: 2921

Optimizing  94%|█████████████████████████████▏ |  ETA: 0:00:02 ( 9.18 ms/it)
        elbo: -5904.184686475056
   iteration: 2935

Optimizing  94%|█████████████████████████████▎ |  ETA: 0:00:02 ( 9.17 ms/it)
        elbo: -8262.66164695064
   iteration: 2949

Optimizing  95%|█████████████████████████████▍ |  ETA: 0:00:02 ( 9.16 ms/it)
        elbo: -6012.505772782536
   iteration: 2963

Optimizing  95%|█████████████████████████████▌ |  ETA: 0:00:01 ( 9.17 ms/it)
        elbo: -5260.945362558453
   iteration: 2977

Optimizing  96%|█████████████████████████████▋ |  ETA: 0:00:01 ( 9.16 ms/it)
        elbo: -5482.95667035655
   iteration: 2991

Optimizing  96%|█████████████████████████████▊ |  ETA: 0:00:01 ( 9.18 ms/it)
        elbo: -5883.2257110571345
   iteration: 3004

Optimizing  96%|█████████████████████████████▉ |  ETA: 0:00:01 ( 9.17 ms/it)
        elbo: -5488.076317731856
   iteration: 3019

Optimizing  97%|██████████████████████████████ |  ETA: 0:00:01 ( 9.16 ms/it)
        elbo: -7608.716682915986
   iteration: 3033

Optimizing  97%|██████████████████████████████▏|  ETA: 0:00:01 ( 9.15 ms/it)
        elbo: -5933.740512458961
   iteration: 3047

Optimizing  98%|██████████████████████████████▍|  ETA: 0:00:01 ( 9.14 ms/it)
        elbo: -6015.58680543261
   iteration: 3061

Optimizing  98%|██████████████████████████████▌|  ETA: 0:00:01 ( 9.13 ms/it)
        elbo: -5427.850966412465
   iteration: 3075

Optimizing  99%|██████████████████████████████▋|  ETA: 0:00:00 ( 9.13 ms/it)
        elbo: -7303.679139446074
   iteration: 3089

Optimizing  99%|██████████████████████████████▊|  ETA: 0:00:00 ( 9.15 ms/it)
        elbo: -6676.1118363515425
   iteration: 3103

Optimizing  99%|██████████████████████████████▉|  ETA: 0:00:00 ( 9.14 ms/it)
        elbo: -5886.206967276082
   iteration: 3117

Optimizing 100%|███████████████████████████████| Time: 0:00:28 ( 9.13 ms/it)
        elbo: -10426.803818493352
   iteration: 3130
Optimizing   0%|                               |  ETA: 0:16:12 ( 0.31  s/it)
       epoch: 1
        step: 2
        elbo: -16068.225769361034
   iteration: 2



Optimizing   5%|█▋                             |  ETA: 0:00:15 ( 5.09 ms/it)
       epoch: 1
        step: 160
        elbo: -11083.225164409783
   iteration: 160



Optimizing   8%|██▍                            |  ETA: 0:00:11 ( 3.90 ms/it)
       epoch: 1
        step: 243
        elbo: -6599.0119329739
   iteration: 243



Optimizing  10%|███                            |  ETA: 0:00:10 ( 3.47 ms/it)
       epoch: 1
        step: 305
        elbo: -6463.91466442848
   iteration: 305



Optimizing  13%|████                           |  ETA: 0:00:08 ( 3.10 ms/it)
   elbo_callback: -7594.484589013371
        accuracy: 0.657
    time_elapsed: 1.3438639640808105
           epoch: 2
            step: 88
            elbo: -8366.158921568096
       iteration: 401






Optimizing  19%|██████                         |  ETA: 0:00:06 ( 2.48 ms/it)
       epoch: 2
        step: 297
        elbo: -6861.260199158989
   iteration: 610



Optimizing  26%|███████▉                       |  ETA: 0:00:05 ( 2.12 ms/it)
       epoch: 3
        step: 173
        elbo: -6147.549805733894
   iteration: 799



Optimizing  29%|█████████                      |  ETA: 0:00:05 ( 2.10 ms/it)
       epoch: 3
        step: 280
        elbo: -6566.074291817264
   iteration: 906



Optimizing  36%|███████████▏                   |  ETA: 0:00:04 ( 1.94 ms/it)
       epoch: 4
        step: 178
        elbo: -6999.353870480683
   iteration: 1117



Optimizing  42%|████████████▉                  |  ETA: 0:00:03 ( 1.86 ms/it)
       epoch: 5
        step: 53
        elbo: -6389.958928593741
   iteration: 1305



Optimizing  48%|███████████████                |  ETA: 0:00:03 ( 1.78 ms/it)
       epoch: 5
        step: 263
        elbo: -5876.443483385609
   iteration: 1515



Optimizing  54%|████████████████▉              |  ETA: 0:00:02 ( 1.69 ms/it)
       epoch: 6
        step: 133
        elbo: -9525.857905510415
   iteration: 1698



Optimizing  58%|█████████████████▉             |  ETA: 0:00:02 ( 1.71 ms/it)
       epoch: 6
        step: 237
        elbo: -6085.614430337788
   iteration: 1802



Optimizing  64%|████████████████████           |  ETA: 0:00:02 ( 1.67 ms/it)
       epoch: 7
        step: 138
        elbo: -5388.765233837067
   iteration: 2016



Optimizing  72%|██████████████████████▍        |  ETA: 0:00:01 ( 1.62 ms/it)
       epoch: 8
        step: 63
        elbo: -7204.962464141229
   iteration: 2254



Optimizing  75%|███████████████████████▎       |  ETA: 0:00:01 ( 1.61 ms/it)
       epoch: 8
        step: 151
        elbo: -6037.044815285764
   iteration: 2342



Optimizing  77%|███████████████████████▉       |  ETA: 0:00:01 ( 1.61 ms/it)
       epoch: 8
        step: 223
        elbo: -7506.348658761751
   iteration: 2414



Optimizing  83%|█████████████████████████▊     |  ETA: 0:00:01 ( 1.56 ms/it)
       epoch: 9
        step: 94
        elbo: -6337.500659429244
   iteration: 2598



Optimizing  86%|██████████████████████████▊    |  ETA: 0:00:01 ( 1.58 ms/it)
       epoch: 9
        step: 199
        elbo: -5380.746216967914
   iteration: 2703



Optimizing  93%|████████████████████████████▉  |  ETA: 0:00:00 ( 1.55 ms/it)
       epoch: 10
        step: 96
        elbo: -5461.743571390074
   iteration: 2913



Optimizing 100%|███████████████████████████████| Time: 0:00:04 ( 1.53 ms/it)
       epoch: 10
        step: 313
        elbo: -7259.538424995574
   iteration: 3130</code></pre><p>Let&#39;s visualize the evolution of the ELBO.</p><pre><code class="language-julia hljs">using Plots

t = 1:logging_interval:max_iter
plot(
    [i.iteration for i in info_full[t]],
    [i.elbo_callback for i in info_full[t]];
    xlabel=&quot;Iteration&quot;,
    ylabel=&quot;ELBO&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.iteration for i in info_sub[t]],
    [i.elbo_callback for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_iteration_elbo.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_iteration_elbo.svg" alt/></p><p>According to this plot, it might seem like subsampling has no benefit (if not detrimental). This is, however, because we are plotting against the number of iterations. Subsampling generally converges slower (asymptotically) in terms of iterations. But in return, it reduces the time spent at each iteration. Therefore, we need to plot against the elapsed time:</p><pre><code class="language-julia hljs">plot(
    [i.time_elapsed for i in info_full[t]],
    [i.elbo_callback for i in info_full[t]];
    xlabel=&quot;Wallclock Time (sec)&quot;,
    ylabel=&quot;ELBO&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.time_elapsed for i in info_sub[t]],
    [i.elbo_callback for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_time_elbo.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_time_elbo.svg" alt/></p><p>We can now see the dramatic effect of subsampling. The picture is similar if we visualize the prediction accuracy over time.</p><pre><code class="language-julia hljs">plot(
    [i.time_elapsed for i in info_full[t]],
    [i.accuracy for i in info_full[t]];
    xlabel=&quot;Wallclock Time (sec)&quot;,
    ylabel=&quot;Prediction Accuracy&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.time_elapsed for i in info_sub[t]],
    [i.accuracy for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_time_accuracy.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_time_accuracy.svg" alt/></p><p>But remember that subsampling will always be <em>asymptotically</em> slower than no subsampling. That is, as the number of iterations increase, there will be a point where no subsampling will overtake subsampling even in terms of wallclock time. Therefore, subsampling is most beneficial when a crude solution to the VI problem suffices.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-HBB2010"><a class="tag is-link" href="#citeref-HBB2010">HBB2010</a>Hoffman, M., Bach, F., &amp; Blei, D. (2010). Online learning for latent Dirichlet allocation. In <em>Advances in Neural Information Processing Systems</em>, 23.</li><li class="footnote" id="footnote-HBWP2013"><a class="tag is-link" href="#citeref-HBWP2013">HBWP2013</a>Hoffman, M. D., Blei, D. M., Wang, C., &amp; Paisley, J. (2013). Stochastic variational inference. <em>Journal of Machine Learning Research</em>, 14(1), 1303-1347.</li><li class="footnote" id="footnote-TL2014"><a class="tag is-link" href="#citeref-TL2014">TL2014</a>Titsias, M., &amp; Lázaro-Gredilla, M. (2014, June). Doubly stochastic variational Bayes for non-conjugate inference. In <em>Proceedings of the International Conference on Machine Learning</em> (pp. 1971-1979). PMLR.</li><li class="footnote" id="footnote-KTRGB2017"><a class="tag is-link" href="#citeref-KTRGB2017">KTRGB2017</a>Kucukelbir, A., Tran, D., Ranganath, R., Gelman, A., &amp; Blei, D. M. (2017). Automatic differentiation variational inference. <em>Journal of Machine Learning Research</em>, 18(14), 1-45.</li><li class="footnote" id="footnote-Tan2018"><a class="tag is-link" href="#citeref-Tan2018">Tan2018</a>Tan, Choon Lin (2018), &quot;Phishing Dataset for Machine Learning: Feature Evaluation&quot;, Mendeley Data, V1, doi: 10.17632/h3cgnj8hft.1]</li><li class="footnote" id="footnote-MKR2020"><a class="tag is-link" href="#citeref-MKR2020">MKR2020</a>Mishchenko, K., Khaled, A., &amp; Richtárik, P. (2020). Random reshuffling: Simple analysis with vast improvements. Advances in Neural Information Processing Systems, 33, 17309-17320.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basic/">« Basic Example</a><a class="docs-footer-nextpage" href="../stan/">Stan Models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 25 November 2025 20:12">Tuesday 25 November 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
