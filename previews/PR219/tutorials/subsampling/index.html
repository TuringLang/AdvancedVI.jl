<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Scaling to Large Datasets · AdvancedVI.jl</title><meta name="title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta property="og:title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta property="twitter:title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta name="description" content="Documentation for AdvancedVI.jl."/><meta property="og:description" content="Documentation for AdvancedVI.jl."/><meta property="twitter:description" content="Documentation for AdvancedVI.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body>
<!-- NAVBAR START -->
<style>
    @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap');

    /* Documenter.jl CSS Overrides */
    html {
        scroll-padding-top: calc(var(--navbar-height) + 1rem);
    }
    .docs-sidebar, #documenter {
        margin-top: var(--navbar-height);
    }
    .docs-version-selector {
        margin-bottom: 60px !important;
    }
    @media screen and (max-width: 1056px) {
        .docs-version-selector {
            margin-bottom: 60px !important;
        }
        .docs-sidebar {
            margin-top: 0 !important;
        }
    }
    /* End of Documenter.jl Tweaks */

    /* Color and Font Variables */
    :root {
        --heading-color: #6c757d;
        --item-color: rgb(165, 165, 165);
        --primary-bg: white;
        --hover-color: #8faad2;
        --deprecated-bg: #ff4d4d;
        --deprecated-text: white;
        --icon-color: #6c757d;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e9ecef;
        
        /* Typography */
        --font-family: "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        --nav-link-font-size: 1.0625rem;
        --turing-title-font-size: 21.25px;
        --icon-font-size: 1.25rem;
        --dropdown-arrow-font-size: 0.6875rem;
        --badge-font-size: 0.75rem;

        /* Sizing and Spacing */
        --navbar-height: 3.75rem;
        --logo-height: 31px;
        --logo-width: auto;
        --logo-padding-top: 7px;
        --logo-margin-left: 0.8rem;
        --title-margin-left: 0.4px;
        --title-nav-spacing: 1.1rem;
        --nav-item-margin-left: 1.3rem;
        --icon-margin-left: 1rem;
        --dropdown-padding: 1.875rem;
        --dropdown-item-width: 12.5rem;
        --dropdown-subitem-width: 15.625rem;
        --dropdown-subitem-padding: 0.125rem 0.625rem;
    }

    /* Dark Theme Variable Overrides */
    html.theme--documenter-dark {
        --heading-color: #e0e0e0;
        --item-color: #bdbdbd;
        --primary-bg: #1f2424;
        --hover-color: #ffffff;
        --icon-color: #e0e0e0;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #424242;
    }

    /* Catppuccin Theme Overrides */
    html.theme--catppuccin-latte {
        --heading-color: #4c4f69;
        --primary-bg: #eff1f5;
        --icon-color: #4c4f69;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e6e9ef;
    }
    html.theme--catppuccin-frappe {
        --heading-color: #c6d0f5;
        --primary-bg: #303446;
        --icon-color: #c6d0f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #51576d;
    }
    html.theme--catppuccin-macchiato {
        --heading-color: #cad3f5;
        --primary-bg: #24273a;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #494d64;
    }
    html.theme--catppuccin-mocha {
        --heading-color: #cad3f5;
        --primary-bg: #1e1e2e;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #45475a;
    }


    /* Main Navigation Bar */
    .ext-navigation {
        font-family: var(--font-family);
        position: fixed;
        height: var(--navbar-height);
        top: 0;
        width: 100%;
        background-color: var(--primary-bg);
        z-index: 1000;
        box-shadow: 0 2px 4px var(--shadow-color);
        display: flex;
        align-items: center;
        padding: 0 1.0625rem;
        transition: transform 0.3s, background-color 0.3s;
    }

    nav.ext-navigation .ext-navbar-logo {
        margin-left: var(--logo-margin-left);
        height: auto;
        max-height: var(--logo-height);
        width: auto;
        padding-top: var(--logo-padding-top);
    }
    
    /* Theme-aware logo text color */
    .ext-navbar-logo .logo-text {
        fill: var(--heading-color);
    }
    
    .ext-navbar-title {
        color: var(--heading-color) !important;
        font-size: var(--turing-title-font-size) !important;
        margin-left: var(--title-margin-left);
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .ext-navbar-title:hover {
        color: var(--hover-color) !important;
    }

    .ext-nav-links {
        display: flex;
        align-items: center;
        list-style-type: none;
        margin: 0;
        padding: 0;
        flex-grow: 1;
        margin-left: var(--title-nav-spacing);
    }

    .ext-nav-links li:first-child {
        margin-left: 0 !important;
    }

    .ext-nav-links li {
        margin-left: var(--nav-item-margin-left) !important;
    }

    .ext-nav-link {
        color: var(--heading-color) !important;
        text-decoration: none;
        font-size: var(--nav-link-font-size) !important;
        transition: color 0.2s ease;
        cursor: pointer;
    }

    .ext-nav-link:hover,
    .ext-navbar-item-single a:hover,
    .ext-navbar-icons a:hover {
        color: var(--hover-color) !important;
    }

    .ext-navbar-item-single a {
        color: var(--heading-color) !important;
    }
    
    .ext-navbar-icons {
        display: flex;
        align-items: center;
    }

    .ext-navbar-icons a {
        color: var(--icon-color) !important;
        font-size: var(--icon-font-size) !important;
        transition: color 0.2s ease;
        margin-left: var(--icon-margin-left);
    }

    .ext-menu-toggle {
        display: none;
        font-size: 1.5rem;
        color: var(--heading-color);
        cursor: pointer;
    }

    .ext-dropdown {
        display: none;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        padding: var(--dropdown-padding);
        position: absolute;
        top: var(--navbar-height);
        width: 100%;
        left: 0;
        background-color: var(--primary-bg);
        line-height: 1.875rem;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s;
        transform: translateY(-0.625rem);
        box-shadow: 0 4px 6px var(--shadow-color);
    }

    #library-handler::after {
        content: "▼";
        font-size: var(--dropdown-arrow-font-size);
        margin-left: 0.3125rem;
        transition: transform 0.3s ease-in-out;
    }

    #library-handler.open::after {
        content: "▲";
    }

    .ext-dropdown.show {
        display: grid;
        opacity: 1;
        transform: translateY(0);
    }

    .ext-dropdown ul {
        width: var(--dropdown-item-width);
        margin-bottom: 1.25rem;
    }

    .ext-dropdown ul li {
        text-align: left;
        display: flex;
        align-items: center;
    }

    .ext-dropdown ul a li {
        color: var(--item-color);
        width: var(--dropdown-subitem-width);
        border-radius: 3px;
        padding: var(--dropdown-subitem-padding);
        transition: background-color 0.2s ease;
    }

    .ext-dropdown ul a li:hover {
        background-color: var(--dropdown-hover-bg);
    }

    .ext-dropdown-item-heading {
        color: var(--heading-color);
        text-align: center;
    }

    .deprecated-badge {
        background-color: var(--deprecated-bg);
        color: var(--deprecated-text);
        font-size: var(--badge-font-size);
        padding: .1rem;
        border-radius: 3px;
        margin-left: 0.5rem;
        line-height: 1;
    }

    @media (max-width: 966px) {
        .ext-dropdown {
            grid-template-columns: 1fr 1fr 1fr;
        }
    }

    @media (max-width: 768px) {
        .ext-nav-links {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            background-color: var(--primary-bg);
            position: absolute;
            top: var(--navbar-height);
            left: 0;
            padding: 0.625rem 0;
            height: auto;
            overflow-y: auto;
            box-shadow: 0 4px 6px var(--shadow-color);
            margin-left: 0;
        }

        .ext-nav-links.show {
            display: flex;
        }

        .ext-nav-links li {
            margin: 0.625rem 0 !important;
            text-align: center;
        }
        
        .ext-menu-toggle {
            display: block;
            margin-left: auto;
        }

        .ext-navigation.hide {
            transform: translateY(calc(-1 * var(--navbar-height)));
        }

        .ext-dropdown {
            position: static;
            display: block;
            opacity: 1;
            transform: none;
            box-shadow: none;
            grid-template-columns: 1fr;
            padding: 0.625rem;
            text-align: center;
        }

        .ext-dropdown ul {
            width: auto;
            display: inline-block;
            margin: 0 auto 0.3125rem;
            text-align: left;
        }
    }
</style>
<nav class="ext-navigation">
    <a href="https://turinglang.org/">
        <svg width="4333" height="1145" viewBox="0 0 4333 1145" fill="none" xmlns="http://www.w3.org/2000/svg" class="ext-navbar-logo">
            <path class="logo-text" d="M0.44603 193.181V66.9868H663.471V193.181H406.62V898H257.297V193.181H0.44603ZM1097.24 635.874V274.74H1244.13V898H1101.7V787.225H1095.21C1081.14 822.121 1058.01 850.66 1025.82 872.842C993.902 895.024 954.542 906.115 907.744 906.115C866.896 906.115 830.783 897.053 799.403 878.929C768.295 860.534 743.948 833.889 726.365 798.993C708.782 763.826 699.99 721.356 699.99 671.581V274.74H846.878V648.858C846.878 688.353 857.699 719.733 879.34 742.997C900.981 766.261 929.385 777.893 964.551 777.893C986.192 777.893 1007.16 772.618 1027.45 762.068C1047.73 751.518 1064.37 735.828 1077.35 714.999C1090.61 693.899 1097.24 667.524 1097.24 635.874ZM1395.17 898V274.74H1537.6V378.617H1544.09C1555.45 342.639 1574.93 314.911 1602.52 295.434C1630.38 275.687 1662.17 265.813 1697.88 265.813C1705.99 265.813 1715.05 266.219 1725.06 267.031C1735.34 267.572 1743.86 268.518 1750.63 269.871V404.992C1744.4 402.828 1734.53 400.934 1721 399.311C1707.75 397.417 1694.9 396.471 1682.46 396.471C1655.68 396.471 1631.6 402.287 1610.23 413.919C1589.13 425.28 1572.49 441.105 1560.32 461.393C1548.15 481.682 1542.06 505.081 1542.06 531.591V898H1395.17ZM1848.21 898V274.74H1995.1V898H1848.21ZM1922.06 186.283C1898.8 186.283 1878.78 178.573 1862.01 163.154C1845.24 147.464 1836.85 128.664 1836.85 106.752C1836.85 84.5701 1845.24 65.7695 1862.01 50.3503C1878.78 34.6606 1898.8 26.8158 1922.06 26.8158C1945.6 26.8158 1965.61 34.6606 1982.12 50.3503C1998.89 65.7695 2007.27 84.5701 2007.27 106.752C2007.27 128.664 1998.89 147.464 1982.12 163.154C1965.61 178.573 1945.6 186.283 1922.06 186.283ZM2293.04 532.809V898H2146.15V274.74H2286.54V380.646H2293.85C2308.18 345.75 2331.04 318.022 2362.42 297.463C2394.07 276.904 2433.16 266.625 2479.69 266.625C2522.7 266.625 2560.17 275.822 2592.09 294.217C2624.28 312.612 2649.17 339.257 2666.75 374.153C2684.6 409.049 2693.39 451.385 2693.12 501.159V898H2546.24V523.882C2546.24 482.223 2535.41 449.626 2513.77 426.092C2492.4 402.557 2462.78 390.79 2424.91 390.79C2399.21 390.79 2376.35 396.471 2356.34 407.832C2336.59 418.923 2321.03 435.019 2309.67 456.119C2298.58 477.218 2293.04 502.782 2293.04 532.809ZM3113.5 1144.71C3060.75 1144.71 3015.44 1137.54 2977.57 1123.2C2939.7 1109.13 2909.26 1090.2 2886.27 1066.39C2863.28 1042.59 2847.32 1016.21 2838.39 987.269L2970.67 955.213C2976.62 967.386 2985.28 979.424 2996.64 991.327C3008 1003.5 3023.28 1013.51 3042.49 1021.35C3061.97 1029.47 3086.45 1033.53 3115.93 1033.53C3157.59 1033.53 3192.08 1023.38 3219.4 1003.09C3246.73 983.076 3260.39 950.074 3260.39 904.087V786.008H3253.08C3245.51 801.157 3234.42 816.711 3219.81 832.671C3205.47 848.632 3186.4 862.022 3162.6 872.842C3139.06 883.663 3109.44 889.073 3073.73 889.073C3025.85 889.073 2982.44 877.847 2943.48 855.394C2904.8 832.671 2873.96 798.857 2850.97 753.952C2828.24 708.777 2816.88 652.24 2816.88 584.341C2816.88 515.902 2828.24 458.147 2850.97 411.078C2873.96 363.739 2904.93 327.896 2943.89 303.55C2982.84 278.933 3026.26 266.625 3074.14 266.625C3110.66 266.625 3140.69 272.847 3164.22 285.29C3188.03 297.463 3206.96 312.206 3221.03 329.519C3235.09 346.561 3245.78 362.657 3253.08 377.805H3261.2V274.74H3406.06V908.144C3406.06 961.435 3393.34 1005.53 3367.92 1040.42C3342.49 1075.32 3307.73 1101.43 3263.63 1118.74C3219.54 1136.05 3169.5 1144.71 3113.5 1144.71ZM3114.72 773.835C3145.83 773.835 3172.34 766.261 3194.25 751.112C3216.16 735.963 3232.79 714.187 3244.16 685.783C3255.52 657.379 3261.2 623.295 3261.2 583.53C3261.2 544.305 3255.52 509.95 3244.16 480.465C3233.07 450.979 3216.56 428.12 3194.65 411.89C3173.01 395.389 3146.37 387.138 3114.72 387.138C3081.98 387.138 3054.66 395.659 3032.75 412.701C3010.84 429.744 2994.34 453.143 2983.25 482.899C2972.16 512.385 2966.61 545.929 2966.61 583.53C2966.61 621.672 2972.16 655.08 2983.25 683.754C2994.61 712.158 3011.25 734.34 3033.16 750.3C3055.34 765.99 3082.53 773.835 3114.72 773.835ZM3647.08 906.927C3622.47 906.927 3601.37 898.271 3583.78 880.958C3566.2 863.645 3557.54 842.545 3557.82 817.658C3557.54 793.312 3566.2 772.482 3583.78 755.17C3601.37 737.857 3622.47 729.2 3647.08 729.2C3670.89 729.2 3691.58 737.857 3709.17 755.17C3727.02 772.482 3736.08 793.312 3736.35 817.658C3736.08 834.159 3731.75 849.173 3723.37 862.698C3715.25 876.224 3704.43 887.044 3690.91 895.16C3677.65 903.004 3663.04 906.927 3647.08 906.927ZM3888.01 274.74H4034.9V933.708C4034.9 978.613 4026.38 1015.67 4009.33 1044.89C3992.29 1074.1 3967.67 1095.88 3935.48 1110.22C3903.29 1124.55 3864.2 1131.72 3818.22 1131.72C3812.81 1131.72 3807.8 1131.59 3803.2 1131.32C3798.6 1131.32 3793.6 1131.18 3788.19 1130.91V1011.21C3792.25 1011.48 3795.9 1011.62 3799.15 1011.62C3802.39 1011.89 3805.77 1012.02 3809.29 1012.02C3837.42 1012.02 3857.58 1005.12 3869.75 991.327C3881.92 977.801 3888.01 957.918 3888.01 931.679V274.74ZM3961.05 186.283C3937.51 186.283 3917.36 178.573 3900.59 163.154C3884.09 147.464 3875.84 128.664 3875.84 106.752C3875.84 84.5701 3884.09 65.7695 3900.59 50.3503C3917.36 34.6606 3937.51 26.8158 3961.05 26.8158C3984.31 26.8158 4004.19 34.6606 4020.7 50.3503C4037.47 65.7695 4045.85 84.5701 4045.85 106.752C4045.85 128.664 4037.47 147.464 4020.7 163.154C4004.19 178.573 3984.31 186.283 3961.05 186.283ZM4332.83 66.9868V898H4185.94V66.9868H4332.83Z" fill="currentColor"/>
            <path d="M4076 108.5C4076 168.424 4027.42 217 3967.5 217C3907.58 217 3859 168.424 3859 108.5C3859 48.5762 3907.58 0 3967.5 0C4027.42 0 4076 48.5762 4076 108.5Z" fill="#389725"/>
            <path d="M3755 814.5C3755 874.424 3706.42 923 3646.5 923C3586.58 923 3538 874.424 3538 814.5C3538 754.576 3586.58 706 3646.5 706C3706.42 706 3755 754.576 3755 814.5Z" fill="#9457B1"/>
            <path d="M2030 108.5C2030 168.424 1981.42 217 1921.5 217C1861.58 217 1813 168.424 1813 108.5C1813 48.5762 1861.58 0 1921.5 0C1981.42 0 2030 48.5762 2030 108.5Z" fill="#CA3B33"/>
        </svg>
    </a>
    <!-- <a class="ext-navbar-title" href="https://turinglang.org/">Turing.jl</a> -->
    
    <ul class="ext-nav-links">
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/getting-started/">Get Started</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/tutorials/">Tutorials</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/faq/">FAQ</a></li>
        <li>
            <p class="ext-nav-link" id="library-handler">Libraries</p>
            <div class="ext-dropdown" id="ext-dropdown-items">
                <ul>
                    <li class="ext-dropdown-item-heading">Modelling Languages</li>
                    <a href="https://turinglang.org/DynamicPPL.jl/"><li>DynamicPPL</li></a>
                    <a href="https://turinglang.org/JuliaBUGS.jl/"><li>JuliaBUGS</li></a>
                    <a href="https://turinglang.org/TuringGLM.jl/"><li>TuringGLM</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">MCMC</li>
                    <a href="https://turinglang.org/AdvancedHMC.jl/"><li>AdvancedHMC</li></a>
                    <a href="https://turinglang.org/AbstractMCMC.jl/"><li>AbstractMCMC</li></a>
                    <a href="https://github.com/theogf/ThermodynamicIntegration.jl"><li>ThermodynamicIntegration</li></a>
                    <a href="https://turinglang.org/AdvancedPS.jl/"><li>AdvancedPS</li></a>
                    <a href="https://turinglang.org/SliceSampling.jl/"><li>SliceSampling</li></a>
                    <a href="https://turinglang.org/EllipticalSliceSampling.jl/"><li>EllipticalSliceSampling</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Diagnostics</li>
                    <a href="https://turinglang.org/MCMCChains.jl/"><li>MCMCChains</li></a>
                    <a href="https://turinglang.org/MCMCDiagnosticTools.jl/"><li>MCMCDiagnosticTools</li></a>
                    <a href="https://turinglang.org/ParetoSmooth.jl/"><li>ParetoSmooth</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Gaussian Processes</li>
                    <a href="https://juliagaussianprocesses.github.io/AbstractGPs.jl/"><li>AbstractGPs</li></a>
                    <a href="https://juliagaussianprocesses.github.io/KernelFunctions.jl/"><li>KernelFunctions</li></a>
                    <a href="https://juliagaussianprocesses.github.io/ApproximateGPs.jl/"><li>ApproximateGPs</li></a>
                </ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Bijectors.jl/">Bijectors</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/TuringCallbacks.jl/">TuringCallbacks</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Deprecated/TuringBenchmarking/">TuringBenchmarking</a><span class="deprecated-badge">Deprecated</span></li></ul>
            </div>
        </li>
        <li><a class="ext-nav-link" href="https://turinglang.org/news/">News</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/team/">Team</a></li>
    </ul>

    <div class="ext-navbar-icons">
        <a href="https://x.com/TuringLang" aria-label="Turing on X"><i class="fa-brands fa-x-twitter"></i></a>
        <a href="https://discourse.julialang.org/c/domain/probprog/48" aria-label="Turing on Discourse"><i class="fa-brands fa-discourse"></i></a>
        <a href="https://julialang.slack.com/archives/CCYDC34A0" aria-label="Turing on Slack"><i class="fa-brands fa-slack"></i></a>
        <a href="https://github.com/TuringLang/" aria-label="Turing.jl on GitHub"><i class="fa-brands fa-github"></i></a>
    </div>

    <span class="ext-menu-toggle"><i class="fa-solid fa-bars"></i></span>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const menuToggle = document.querySelector(".ext-menu-toggle");
        const navLinks = document.querySelector(".ext-nav-links");
        const nav = document.querySelector(".ext-navigation");
        const libraryHandler = document.getElementById("library-handler");
        const dropdownContainer = document.getElementById("ext-dropdown-items");
        let lastScrollY = window.scrollY;

        function closeDropdown() {
            if (dropdownContainer.classList.contains("show")) {
                libraryHandler.classList.remove("open");
                dropdownContainer.classList.remove("show");
                setTimeout(() => {
                    if (!dropdownContainer.classList.contains("show")) {
                        dropdownContainer.style.display = "none";
                    }
                }, 300);
            }
        }

        function openDropdown() {
            dropdownContainer.style.display = "grid";
            libraryHandler.classList.add("open");
            setTimeout(() => {
                dropdownContainer.classList.add("show");
            }, 10);
        }

        function setAppropriateHeight() {
            if (window.innerWidth <= 768) {
                const viewportHeight = window.innerHeight;
                const navHeight = nav.offsetHeight;
                navLinks.style.maxHeight = `${viewportHeight - navHeight}px`;
                navLinks.style.overflowY = "auto";
            } else {
                navLinks.style.maxHeight = "";
                navLinks.style.overflowY = "";
            }
        }

        menuToggle.addEventListener("click", (event) => {
            event.stopPropagation();
            navLinks.classList.toggle("show");
            if (navLinks.classList.contains("show")) {
                setAppropriateHeight();
                closeDropdown();
                dropdownContainer.style.display = "none";
            }
        });

        libraryHandler.addEventListener("click", (event) => {
            event.stopPropagation();
            event.preventDefault();
            if (dropdownContainer.classList.contains("show")) {
                closeDropdown();
            } else {
                openDropdown();
            }
            setAppropriateHeight();
        });

        // Close all menus if a click is registered outside the navigation bar.
        document.addEventListener("click", (event) => {
            if (!nav.contains(event.target)) {
                navLinks.classList.remove("show");
                closeDropdown();
            }
        });

        // Hide navigation bar on scroll down in mobile view.
        window.addEventListener("scroll", () => {
            if (window.innerWidth <= 768) {
                if (window.scrollY > lastScrollY && window.scrollY > nav.offsetHeight){
                    nav.classList.add("hide");
                } else {
                    nav.classList.remove("hide");
                }
                lastScrollY = window.scrollY;
            }
        });

        window.addEventListener("resize", setAppropriateHeight);
    });
</script>
<!-- NAVBAR END -->


<div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AdvancedVI.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">AdvancedVI</a></li><li><a class="tocitem" href="../../general/">General Usage</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../basic/">Basic Example</a></li><li class="is-active"><a class="tocitem" href>Scaling to Large Datasets</a><ul class="internal"><li><a class="tocitem" href="#Setting-Up-Subsampling"><span>Setting Up Subsampling</span></a></li><li><a class="tocitem" href="#Scalable-Inference-via-AdvancedVI"><span>Scalable Inference via AdvancedVI</span></a></li></ul></li><li><a class="tocitem" href="../stan/">Stan Models</a></li><li><a class="tocitem" href="../flows/">Normalizing Flows</a></li><li><a class="tocitem" href="../constrained/">Dealing with Constrained Posteriors</a></li></ul></li><li><span class="tocitem">Algorithms</span><ul><li><a class="tocitem" href="../../klminrepgraddescent/"><code>KLMinRepGradDescent</code></a></li><li><a class="tocitem" href="../../klminrepgradproxdescent/"><code>KLMinRepGradProxDescent</code></a></li><li><a class="tocitem" href="../../klminscoregraddescent/"><code>KLMinScoreGradDescent</code></a></li><li><a class="tocitem" href="../../klminwassfwdbwd/"><code>KLMinWassFwdBwd</code></a></li><li><a class="tocitem" href="../../klminnaturalgraddescent/"><code>KLMinNaturalGradDescent</code></a></li><li><a class="tocitem" href="../../klminsqrtnaturalgraddescent/"><code>KLMinSqrtNaturalGradDescent</code></a></li><li><a class="tocitem" href="../../fisherminbatchmatch/"><code>FisherMinBatchMatch</code></a></li></ul></li><li><a class="tocitem" href="../../families/">Variational Families</a></li><li><a class="tocitem" href="../../optimization/">Optimization</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Scaling to Large Datasets</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Scaling to Large Datasets</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TuringLang/AdvancedVI.jl/blob/main/docs/src/tutorials/subsampling.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Scaling-to-Large-Datasets-with-Subsampling"><a class="docs-heading-anchor" href="#Scaling-to-Large-Datasets-with-Subsampling">Scaling to Large Datasets with Subsampling</a><a id="Scaling-to-Large-Datasets-with-Subsampling-1"></a><a class="docs-heading-anchor-permalink" href="#Scaling-to-Large-Datasets-with-Subsampling" title="Permalink"></a></h1><p>In this tutorial, we will show how to use <code>AdvancedVI</code> on problems with large datasets. Variational inference (VI) has a long and successful history<sup class="footnote-reference"><a id="citeref-HBWP2013" href="#footnote-HBWP2013" class="footnote-ref">[HBWP2013]</a><span class="footnote-preview" id="fn-HBWP2013"></span></sup><sup class="footnote-reference"><a id="citeref-TL2014" href="#footnote-TL2014" class="footnote-ref">[TL2014]</a><span class="footnote-preview" id="fn-TL2014"></span></sup><sup class="footnote-reference"><a id="citeref-HBB2010" href="#footnote-HBB2010" class="footnote-ref">[HBB2010]</a><span class="footnote-preview" id="fn-HBB2010"></span></sup> in large scale inference using (minibatch) subsampling. In this tutorial, we will see how to perform subsampling with <code>KLMinRepGradProxDescent</code>, which was originally described in the paper by Titsias and Lázaro-Gredilla<sup class="footnote-reference"><a id="citeref-TL2014" href="#footnote-TL2014" class="footnote-ref">[TL2014]</a><span class="footnote-preview" id="fn-TL2014"></span></sup>; Kucukelbir <em>et al</em><sup class="footnote-reference"><a id="citeref-KTRGB2017" href="#footnote-KTRGB2017" class="footnote-ref">[KTRGB2017]</a><span class="footnote-preview" id="fn-KTRGB2017"></span></sup>.</p><h2 id="Setting-Up-Subsampling"><a class="docs-heading-anchor" href="#Setting-Up-Subsampling">Setting Up Subsampling</a><a id="Setting-Up-Subsampling-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-Up-Subsampling" title="Permalink"></a></h2><p>We will consider a typical hierarchical logistic regression example.</p><pre><code class="language-julia hljs">using LogDensityProblems: LogDensityProblems
using Distributions
using FillArrays

struct LogReg{XType,YType}
    X::XType
    y::YType
    n_data::Int
end

function LogDensityProblems.logdensity(model::LogReg, θ)
    (; X, y, n_data) = model
    n, d = size(X)
    β, logσ = θ[1:size(X, 2)], θ[end]
    σ = exp(logσ)

    logprior_β = logpdf(MvNormal(Zeros(d), σ), β)
    logprior_σ = logpdf(Normal(0, 3), σ)

    logit = X*β
    loglike_y = mapreduce((li, yi) -&gt; logpdf(BernoulliLogit(li), yi), +, logit, y)
    return n_data/n*loglike_y + logprior_β + logprior_σ
end

function LogDensityProblems.dimension(model::LogReg)
    return size(prob.X, 2) + 1
end

function LogDensityProblems.capabilities(::Type{&lt;:LogReg})
    return LogDensityProblems.LogDensityOrder{0}()
end
nothing</code></pre><p>Notice that, to use subsampling, we need be able to rescale the likelihood strength. That is, for the gradient of the log-density with a batch of data points of size <code>n</code> to be an unbiased estimate of the gradient using the full dataset of size <code>n_data</code>, we need to scale the likelihood by <code>n_data/n</code>. This part is critical to ensure that the algorithm correctly approximates the posterior with the full dataset.</p><p>For the dataset, we will use one that is larger than that used in the <a href="../basic/#basic">Basic Example</a>. This is to properly assess the advantage of subsampling. In particular, we will utilize the &quot;Phishing&quot; dataset<sup class="footnote-reference"><a id="citeref-Tan2018" href="#footnote-Tan2018" class="footnote-ref">[Tan2018]</a><span class="footnote-preview" id="fn-Tan2018"></span></sup>, which consists of 10000 data points, each with 48 features. The goal is to predict whether the features of a specific website indicate whether it is a phishing website or a legitimate one. The <a href="https://www.openml.org/search?type=data&amp;status=active&amp;id=46722">dataset</a> id on the <a href="https://github.com/JuliaAI/OpenML.jl"><code>OpenML</code></a> repository is 46722.</p><pre><code class="language-julia hljs">using OpenML: OpenML
using DataFrames: DataFrames

data = Array(DataFrames.DataFrame(OpenML.load(46722)))
X = Matrix{Float64}(data[:, 2:end])
y = Vector{Bool}(data[:, end])
nothing</code></pre><p>The features start from the seoncd column, while the last column are the class labels.</p><p>Let&#39;s also apply some basic pre-processing.</p><pre><code class="language-julia hljs">using Statistics

X = (X .- mean(X; dims=2)) ./ std(X; dims=2)
X = hcat(X, ones(size(X, 1)))
nothing</code></pre><p>Let&#39;s now istantiate the model and set up automatic differentiation using <a href="https://github.com/tpapp/LogDensityProblemsAD.jl?tab=readme-ov-file"><code>LogDensityProblemsAD</code></a>.</p><pre><code class="language-julia hljs">using ADTypes, ReverseDiff
using LogDensityProblemsAD

prob = LogReg(X, y, size(X, 1))
prob_ad = LogDensityProblemsAD.ADgradient(
    ADTypes.AutoReverseDiff(), prob; x=randn(LogDensityProblems.dimension(prob))
)
nothing</code></pre><p>To enable subsampling, <code>LogReg</code> has to implement the method <code>AdvancedVI.subsample</code>. For our model, this is fairly simple: We only need to select the rows of <code>X</code> and the elements of <code>y</code> corresponding to the batch of data points. As subtle point here is that we wrapped <code>prob</code> with <code>LogDensityProblemsAD.ADgradient</code> into <code>prob_ad</code>. Therefore, <code>AdvancedVI</code> sees <code>prob_ad</code> and not <code>prob</code>. This means we have to specialize <code>AdvancedVI.subsample</code> to <code>typeof(prob_ad)</code> and not <code>LogReg</code>.</p><pre><code class="language-julia hljs">using Accessors
using AdvancedVI

function AdvancedVI.subsample(prob::typeof(prob_ad), idx)
    (; X, y, n_data) = parent(prob_ad)
    prob′ = @set prob.ℓ.X = X[idx, :]
    prob′′ = @set prob′.ℓ.y = y[idx]
    return prob′′
end
nothing</code></pre><div class="admonition is-info" id="Info-2ff349d416b1f545"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-2ff349d416b1f545" title="Permalink"></a></header><div class="admonition-body"><p>The default implementation of <code>AdvancedVI.subsample</code> is <code>AdvancedVI.subsample(model, idx) = model</code>. Therefore, if the specialization of <code>AdvancedVI.subsample</code> is not set up properly, <code>AdvancedVI</code> will silently use full-batch gradients instead of subsampling. It is thus useful to check whether the right specialization of <code>AdvancedVI.subsample</code> is being called.</p></div></div><h2 id="Scalable-Inference-via-AdvancedVI"><a class="docs-heading-anchor" href="#Scalable-Inference-via-AdvancedVI">Scalable Inference via AdvancedVI</a><a id="Scalable-Inference-via-AdvancedVI-1"></a><a class="docs-heading-anchor-permalink" href="#Scalable-Inference-via-AdvancedVI" title="Permalink"></a></h2><p>In this example, we will compare the convergence speed of <code>KLMinRepGradProxDescent</code> with and without subsampling. Subsampling can be turned on by supplying a subsampling strategy. Here, we will use <code>ReshufflingBatchSubsampling</code>, which implements random reshuffling. We will us a batch size of 32, which results in <code>313 = length(subsampling) = ceil(Int, size(X,2)/32)</code> steps per epoch.</p><pre><code class="language-julia hljs">dataset = 1:size(prob.X, 1)
batchsize = 32
subsampling = ReshufflingBatchSubsampling(dataset, batchsize)
alg_sub = KLMinRepGradProxDescent(ADTypes.AutoReverseDiff(; compile=true); subsampling)
nothing</code></pre><p>Recall that each epoch is 313 steps. When using <code>ReshufflingBatchSubsampling</code>, it is best to choose the number of iterations to be a multiple of the number of steps <code>length(subsampling)</code> in an epoch. This is due to a peculiar property of <code>ReshufflingBatchSubsampling</code>: the objective value tends to <em>increase</em> during an epoch, and come down nearing the end. (Theoretically, this is due to conditionally <em>biased</em> nature of random reshuffling<sup class="footnote-reference"><a id="citeref-MKR2020" href="#footnote-MKR2020" class="footnote-ref">[MKR2020]</a><span class="footnote-preview" id="fn-MKR2020"></span></sup>.) Therefore, the objective value is minimized exactly after the last step of each epoch.</p><pre><code class="language-julia hljs">num_epochs = 10
max_iter = num_epochs * length(subsampling)
nothing</code></pre><p>If we don&#39;t supply a subsampling strategy to <code>KLMinRepGradProxDescent</code>, subsampling will not be used.</p><pre><code class="language-julia hljs">alg_full = KLMinRepGradProxDescent(ADTypes.AutoReverseDiff(; compile=true))
nothing</code></pre><p>The variational family will be set up as follows:</p><pre><code class="language-julia hljs">using LinearAlgebra

d = LogDensityProblems.dimension(prob_ad)
q = FullRankGaussian(zeros(d), LowerTriangular(Matrix{Float64}(0.6*I, d, d)))
nothing</code></pre><p>It now remains to run VI. For comparison, we will record both the ELBO (with a large number of Monte Carlo samples) and the prediction accuracy.</p><pre><code class="language-julia hljs">using StatsFuns: StatsFuns

logging_interval = 100
time_begin = nothing

&quot;&quot;&quot;
    logistic_prediction(X, μ_β, Σ_β)

Approximate the posterior predictive probability for a logistic link function using Mackay&#39;s approximation (Bishop p. 220).
&quot;&quot;&quot;
function logistic_prediction(X, μ_β, Σ_β)
    xtΣx = sum((prob.X*Σ_β) .* prob.X; dims=2)[:, 1]
    κ = @. 1/sqrt(1 + π/8*xtΣx)
    return StatsFuns.logistic.(κ .* X*μ_β)
end

function callback(; iteration, averaged_params, restructure, kwargs...)
    if mod(iteration, logging_interval) == 1

        # Use the averaged parameters (the eventual output of the algorithm)
        q_avg = restructure(averaged_params)

        # Compute predictions using
        μ_β = mean(q_avg)[1:(end - 1)] # posterior mean of β
        Σ_β = cov(q_avg)[1:(end - 1), end - 1] # marginal posterior covariance of β
        y_pred = logistic_prediction(X, μ_β, Σ_β) .&gt; 0.5

        # Prediction accuracy
        acc = mean(y_pred .== prob.y)

        # Higher fidelity estimate of the ELBO on the averaged parameters
        n_samples = 256
        elbo_callback = -estimate_objective(alg_full, q_avg, prob; n_samples)

        (elbo_callback=elbo_callback, accuracy=acc, time_elapsed=time() - time_begin)
    else
        nothing
    end
end

time_begin = time()
_, info_full, _ = AdvancedVI.optimize(
    alg_full, max_iter, prob_ad, q; show_progress=true, callback
);

time_begin = time()
_, info_sub, _ = AdvancedVI.optimize(
    alg_sub, max_iter, prob_ad, q; show_progress=true, callback
);
nothing</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Optimizing   0%|                               |  ETA: 0:36:49 ( 0.71  s/it)
        elbo: -9356.59356654921
   iteration: 2

Optimizing   3%|▉                              |  ETA: 0:01:34 (30.75 ms/it)
        elbo: -15111.828515326959
   iteration: 85

Optimizing   4%|█▎                             |  ETA: 0:01:10 (23.23 ms/it)
        elbo: -14440.713993879863
   iteration: 132

Optimizing   5%|█▍                             |  ETA: 0:01:05 (21.87 ms/it)
        elbo: -6500.325487583584
   iteration: 145

Optimizing   5%|█▋                             |  ETA: 0:01:02 (20.72 ms/it)
        elbo: -8751.925767067098
   iteration: 158

Optimizing   5%|█▊                             |  ETA: 0:00:59 (19.79 ms/it)
        elbo: -7205.124447961784
   iteration: 171

Optimizing   6%|█▉                             |  ETA: 0:00:56 (18.97 ms/it)
        elbo: -6880.822802482295
   iteration: 184

Optimizing   6%|██                             |  ETA: 0:00:54 (18.25 ms/it)
        elbo: -12575.17385040841
   iteration: 197

Optimizing   7%|██▏                            |  ETA: 0:00:53 (18.06 ms/it)
        elbo: -8935.372690458493
   iteration: 209

Optimizing   7%|██▎                            |  ETA: 0:00:51 (17.46 ms/it)
        elbo: -8535.23178626352
   iteration: 222

Optimizing   8%|██▍                            |  ETA: 0:00:49 (16.90 ms/it)
        elbo: -14758.81703073961
   iteration: 236

Optimizing   8%|██▌                            |  ETA: 0:00:48 (16.49 ms/it)
        elbo: -6193.705736488172
   iteration: 248

Optimizing   8%|██▋                            |  ETA: 0:00:46 (16.13 ms/it)
        elbo: -7244.402874987596
   iteration: 260

Optimizing   9%|██▊                            |  ETA: 0:00:45 (15.73 ms/it)
        elbo: -7235.702610508282
   iteration: 273

Optimizing   9%|██▉                            |  ETA: 0:00:44 (15.40 ms/it)
        elbo: -13161.270645614833
   iteration: 286

Optimizing  10%|███                            |  ETA: 0:00:43 (15.08 ms/it)
        elbo: -6551.287656584947
   iteration: 299

Optimizing  10%|███▏                           |  ETA: 0:00:43 (15.10 ms/it)
        elbo: -8611.822741001135
   iteration: 310

Optimizing  10%|███▎                           |  ETA: 0:00:42 (14.82 ms/it)
        elbo: -8311.804449427198
   iteration: 323

Optimizing  11%|███▍                           |  ETA: 0:00:41 (14.55 ms/it)
        elbo: -7558.2826030722335
   iteration: 336

Optimizing  11%|███▌                           |  ETA: 0:00:40 (14.30 ms/it)
        elbo: -9125.573776351483
   iteration: 349

Optimizing  12%|███▋                           |  ETA: 0:00:39 (14.07 ms/it)
        elbo: -6670.662722668018
   iteration: 362

Optimizing  12%|███▊                           |  ETA: 0:00:38 (13.86 ms/it)
        elbo: -6911.6624863921825
   iteration: 375

Optimizing  12%|███▉                           |  ETA: 0:00:37 (13.64 ms/it)
        elbo: -6532.980686143746
   iteration: 389

Optimizing  13%|████                           |  ETA: 0:00:37 (13.68 ms/it)
   elbo_callback: -7225.459278347138
        accuracy: 0.6949
    time_elapsed: 5.610763072967529
            elbo: -7383.630514530558
       iteration: 401




Optimizing  13%|████▏                          |  ETA: 0:00:37 (13.48 ms/it)
        elbo: -8942.392920170476
   iteration: 415

Optimizing  14%|████▎                          |  ETA: 0:00:36 (13.31 ms/it)
        elbo: -7104.102120573888
   iteration: 428

Optimizing  14%|████▍                          |  ETA: 0:00:35 (13.12 ms/it)
        elbo: -6687.231156769003
   iteration: 442

Optimizing  15%|████▌                          |  ETA: 0:00:35 (12.98 ms/it)
        elbo: -6643.161073052768
   iteration: 455

Optimizing  15%|████▋                          |  ETA: 0:00:34 (12.84 ms/it)
        elbo: -6957.7621171680485
   iteration: 468

Optimizing  15%|████▊                          |  ETA: 0:00:34 (12.71 ms/it)
        elbo: -6546.755746141101
   iteration: 481

Optimizing  16%|████▉                          |  ETA: 0:00:33 (12.59 ms/it)
        elbo: -6837.238738633172
   iteration: 494

Optimizing  16%|█████                          |  ETA: 0:00:33 (12.65 ms/it)
        elbo: -6871.530115497113
   iteration: 507

Optimizing  17%|█████▏                         |  ETA: 0:00:33 (12.53 ms/it)
        elbo: -6649.1789318063675
   iteration: 520

Optimizing  17%|█████▎                         |  ETA: 0:00:32 (12.42 ms/it)
        elbo: -7254.392818447984
   iteration: 533

Optimizing  17%|█████▍                         |  ETA: 0:00:32 (12.31 ms/it)
        elbo: -6604.106049126829
   iteration: 546

Optimizing  18%|█████▌                         |  ETA: 0:00:31 (12.21 ms/it)
        elbo: -6609.557276484481
   iteration: 559

Optimizing  18%|█████▋                         |  ETA: 0:00:31 (12.11 ms/it)
        elbo: -6856.289623875787
   iteration: 572

Optimizing  19%|█████▊                         |  ETA: 0:00:31 (12.02 ms/it)
        elbo: -6867.548611878438
   iteration: 585

Optimizing  19%|█████▉                         |  ETA: 0:00:30 (11.93 ms/it)
        elbo: -7001.973047677638
   iteration: 598

Optimizing  20%|██████                         |  ETA: 0:00:30 (12.00 ms/it)
        elbo: -6041.423683858364
   iteration: 611

Optimizing  20%|██████▎                        |  ETA: 0:00:30 (11.90 ms/it)
        elbo: -6765.332726911221
   iteration: 625

Optimizing  20%|██████▍                        |  ETA: 0:00:29 (11.82 ms/it)
        elbo: -6634.650266715887
   iteration: 638

Optimizing  21%|██████▌                        |  ETA: 0:00:29 (11.76 ms/it)
        elbo: -6847.240840701144
   iteration: 651

Optimizing  21%|██████▋                        |  ETA: 0:00:29 (11.70 ms/it)
        elbo: -6580.030296427062
   iteration: 663

Optimizing  22%|██████▋                        |  ETA: 0:00:29 (11.65 ms/it)
        elbo: -5992.806589798616
   iteration: 675

Optimizing  22%|██████▊                        |  ETA: 0:00:28 (11.60 ms/it)
        elbo: -7107.190471701919
   iteration: 687

Optimizing  22%|██████▉                        |  ETA: 0:00:28 (11.55 ms/it)
        elbo: -6485.76791867536
   iteration: 699

Optimizing  23%|███████                        |  ETA: 0:00:28 (11.62 ms/it)
        elbo: -6857.268420498762
   iteration: 710

Optimizing  23%|███████▏                       |  ETA: 0:00:28 (11.55 ms/it)
        elbo: -7257.16699468676
   iteration: 724

Optimizing  24%|███████▎                       |  ETA: 0:00:27 (11.48 ms/it)
        elbo: -6743.376198609273
   iteration: 737

Optimizing  24%|███████▍                       |  ETA: 0:00:27 (11.42 ms/it)
        elbo: -6148.678334765753
   iteration: 750

Optimizing  24%|███████▌                       |  ETA: 0:00:27 (11.36 ms/it)
        elbo: -6675.071619312537
   iteration: 763

Optimizing  25%|███████▋                       |  ETA: 0:00:27 (11.30 ms/it)
        elbo: -6552.057125508866
   iteration: 776

Optimizing  25%|███████▉                       |  ETA: 0:00:26 (11.24 ms/it)
        elbo: -6666.657475321374
   iteration: 789

Optimizing  26%|████████                       |  ETA: 0:00:26 (11.29 ms/it)
        elbo: -7500.041346922498
   iteration: 802

Optimizing  26%|████████▏                      |  ETA: 0:00:26 (11.24 ms/it)
        elbo: -6716.87799244348
   iteration: 815

Optimizing  26%|████████▎                      |  ETA: 0:00:26 (11.20 ms/it)
        elbo: -7165.070168065636
   iteration: 828

Optimizing  27%|████████▍                      |  ETA: 0:00:26 (11.16 ms/it)
        elbo: -7577.147039016881
   iteration: 840

Optimizing  27%|████████▌                      |  ETA: 0:00:25 (11.11 ms/it)
        elbo: -6641.94081000446
   iteration: 853

Optimizing  28%|████████▋                      |  ETA: 0:00:25 (11.07 ms/it)
        elbo: -7736.46330535431
   iteration: 866

Optimizing  28%|████████▊                      |  ETA: 0:00:25 (11.02 ms/it)
        elbo: -6100.468966099989
   iteration: 879

Optimizing  28%|████████▉                      |  ETA: 0:00:25 (10.98 ms/it)
        elbo: -7184.243360520983
   iteration: 892

Optimizing  29%|█████████                      |  ETA: 0:00:25 (11.03 ms/it)
        elbo: -6174.018090967365
   iteration: 905

Optimizing  29%|█████████▏                     |  ETA: 0:00:24 (10.99 ms/it)
        elbo: -6551.530264430922
   iteration: 918

Optimizing  30%|█████████▎                     |  ETA: 0:00:24 (10.95 ms/it)
        elbo: -6973.556589038524
   iteration: 931

Optimizing  30%|█████████▍                     |  ETA: 0:00:24 (10.91 ms/it)
        elbo: -6733.093564719938
   iteration: 944

Optimizing  31%|█████████▌                     |  ETA: 0:00:24 (10.87 ms/it)
        elbo: -6220.997223984965
   iteration: 957

Optimizing  31%|█████████▋                     |  ETA: 0:00:23 (10.83 ms/it)
        elbo: -6478.6109683829045
   iteration: 970

Optimizing  31%|█████████▊                     |  ETA: 0:00:23 (10.80 ms/it)
        elbo: -6547.4896913472685
   iteration: 983

Optimizing  32%|█████████▉                     |  ETA: 0:00:23 (10.76 ms/it)
        elbo: -6145.776793927521
   iteration: 996

Optimizing  32%|██████████                     |  ETA: 0:00:23 (10.81 ms/it)
        elbo: -6625.660326410236
   iteration: 1009

Optimizing  33%|██████████▏                    |  ETA: 0:00:23 (10.78 ms/it)
        elbo: -6107.729533458727
   iteration: 1022

Optimizing  33%|██████████▎                    |  ETA: 0:00:22 (10.74 ms/it)
        elbo: -6270.025726606791
   iteration: 1035

Optimizing  33%|██████████▍                    |  ETA: 0:00:22 (10.70 ms/it)
        elbo: -6361.458945206097
   iteration: 1048

Optimizing  34%|██████████▌                    |  ETA: 0:00:22 (10.67 ms/it)
        elbo: -7877.1562125809005
   iteration: 1061

Optimizing  34%|██████████▋                    |  ETA: 0:00:22 (10.64 ms/it)
        elbo: -8416.329994216907
   iteration: 1074

Optimizing  35%|██████████▊                    |  ETA: 0:00:22 (10.61 ms/it)
        elbo: -8414.723998478721
   iteration: 1087

Optimizing  35%|██████████▉                    |  ETA: 0:00:21 (10.58 ms/it)
        elbo: -6146.429762179672
   iteration: 1100

Optimizing  35%|███████████                    |  ETA: 0:00:21 (10.63 ms/it)
        elbo: -6215.993419277778
   iteration: 1111

Optimizing  36%|███████████▏                   |  ETA: 0:00:21 (10.60 ms/it)
        elbo: -6336.56791010024
   iteration: 1125

Optimizing  36%|███████████▎                   |  ETA: 0:00:21 (10.56 ms/it)
        elbo: -6668.390007722402
   iteration: 1139

Optimizing  37%|███████████▍                   |  ETA: 0:00:21 (10.52 ms/it)
        elbo: -5894.763089617304
   iteration: 1153

Optimizing  37%|███████████▌                   |  ETA: 0:00:21 (10.49 ms/it)
        elbo: -6320.449948686333
   iteration: 1166

Optimizing  38%|███████████▋                   |  ETA: 0:00:20 (10.46 ms/it)
        elbo: -5975.489949494461
   iteration: 1180

Optimizing  38%|███████████▉                   |  ETA: 0:00:20 (10.43 ms/it)
        elbo: -9218.021362766302
   iteration: 1194

Optimizing  39%|████████████                   |  ETA: 0:00:20 (10.47 ms/it)
        elbo: -6474.263967724834
   iteration: 1206

Optimizing  39%|████████████▏                  |  ETA: 0:00:20 (10.44 ms/it)
        elbo: -6640.765049045935
   iteration: 1220

Optimizing  39%|████████████▎                  |  ETA: 0:00:20 (10.41 ms/it)
        elbo: -6874.256355792439
   iteration: 1234

Optimizing  40%|████████████▍                  |  ETA: 0:00:20 (10.38 ms/it)
        elbo: -6281.767645827445
   iteration: 1248

Optimizing  40%|████████████▌                  |  ETA: 0:00:19 (10.35 ms/it)
        elbo: -6802.006491102048
   iteration: 1262

Optimizing  41%|████████████▋                  |  ETA: 0:00:19 (10.32 ms/it)
        elbo: -6554.888018989937
   iteration: 1276

Optimizing  41%|████████████▊                  |  ETA: 0:00:19 (10.29 ms/it)
        elbo: -6310.431410449108
   iteration: 1290

Optimizing  42%|████████████▉                  |  ETA: 0:00:19 (10.33 ms/it)
        elbo: -6688.333134427928
   iteration: 1302

Optimizing  42%|█████████████                  |  ETA: 0:00:19 (10.30 ms/it)
        elbo: -6406.0417583223225
   iteration: 1316

Optimizing  42%|█████████████▏                 |  ETA: 0:00:18 (10.27 ms/it)
        elbo: -5616.755835919212
   iteration: 1330

Optimizing  43%|█████████████▎                 |  ETA: 0:00:18 (10.24 ms/it)
        elbo: -12527.221000442727
   iteration: 1344

Optimizing  43%|█████████████▌                 |  ETA: 0:00:18 (10.22 ms/it)
        elbo: -8550.465200681467
   iteration: 1358

Optimizing  44%|█████████████▋                 |  ETA: 0:00:18 (10.19 ms/it)
        elbo: -7329.218605604353
   iteration: 1372

Optimizing  44%|█████████████▊                 |  ETA: 0:00:18 (10.17 ms/it)
        elbo: -6387.761898515885
   iteration: 1386

Optimizing  45%|█████████████▉                 |  ETA: 0:00:18 (10.14 ms/it)
        elbo: -9384.330771405002
   iteration: 1400

Optimizing  45%|██████████████                 |  ETA: 0:00:17 (10.18 ms/it)
        elbo: -6221.593802139213
   iteration: 1413

Optimizing  46%|██████████████▏                |  ETA: 0:00:17 (10.16 ms/it)
        elbo: -6194.384760159521
   iteration: 1426

Optimizing  46%|██████████████▎                |  ETA: 0:00:17 (10.14 ms/it)
        elbo: -9181.982240900661
   iteration: 1440

Optimizing  46%|██████████████▍                |  ETA: 0:00:17 (10.11 ms/it)
        elbo: -7223.329094610667
   iteration: 1454

Optimizing  47%|██████████████▌                |  ETA: 0:00:17 (10.09 ms/it)
        elbo: -7081.416719056602
   iteration: 1468

Optimizing  47%|██████████████▋                |  ETA: 0:00:17 (10.06 ms/it)
        elbo: -6955.609385968383
   iteration: 1482

Optimizing  48%|██████████████▉                |  ETA: 0:00:16 (10.04 ms/it)
        elbo: -6058.680584977976
   iteration: 1496

Optimizing  48%|██████████████▉                |  ETA: 0:00:16 (10.08 ms/it)
        elbo: -6932.993502889098
   iteration: 1508

Optimizing  49%|███████████████▏               |  ETA: 0:00:16 (10.06 ms/it)
        elbo: -7153.868290436965
   iteration: 1522

Optimizing  49%|███████████████▎               |  ETA: 0:00:16 (10.04 ms/it)
        elbo: -6578.772820528871
   iteration: 1536

Optimizing  50%|███████████████▍               |  ETA: 0:00:16 (10.01 ms/it)
        elbo: -6158.706931013623
   iteration: 1550

Optimizing  50%|███████████████▌               |  ETA: 0:00:16 ( 9.99 ms/it)
        elbo: -6570.916911267965
   iteration: 1564

Optimizing  50%|███████████████▋               |  ETA: 0:00:15 ( 9.97 ms/it)
        elbo: -6760.761536857573
   iteration: 1578

Optimizing  51%|███████████████▊               |  ETA: 0:00:15 ( 9.95 ms/it)
        elbo: -6207.8694925339505
   iteration: 1592

Optimizing  51%|███████████████▉               |  ETA: 0:00:15 ( 9.99 ms/it)
        elbo: -6022.752261572503
   iteration: 1604

Optimizing  52%|████████████████               |  ETA: 0:00:15 ( 9.97 ms/it)
        elbo: -6997.542416276894
   iteration: 1618

Optimizing  52%|████████████████▏              |  ETA: 0:00:15 ( 9.95 ms/it)
        elbo: -6696.618733475789
   iteration: 1632

Optimizing  53%|████████████████▎              |  ETA: 0:00:15 ( 9.93 ms/it)
        elbo: -6869.484126929714
   iteration: 1645

Optimizing  53%|████████████████▍              |  ETA: 0:00:15 ( 9.91 ms/it)
        elbo: -6218.58046437866
   iteration: 1658

Optimizing  53%|████████████████▌              |  ETA: 0:00:14 ( 9.90 ms/it)
        elbo: -6295.977105970306
   iteration: 1671

Optimizing  54%|████████████████▊              |  ETA: 0:00:14 ( 9.88 ms/it)
        elbo: -8532.658099680471
   iteration: 1685

Optimizing  54%|████████████████▉              |  ETA: 0:00:14 ( 9.86 ms/it)
        elbo: -6176.277086202863
   iteration: 1698

Optimizing  55%|████████████████▉              |  ETA: 0:00:14 ( 9.90 ms/it)
        elbo: -6192.464888822974
   iteration: 1710

Optimizing  55%|█████████████████▏             |  ETA: 0:00:14 ( 9.88 ms/it)
        elbo: -7140.514121250354
   iteration: 1723

Optimizing  55%|█████████████████▎             |  ETA: 0:00:14 ( 9.87 ms/it)
        elbo: -5858.578503378121
   iteration: 1737

Optimizing  56%|█████████████████▍             |  ETA: 0:00:14 ( 9.85 ms/it)
        elbo: -5889.836259916851
   iteration: 1750

Optimizing  56%|█████████████████▌             |  ETA: 0:00:13 ( 9.84 ms/it)
        elbo: -6268.050647525025
   iteration: 1763

Optimizing  57%|█████████████████▋             |  ETA: 0:00:13 ( 9.82 ms/it)
        elbo: -6264.233053159131
   iteration: 1777

Optimizing  57%|█████████████████▊             |  ETA: 0:00:13 ( 9.80 ms/it)
        elbo: -6367.661644340076
   iteration: 1790

Optimizing  58%|█████████████████▉             |  ETA: 0:00:13 ( 9.85 ms/it)
        elbo: -9234.261602695742
   iteration: 1803

Optimizing  58%|██████████████████             |  ETA: 0:00:13 ( 9.83 ms/it)
        elbo: -6084.816079176313
   iteration: 1816

Optimizing  58%|██████████████████▏            |  ETA: 0:00:13 ( 9.82 ms/it)
        elbo: -5843.339617760602
   iteration: 1829

Optimizing  59%|██████████████████▎            |  ETA: 0:00:13 ( 9.80 ms/it)
        elbo: -6665.396000750015
   iteration: 1843

Optimizing  59%|██████████████████▍            |  ETA: 0:00:12 ( 9.79 ms/it)
        elbo: -5774.7404233390935
   iteration: 1857

Optimizing  60%|██████████████████▌            |  ETA: 0:00:12 ( 9.77 ms/it)
        elbo: -6679.254663480368
   iteration: 1870

Optimizing  60%|██████████████████▋            |  ETA: 0:00:12 ( 9.76 ms/it)
        elbo: -7532.219815064793
   iteration: 1884

Optimizing  61%|██████████████████▊            |  ETA: 0:00:12 ( 9.75 ms/it)
        elbo: -6203.983031790393
   iteration: 1898

Optimizing  61%|██████████████████▉            |  ETA: 0:00:12 ( 9.78 ms/it)
        elbo: -6280.455338855392
   iteration: 1910

Optimizing  61%|███████████████████            |  ETA: 0:00:12 ( 9.76 ms/it)
        elbo: -6257.38767245659
   iteration: 1924

Optimizing  62%|███████████████████▎           |  ETA: 0:00:12 ( 9.75 ms/it)
        elbo: -6737.098149713835
   iteration: 1938

Optimizing  62%|███████████████████▍           |  ETA: 0:00:11 ( 9.73 ms/it)
        elbo: -6307.883695088048
   iteration: 1951

Optimizing  63%|███████████████████▌           |  ETA: 0:00:11 ( 9.72 ms/it)
        elbo: -6670.5128057368975
   iteration: 1965

Optimizing  63%|███████████████████▋           |  ETA: 0:00:11 ( 9.71 ms/it)
        elbo: -9756.559586464075
   iteration: 1978

Optimizing  64%|███████████████████▊           |  ETA: 0:00:11 ( 9.69 ms/it)
        elbo: -6493.167773549531
   iteration: 1991

Optimizing  64%|███████████████████▉           |  ETA: 0:00:11 ( 9.73 ms/it)
        elbo: -6094.657953495406
   iteration: 2004

Optimizing  64%|████████████████████           |  ETA: 0:00:11 ( 9.72 ms/it)
        elbo: -5490.787413628816
   iteration: 2018

Optimizing  65%|████████████████████▏          |  ETA: 0:00:11 ( 9.70 ms/it)
        elbo: -6727.898832050397
   iteration: 2031

Optimizing  65%|████████████████████▎          |  ETA: 0:00:11 ( 9.70 ms/it)
        elbo: -6001.571833405069
   iteration: 2044

Optimizing  66%|████████████████████▍          |  ETA: 0:00:10 ( 9.68 ms/it)
        elbo: -6380.922466367082
   iteration: 2057

Optimizing  66%|████████████████████▌          |  ETA: 0:00:10 ( 9.67 ms/it)
        elbo: -7056.488447259748
   iteration: 2070

Optimizing  67%|████████████████████▋          |  ETA: 0:00:10 ( 9.67 ms/it)
        elbo: -5796.464401517496
   iteration: 2083

Optimizing  67%|████████████████████▊          |  ETA: 0:00:10 ( 9.65 ms/it)
        elbo: -7235.776530356575
   iteration: 2097

Optimizing  67%|████████████████████▉          |  ETA: 0:00:10 ( 9.68 ms/it)
        elbo: -6198.605095989847
   iteration: 2109

Optimizing  68%|█████████████████████          |  ETA: 0:00:10 ( 9.67 ms/it)
        elbo: -8720.866256264293
   iteration: 2123

Optimizing  68%|█████████████████████▏         |  ETA: 0:00:10 ( 9.66 ms/it)
        elbo: -6756.043288282399
   iteration: 2135

Optimizing  69%|█████████████████████▎         |  ETA: 0:00:09 ( 9.65 ms/it)
        elbo: -7871.748806797507
   iteration: 2149

Optimizing  69%|█████████████████████▍         |  ETA: 0:00:09 ( 9.64 ms/it)
        elbo: -5316.483533229995
   iteration: 2162

Optimizing  70%|█████████████████████▌         |  ETA: 0:00:09 ( 9.63 ms/it)
        elbo: -6104.992095520642
   iteration: 2176

Optimizing  70%|█████████████████████▊         |  ETA: 0:00:09 ( 9.62 ms/it)
        elbo: -5628.430411432999
   iteration: 2190

Optimizing  70%|█████████████████████▊         |  ETA: 0:00:09 ( 9.64 ms/it)
        elbo: -5721.513039424283
   iteration: 2202

Optimizing  71%|██████████████████████         |  ETA: 0:00:09 ( 9.63 ms/it)
        elbo: -6553.414271428578
   iteration: 2216

Optimizing  71%|██████████████████████▏        |  ETA: 0:00:09 ( 9.62 ms/it)
        elbo: -5917.964663661413
   iteration: 2230

Optimizing  72%|██████████████████████▎        |  ETA: 0:00:09 ( 9.61 ms/it)
        elbo: -6509.093787289839
   iteration: 2243

Optimizing  72%|██████████████████████▍        |  ETA: 0:00:08 ( 9.59 ms/it)
        elbo: -6317.14242294098
   iteration: 2257

Optimizing  73%|██████████████████████▌        |  ETA: 0:00:08 ( 9.58 ms/it)
        elbo: -5879.137905339166
   iteration: 2271

Optimizing  73%|██████████████████████▋        |  ETA: 0:00:08 ( 9.57 ms/it)
        elbo: -6490.5764726024245
   iteration: 2285

Optimizing  73%|██████████████████████▊        |  ETA: 0:00:08 ( 9.56 ms/it)
        elbo: -5943.555070183746
   iteration: 2298

Optimizing  74%|██████████████████████▉        |  ETA: 0:00:08 ( 9.59 ms/it)
        elbo: -5428.409097089798
   iteration: 2311

Optimizing  74%|███████████████████████        |  ETA: 0:00:08 ( 9.58 ms/it)
        elbo: -7039.038154215037
   iteration: 2325

Optimizing  75%|███████████████████████▏       |  ETA: 0:00:08 ( 9.57 ms/it)
        elbo: -6882.353735202386
   iteration: 2338

Optimizing  75%|███████████████████████▎       |  ETA: 0:00:07 ( 9.56 ms/it)
        elbo: -6671.677324468095
   iteration: 2352

Optimizing  76%|███████████████████████▍       |  ETA: 0:00:07 ( 9.55 ms/it)
        elbo: -5572.636069531704
   iteration: 2365

Optimizing  76%|███████████████████████▌       |  ETA: 0:00:07 ( 9.54 ms/it)
        elbo: -8571.759872335839
   iteration: 2379

Optimizing  76%|███████████████████████▊       |  ETA: 0:00:07 ( 9.53 ms/it)
        elbo: -5915.234762038838
   iteration: 2393

Optimizing  77%|███████████████████████▉       |  ETA: 0:00:07 ( 9.56 ms/it)
        elbo: -6184.400176964339
   iteration: 2406

Optimizing  77%|████████████████████████       |  ETA: 0:00:07 ( 9.55 ms/it)
        elbo: -6121.949577648715
   iteration: 2420

Optimizing  78%|████████████████████████▏      |  ETA: 0:00:07 ( 9.54 ms/it)
        elbo: -5942.485028432902
   iteration: 2432

Optimizing  78%|████████████████████████▎      |  ETA: 0:00:07 ( 9.53 ms/it)
        elbo: -5962.046167132416
   iteration: 2446

Optimizing  79%|████████████████████████▍      |  ETA: 0:00:06 ( 9.52 ms/it)
        elbo: -17385.114189391956
   iteration: 2460

Optimizing  79%|████████████████████████▌      |  ETA: 0:00:06 ( 9.51 ms/it)
        elbo: -14344.045409989558
   iteration: 2474

Optimizing  79%|████████████████████████▋      |  ETA: 0:00:06 ( 9.50 ms/it)
        elbo: -6987.83930631434
   iteration: 2488

Optimizing  80%|████████████████████████▊      |  ETA: 0:00:06 ( 9.53 ms/it)
   elbo_callback: -5873.277168052161
        accuracy: 0.7899
    time_elapsed: 23.955615997314453
            elbo: -5342.797526760882
       iteration: 2501




Optimizing  80%|████████████████████████▉      |  ETA: 0:00:06 ( 9.52 ms/it)
        elbo: -6058.355000962206
   iteration: 2514

Optimizing  81%|█████████████████████████      |  ETA: 0:00:06 ( 9.51 ms/it)
        elbo: -9163.008866075097
   iteration: 2528

Optimizing  81%|█████████████████████████▏     |  ETA: 0:00:06 ( 9.50 ms/it)
        elbo: -6016.580379838655
   iteration: 2542

Optimizing  82%|█████████████████████████▎     |  ETA: 0:00:05 ( 9.49 ms/it)
        elbo: -7077.037149377364
   iteration: 2555

Optimizing  82%|█████████████████████████▌     |  ETA: 0:00:05 ( 9.48 ms/it)
        elbo: -5726.002379696574
   iteration: 2569

Optimizing  82%|█████████████████████████▋     |  ETA: 0:00:05 ( 9.48 ms/it)
        elbo: -8972.640290518524
   iteration: 2582

Optimizing  83%|█████████████████████████▊     |  ETA: 0:00:05 ( 9.47 ms/it)
        elbo: -7881.605387529482
   iteration: 2595

Optimizing  83%|█████████████████████████▉     |  ETA: 0:00:05 ( 9.50 ms/it)
        elbo: -5637.243452448886
   iteration: 2607

Optimizing  84%|██████████████████████████     |  ETA: 0:00:05 ( 9.49 ms/it)
        elbo: -5834.50845054299
   iteration: 2620

Optimizing  84%|██████████████████████████▏    |  ETA: 0:00:05 ( 9.49 ms/it)
        elbo: -8161.515941217956
   iteration: 2633

Optimizing  85%|██████████████████████████▎    |  ETA: 0:00:05 ( 9.48 ms/it)
        elbo: -5436.071182688735
   iteration: 2646

Optimizing  85%|██████████████████████████▍    |  ETA: 0:00:04 ( 9.47 ms/it)
        elbo: -6274.886602198609
   iteration: 2659

Optimizing  85%|██████████████████████████▌    |  ETA: 0:00:04 ( 9.47 ms/it)
        elbo: -12186.343609251395
   iteration: 2671

Optimizing  86%|██████████████████████████▋    |  ETA: 0:00:04 ( 9.47 ms/it)
        elbo: -5946.74225974801
   iteration: 2683

Optimizing  86%|██████████████████████████▊    |  ETA: 0:00:04 ( 9.46 ms/it)
        elbo: -5567.611665275007
   iteration: 2696

Optimizing  87%|██████████████████████████▉    |  ETA: 0:00:04 ( 9.49 ms/it)
        elbo: -5884.672869764564
   iteration: 2709

Optimizing  87%|███████████████████████████    |  ETA: 0:00:04 ( 9.48 ms/it)
        elbo: -7567.002743094601
   iteration: 2723

Optimizing  87%|███████████████████████████▏   |  ETA: 0:00:04 ( 9.47 ms/it)
        elbo: -5543.730588832403
   iteration: 2737

Optimizing  88%|███████████████████████████▎   |  ETA: 0:00:04 ( 9.46 ms/it)
        elbo: -5361.069507105631
   iteration: 2750

Optimizing  88%|███████████████████████████▍   |  ETA: 0:00:03 ( 9.45 ms/it)
        elbo: -6731.185549244058
   iteration: 2763

Optimizing  89%|███████████████████████████▌   |  ETA: 0:00:03 ( 9.44 ms/it)
        elbo: -5382.212115255651
   iteration: 2776

Optimizing  89%|███████████████████████████▋   |  ETA: 0:00:03 ( 9.44 ms/it)
        elbo: -5583.913698660188
   iteration: 2789

Optimizing  90%|███████████████████████████▊   |  ETA: 0:00:03 ( 9.46 ms/it)
        elbo: -5502.857049652784
   iteration: 2802

Optimizing  90%|███████████████████████████▉   |  ETA: 0:00:03 ( 9.45 ms/it)
        elbo: -6943.237679853247
   iteration: 2815

Optimizing  90%|████████████████████████████   |  ETA: 0:00:03 ( 9.44 ms/it)
        elbo: -6685.3077689156435
   iteration: 2828

Optimizing  91%|████████████████████████████▏  |  ETA: 0:00:03 ( 9.44 ms/it)
        elbo: -5687.374679323368
   iteration: 2842

Optimizing  91%|████████████████████████████▎  |  ETA: 0:00:03 ( 9.43 ms/it)
        elbo: -5733.033689135175
   iteration: 2856

Optimizing  92%|████████████████████████████▍  |  ETA: 0:00:02 ( 9.42 ms/it)
        elbo: -6164.204856853362
   iteration: 2870

Optimizing  92%|████████████████████████████▋  |  ETA: 0:00:02 ( 9.41 ms/it)
        elbo: -6529.1432036884435
   iteration: 2884

Optimizing  93%|████████████████████████████▊  |  ETA: 0:00:02 ( 9.40 ms/it)
        elbo: -6081.186402029909
   iteration: 2898

Optimizing  93%|████████████████████████████▉  |  ETA: 0:00:02 ( 9.43 ms/it)
        elbo: -5456.4222818231565
   iteration: 2910

Optimizing  93%|█████████████████████████████  |  ETA: 0:00:02 ( 9.42 ms/it)
        elbo: -9917.538677322476
   iteration: 2924

Optimizing  94%|█████████████████████████████▏ |  ETA: 0:00:02 ( 9.41 ms/it)
        elbo: -7559.710657448852
   iteration: 2938

Optimizing  94%|█████████████████████████████▎ |  ETA: 0:00:02 ( 9.40 ms/it)
        elbo: -5611.278732023706
   iteration: 2952

Optimizing  95%|█████████████████████████████▍ |  ETA: 0:00:02 ( 9.39 ms/it)
        elbo: -5456.94879846191
   iteration: 2966

Optimizing  95%|█████████████████████████████▌ |  ETA: 0:00:01 ( 9.39 ms/it)
        elbo: -6013.033167730659
   iteration: 2981

Optimizing  96%|█████████████████████████████▋ |  ETA: 0:00:01 ( 9.38 ms/it)
        elbo: -5581.443608373581
   iteration: 2995

Optimizing  96%|█████████████████████████████▊ |  ETA: 0:00:01 ( 9.40 ms/it)
        elbo: -9184.859547648886
   iteration: 3008

Optimizing  97%|█████████████████████████████▉ |  ETA: 0:00:01 ( 9.39 ms/it)
        elbo: -5928.869469015347
   iteration: 3021

Optimizing  97%|██████████████████████████████ |  ETA: 0:00:01 ( 9.38 ms/it)
        elbo: -5921.088401338015
   iteration: 3035

Optimizing  97%|██████████████████████████████▎|  ETA: 0:00:01 ( 9.38 ms/it)
        elbo: -6053.890275450002
   iteration: 3049

Optimizing  98%|██████████████████████████████▍|  ETA: 0:00:01 ( 9.37 ms/it)
        elbo: -5232.234460658985
   iteration: 3063

Optimizing  98%|██████████████████████████████▌|  ETA: 0:00:00 ( 9.37 ms/it)
        elbo: -5378.109871719725
   iteration: 3077

Optimizing  99%|██████████████████████████████▋|  ETA: 0:00:00 ( 9.47 ms/it)
        elbo: -5471.337790532568
   iteration: 3086

Optimizing  99%|██████████████████████████████▋|  ETA: 0:00:00 ( 9.55 ms/it)
        elbo: -5529.899346745905
   iteration: 3088

Optimizing  99%|██████████████████████████████▊|  ETA: 0:00:00 ( 9.55 ms/it)
        elbo: -5916.790595063091
   iteration: 3100

Optimizing  99%|██████████████████████████████▉|  ETA: 0:00:00 ( 9.58 ms/it)
        elbo: -5639.791619073055
   iteration: 3112

Optimizing  99%|███████████████████████████████|  ETA: 0:00:00 ( 9.58 ms/it)
        elbo: -5809.333458392987
   iteration: 3125

Optimizing 100%|███████████████████████████████| Time: 0:00:29 ( 9.57 ms/it)
        elbo: -11072.277612497037
   iteration: 3130
Optimizing   0%|                               |  ETA: 0:17:29 ( 0.34  s/it)
       epoch: 1
        step: 2
        elbo: -10626.852303505006
   iteration: 2



Optimizing   4%|█▍                             |  ETA: 0:00:19 ( 6.36 ms/it)
       epoch: 1
        step: 135
        elbo: -17572.868496392508
   iteration: 135



Optimizing   7%|██                             |  ETA: 0:00:14 ( 4.78 ms/it)
       epoch: 1
        step: 206
        elbo: -10679.975592392038
   iteration: 206



Optimizing  12%|███▊                           |  ETA: 0:00:09 ( 3.19 ms/it)
       epoch: 2
        step: 70
        elbo: -9392.358760491667
   iteration: 383



Optimizing  15%|████▌                          |  ETA: 0:00:08 ( 2.97 ms/it)
       epoch: 2
        step: 145
        elbo: -6452.760066821602
   iteration: 458



Optimizing  16%|█████▏                         |  ETA: 0:00:07 ( 2.86 ms/it)
       epoch: 2
        step: 201
        elbo: -6996.6708764242
   iteration: 514



Optimizing  22%|██████▉                        |  ETA: 0:00:06 ( 2.40 ms/it)
       epoch: 3
        step: 64
        elbo: -7641.75527122943
   iteration: 690



Optimizing  25%|███████▊                       |  ETA: 0:00:05 ( 2.28 ms/it)
       epoch: 3
        step: 161
        elbo: -6215.174200540378
   iteration: 787



Optimizing  27%|████████▌                      |  ETA: 0:00:05 ( 2.24 ms/it)
       epoch: 3
        step: 231
        elbo: -7042.291651935856
   iteration: 857



Optimizing  29%|█████████                      |  ETA: 0:00:05 ( 2.23 ms/it)
       epoch: 3
        step: 287
        elbo: -6818.200628662637
   iteration: 913



Optimizing  35%|██████████▊                    |  ETA: 0:00:04 ( 2.03 ms/it)
       epoch: 4
        step: 150
        elbo: -6110.352275711138
   iteration: 1089



Optimizing  38%|███████████▊                   |  ETA: 0:00:04 ( 1.98 ms/it)
       epoch: 4
        step: 247
        elbo: -6501.454683988143
   iteration: 1186



Optimizing  40%|████████████▌                  |  ETA: 0:00:04 ( 1.97 ms/it)
       epoch: 5
        step: 5
        elbo: -8619.46647120773
   iteration: 1257



Optimizing  42%|█████████████                  |  ETA: 0:00:04 ( 1.97 ms/it)
       epoch: 5
        step: 63
        elbo: -5931.551227559587
   iteration: 1315



Optimizing  48%|██████████████▊                |  ETA: 0:00:03 ( 1.86 ms/it)
       epoch: 5
        step: 236
        elbo: -6126.633134203323
   iteration: 1488



Optimizing  51%|███████████████▊               |  ETA: 0:00:03 ( 1.83 ms/it)
       epoch: 6
        step: 20
        elbo: -6102.5348552087025
   iteration: 1585



Optimizing  53%|████████████████▍              |  ETA: 0:00:03 ( 1.83 ms/it)
       epoch: 6
        step: 92
        elbo: -5661.767287533863
   iteration: 1657



Optimizing  55%|█████████████████              |  ETA: 0:00:03 ( 1.83 ms/it)
       epoch: 6
        step: 150
        elbo: -6545.816721197492
   iteration: 1715



Optimizing  60%|██████████████████▋            |  ETA: 0:00:02 ( 1.76 ms/it)
       epoch: 7
        step: 8
        elbo: -5440.929053854249
   iteration: 1886



Optimizing  63%|███████████████████▋           |  ETA: 0:00:02 ( 1.74 ms/it)
       epoch: 7
        step: 104
        elbo: -6925.067974662637
   iteration: 1982



Optimizing  66%|████████████████████▍          |  ETA: 0:00:02 ( 1.74 ms/it)
       epoch: 7
        step: 175
        elbo: -5465.771177626591
   iteration: 2053



Optimizing  67%|████████████████████▉          |  ETA: 0:00:02 ( 1.75 ms/it)
       epoch: 7
        step: 233
        elbo: -7324.241407018408
   iteration: 2111



Optimizing  73%|██████████████████████▋        |  ETA: 0:00:01 ( 1.70 ms/it)
       epoch: 8
        step: 90
        elbo: -5667.898782424695
   iteration: 2281



Optimizing  76%|███████████████████████▌       |  ETA: 0:00:01 ( 1.68 ms/it)
       epoch: 8
        step: 186
        elbo: -5717.129153214438
   iteration: 2377



Optimizing  78%|████████████████████████▎      |  ETA: 0:00:01 ( 1.68 ms/it)
       epoch: 8
        step: 257
        elbo: -6848.12328745913
   iteration: 2448



Optimizing  80%|████████████████████████▉      |  ETA: 0:00:01 ( 1.69 ms/it)
       epoch: 9
        step: 5
        elbo: -8864.787315104826
   iteration: 2509



Optimizing  86%|██████████████████████████▊    |  ETA: 0:00:01 ( 1.67 ms/it)
       epoch: 9
        step: 201
        elbo: -7400.596292284845
   iteration: 2705



Optimizing  93%|████████████████████████████▊  |  ETA: 0:00:00 ( 1.62 ms/it)
       epoch: 10
        step: 83
        elbo: -5070.529957226258
   iteration: 2900



Optimizing  96%|█████████████████████████████▊ |  ETA: 0:00:00 ( 1.64 ms/it)
       epoch: 10
        step: 186
        elbo: -8168.390844192143
   iteration: 3003



Optimizing 100%|███████████████████████████████| Time: 0:00:05 ( 1.62 ms/it)
       epoch: 10
        step: 313
        elbo: -5490.25483554709
   iteration: 3130</code></pre><p>Let&#39;s visualize the evolution of the ELBO.</p><pre><code class="language-julia hljs">using Plots

t = 1:logging_interval:max_iter
plot(
    [i.iteration for i in info_full[t]],
    [i.elbo_callback for i in info_full[t]];
    xlabel=&quot;Iteration&quot;,
    ylabel=&quot;ELBO&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.iteration for i in info_sub[t]],
    [i.elbo_callback for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_iteration_elbo.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_iteration_elbo.svg" alt/></p><p>According to this plot, it might seem like subsampling has no benefit (if not detrimental). This is, however, because we are plotting against the number of iterations. Subsampling generally converges slower (asymptotically) in terms of iterations. But in return, it reduces the time spent at each iteration. Therefore, we need to plot against the elapsed time:</p><pre><code class="language-julia hljs">plot(
    [i.time_elapsed for i in info_full[t]],
    [i.elbo_callback for i in info_full[t]];
    xlabel=&quot;Wallclock Time (sec)&quot;,
    ylabel=&quot;ELBO&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.time_elapsed for i in info_sub[t]],
    [i.elbo_callback for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_time_elbo.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_time_elbo.svg" alt/></p><p>We can now see the dramatic effect of subsampling. The picture is similar if we visualize the prediction accuracy over time.</p><pre><code class="language-julia hljs">plot(
    [i.time_elapsed for i in info_full[t]],
    [i.accuracy for i in info_full[t]];
    xlabel=&quot;Wallclock Time (sec)&quot;,
    ylabel=&quot;Prediction Accuracy&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.time_elapsed for i in info_sub[t]],
    [i.accuracy for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_time_accuracy.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_time_accuracy.svg" alt/></p><p>But remember that subsampling will always be <em>asymptotically</em> slower than no subsampling. That is, as the number of iterations increase, there will be a point where no subsampling will overtake subsampling even in terms of wallclock time. Therefore, subsampling is most beneficial when a crude solution to the VI problem suffices.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-HBB2010"><a class="tag is-link" href="#citeref-HBB2010">HBB2010</a>Hoffman, M., Bach, F., &amp; Blei, D. (2010). Online learning for latent Dirichlet allocation. In <em>Advances in Neural Information Processing Systems</em>, 23.</li><li class="footnote" id="footnote-HBWP2013"><a class="tag is-link" href="#citeref-HBWP2013">HBWP2013</a>Hoffman, M. D., Blei, D. M., Wang, C., &amp; Paisley, J. (2013). Stochastic variational inference. <em>Journal of Machine Learning Research</em>, 14(1), 1303-1347.</li><li class="footnote" id="footnote-TL2014"><a class="tag is-link" href="#citeref-TL2014">TL2014</a>Titsias, M., &amp; Lázaro-Gredilla, M. (2014, June). Doubly stochastic variational Bayes for non-conjugate inference. In <em>Proceedings of the International Conference on Machine Learning</em> (pp. 1971-1979). PMLR.</li><li class="footnote" id="footnote-KTRGB2017"><a class="tag is-link" href="#citeref-KTRGB2017">KTRGB2017</a>Kucukelbir, A., Tran, D., Ranganath, R., Gelman, A., &amp; Blei, D. M. (2017). Automatic differentiation variational inference. <em>Journal of Machine Learning Research</em>, 18(14), 1-45.</li><li class="footnote" id="footnote-Tan2018"><a class="tag is-link" href="#citeref-Tan2018">Tan2018</a>Tan, Choon Lin (2018), &quot;Phishing Dataset for Machine Learning: Feature Evaluation&quot;, Mendeley Data, V1, doi: 10.17632/h3cgnj8hft.1]</li><li class="footnote" id="footnote-MKR2020"><a class="tag is-link" href="#citeref-MKR2020">MKR2020</a>Mishchenko, K., Khaled, A., &amp; Richtárik, P. (2020). Random reshuffling: Simple analysis with vast improvements. Advances in Neural Information Processing Systems, 33, 17309-17320.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basic/">« Basic Example</a><a class="docs-footer-nextpage" href="../stan/">Stan Models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.0 on <span class="colophon-date" title="Saturday 22 November 2025 20:15">Saturday 22 November 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
