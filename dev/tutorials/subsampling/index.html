<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Scaling to Large Datasets · AdvancedVI.jl</title><meta name="title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta property="og:title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta property="twitter:title" content="Scaling to Large Datasets · AdvancedVI.jl"/><meta name="description" content="Documentation for AdvancedVI.jl."/><meta property="og:description" content="Documentation for AdvancedVI.jl."/><meta property="twitter:description" content="Documentation for AdvancedVI.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body>
<!-- NAVBAR START -->
<style>
    @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap');

    /* Documenter.jl CSS Overrides */
    html {
        scroll-padding-top: calc(var(--navbar-height) + 1rem);
    }
    .docs-sidebar, #documenter {
        margin-top: var(--navbar-height);
    }
    .docs-version-selector {
        margin-bottom: 60px !important;
    }
    @media screen and (max-width: 1056px) {
        .docs-version-selector {
            margin-bottom: 60px !important;
        }
        .docs-sidebar {
            margin-top: 0 !important;
        }
    }
    /* End of Documenter.jl Tweaks */

    /* Color and Font Variables */
    :root {
        --heading-color: #6c757d;
        --item-color: rgb(165, 165, 165);
        --primary-bg: white;
        --hover-color: #8faad2;
        --deprecated-bg: #ff4d4d;
        --deprecated-text: white;
        --icon-color: #6c757d;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e9ecef;
        
        /* Typography */
        --font-family: "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        --nav-link-font-size: 1.0625rem;
        --turing-title-font-size: 21.25px;
        --icon-font-size: 1.25rem;
        --dropdown-arrow-font-size: 0.6875rem;
        --badge-font-size: 0.75rem;

        /* Sizing and Spacing */
        --navbar-height: 3.75rem;
        --logo-height: 31px;
        --logo-width: auto;
        --logo-padding-top: 7px;
        --logo-margin-left: 0.8rem;
        --title-margin-left: 0.4px;
        --title-nav-spacing: 1.1rem;
        --nav-item-margin-left: 1.3rem;
        --icon-margin-left: 1rem;
        --dropdown-padding: 1.875rem;
        --dropdown-item-width: 12.5rem;
        --dropdown-subitem-width: 15.625rem;
        --dropdown-subitem-padding: 0.125rem 0.625rem;
    }

    /* Dark Theme Variable Overrides */
    html.theme--documenter-dark {
        --heading-color: #e0e0e0;
        --item-color: #bdbdbd;
        --primary-bg: #1f2424;
        --hover-color: #ffffff;
        --icon-color: #e0e0e0;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #424242;
    }

    /* Catppuccin Theme Overrides */
    html.theme--catppuccin-latte {
        --heading-color: #4c4f69;
        --primary-bg: #eff1f5;
        --icon-color: #4c4f69;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e6e9ef;
    }
    html.theme--catppuccin-frappe {
        --heading-color: #c6d0f5;
        --primary-bg: #303446;
        --icon-color: #c6d0f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #51576d;
    }
    html.theme--catppuccin-macchiato {
        --heading-color: #cad3f5;
        --primary-bg: #24273a;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #494d64;
    }
    html.theme--catppuccin-mocha {
        --heading-color: #cad3f5;
        --primary-bg: #1e1e2e;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #45475a;
    }


    /* Main Navigation Bar */
    .ext-navigation {
        font-family: var(--font-family);
        position: fixed;
        height: var(--navbar-height);
        top: 0;
        width: 100%;
        background-color: var(--primary-bg);
        z-index: 1000;
        box-shadow: 0 2px 4px var(--shadow-color);
        display: flex;
        align-items: center;
        padding: 0 1.0625rem;
        transition: transform 0.3s, background-color 0.3s;
    }

    nav.ext-navigation .ext-navbar-logo {
        margin-left: var(--logo-margin-left);
        height: auto;
        max-height: var(--logo-height);
        width: auto;
        padding-top: var(--logo-padding-top);
    }
    
    /* Theme-aware logo text color */
    .ext-navbar-logo .logo-text {
        fill: var(--heading-color);
    }
    
    .ext-navbar-title {
        color: var(--heading-color) !important;
        font-size: var(--turing-title-font-size) !important;
        margin-left: var(--title-margin-left);
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .ext-navbar-title:hover {
        color: var(--hover-color) !important;
    }

    .ext-nav-links {
        display: flex;
        align-items: center;
        list-style-type: none;
        margin: 0;
        padding: 0;
        flex-grow: 1;
        margin-left: var(--title-nav-spacing);
    }

    .ext-nav-links li:first-child {
        margin-left: 0 !important;
    }

    .ext-nav-links li {
        margin-left: var(--nav-item-margin-left) !important;
    }

    .ext-nav-link {
        color: var(--heading-color) !important;
        text-decoration: none;
        font-size: var(--nav-link-font-size) !important;
        transition: color 0.2s ease;
        cursor: pointer;
    }

    .ext-nav-link:hover,
    .ext-navbar-item-single a:hover,
    .ext-navbar-icons a:hover {
        color: var(--hover-color) !important;
    }

    .ext-navbar-item-single a {
        color: var(--heading-color) !important;
    }
    
    .ext-navbar-icons {
        display: flex;
        align-items: center;
    }

    .ext-navbar-icons a {
        color: var(--icon-color) !important;
        font-size: var(--icon-font-size) !important;
        transition: color 0.2s ease;
        margin-left: var(--icon-margin-left);
    }

    .ext-menu-toggle {
        display: none;
        font-size: 1.5rem;
        color: var(--heading-color);
        cursor: pointer;
    }

    .ext-dropdown {
        display: none;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        padding: var(--dropdown-padding);
        position: absolute;
        top: var(--navbar-height);
        width: 100%;
        left: 0;
        background-color: var(--primary-bg);
        line-height: 1.875rem;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s;
        transform: translateY(-0.625rem);
        box-shadow: 0 4px 6px var(--shadow-color);
    }

    #library-handler::after {
        content: "▼";
        font-size: var(--dropdown-arrow-font-size);
        margin-left: 0.3125rem;
        transition: transform 0.3s ease-in-out;
    }

    #library-handler.open::after {
        content: "▲";
    }

    .ext-dropdown.show {
        display: grid;
        opacity: 1;
        transform: translateY(0);
    }

    .ext-dropdown ul {
        width: var(--dropdown-item-width);
        margin-bottom: 1.25rem;
    }

    .ext-dropdown ul li {
        text-align: left;
        display: flex;
        align-items: center;
    }

    .ext-dropdown ul a li {
        color: var(--item-color);
        width: var(--dropdown-subitem-width);
        border-radius: 3px;
        padding: var(--dropdown-subitem-padding);
        transition: background-color 0.2s ease;
    }

    .ext-dropdown ul a li:hover {
        background-color: var(--dropdown-hover-bg);
    }

    .ext-dropdown-item-heading {
        color: var(--heading-color);
        text-align: center;
    }

    .deprecated-badge {
        background-color: var(--deprecated-bg);
        color: var(--deprecated-text);
        font-size: var(--badge-font-size);
        padding: .1rem;
        border-radius: 3px;
        margin-left: 0.5rem;
        line-height: 1;
    }

    @media (max-width: 966px) {
        .ext-dropdown {
            grid-template-columns: 1fr 1fr 1fr;
        }
    }

    @media (max-width: 768px) {
        .ext-nav-links {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            background-color: var(--primary-bg);
            position: absolute;
            top: var(--navbar-height);
            left: 0;
            padding: 0.625rem 0;
            height: auto;
            overflow-y: auto;
            box-shadow: 0 4px 6px var(--shadow-color);
            margin-left: 0;
        }

        .ext-nav-links.show {
            display: flex;
        }

        .ext-nav-links li {
            margin: 0.625rem 0 !important;
            text-align: center;
        }
        
        .ext-menu-toggle {
            display: block;
            margin-left: auto;
        }

        .ext-navigation.hide {
            transform: translateY(calc(-1 * var(--navbar-height)));
        }

        .ext-dropdown {
            position: static;
            display: block;
            opacity: 1;
            transform: none;
            box-shadow: none;
            grid-template-columns: 1fr;
            padding: 0.625rem;
            text-align: center;
        }

        .ext-dropdown ul {
            width: auto;
            display: inline-block;
            margin: 0 auto 0.3125rem;
            text-align: left;
        }
    }
</style>
<nav class="ext-navigation">
    <a href="https://turinglang.org/">
        <svg width="4333" height="1145" viewBox="0 0 4333 1145" fill="none" xmlns="http://www.w3.org/2000/svg" class="ext-navbar-logo">
            <path class="logo-text" d="M0.44603 193.181V66.9868H663.471V193.181H406.62V898H257.297V193.181H0.44603ZM1097.24 635.874V274.74H1244.13V898H1101.7V787.225H1095.21C1081.14 822.121 1058.01 850.66 1025.82 872.842C993.902 895.024 954.542 906.115 907.744 906.115C866.896 906.115 830.783 897.053 799.403 878.929C768.295 860.534 743.948 833.889 726.365 798.993C708.782 763.826 699.99 721.356 699.99 671.581V274.74H846.878V648.858C846.878 688.353 857.699 719.733 879.34 742.997C900.981 766.261 929.385 777.893 964.551 777.893C986.192 777.893 1007.16 772.618 1027.45 762.068C1047.73 751.518 1064.37 735.828 1077.35 714.999C1090.61 693.899 1097.24 667.524 1097.24 635.874ZM1395.17 898V274.74H1537.6V378.617H1544.09C1555.45 342.639 1574.93 314.911 1602.52 295.434C1630.38 275.687 1662.17 265.813 1697.88 265.813C1705.99 265.813 1715.05 266.219 1725.06 267.031C1735.34 267.572 1743.86 268.518 1750.63 269.871V404.992C1744.4 402.828 1734.53 400.934 1721 399.311C1707.75 397.417 1694.9 396.471 1682.46 396.471C1655.68 396.471 1631.6 402.287 1610.23 413.919C1589.13 425.28 1572.49 441.105 1560.32 461.393C1548.15 481.682 1542.06 505.081 1542.06 531.591V898H1395.17ZM1848.21 898V274.74H1995.1V898H1848.21ZM1922.06 186.283C1898.8 186.283 1878.78 178.573 1862.01 163.154C1845.24 147.464 1836.85 128.664 1836.85 106.752C1836.85 84.5701 1845.24 65.7695 1862.01 50.3503C1878.78 34.6606 1898.8 26.8158 1922.06 26.8158C1945.6 26.8158 1965.61 34.6606 1982.12 50.3503C1998.89 65.7695 2007.27 84.5701 2007.27 106.752C2007.27 128.664 1998.89 147.464 1982.12 163.154C1965.61 178.573 1945.6 186.283 1922.06 186.283ZM2293.04 532.809V898H2146.15V274.74H2286.54V380.646H2293.85C2308.18 345.75 2331.04 318.022 2362.42 297.463C2394.07 276.904 2433.16 266.625 2479.69 266.625C2522.7 266.625 2560.17 275.822 2592.09 294.217C2624.28 312.612 2649.17 339.257 2666.75 374.153C2684.6 409.049 2693.39 451.385 2693.12 501.159V898H2546.24V523.882C2546.24 482.223 2535.41 449.626 2513.77 426.092C2492.4 402.557 2462.78 390.79 2424.91 390.79C2399.21 390.79 2376.35 396.471 2356.34 407.832C2336.59 418.923 2321.03 435.019 2309.67 456.119C2298.58 477.218 2293.04 502.782 2293.04 532.809ZM3113.5 1144.71C3060.75 1144.71 3015.44 1137.54 2977.57 1123.2C2939.7 1109.13 2909.26 1090.2 2886.27 1066.39C2863.28 1042.59 2847.32 1016.21 2838.39 987.269L2970.67 955.213C2976.62 967.386 2985.28 979.424 2996.64 991.327C3008 1003.5 3023.28 1013.51 3042.49 1021.35C3061.97 1029.47 3086.45 1033.53 3115.93 1033.53C3157.59 1033.53 3192.08 1023.38 3219.4 1003.09C3246.73 983.076 3260.39 950.074 3260.39 904.087V786.008H3253.08C3245.51 801.157 3234.42 816.711 3219.81 832.671C3205.47 848.632 3186.4 862.022 3162.6 872.842C3139.06 883.663 3109.44 889.073 3073.73 889.073C3025.85 889.073 2982.44 877.847 2943.48 855.394C2904.8 832.671 2873.96 798.857 2850.97 753.952C2828.24 708.777 2816.88 652.24 2816.88 584.341C2816.88 515.902 2828.24 458.147 2850.97 411.078C2873.96 363.739 2904.93 327.896 2943.89 303.55C2982.84 278.933 3026.26 266.625 3074.14 266.625C3110.66 266.625 3140.69 272.847 3164.22 285.29C3188.03 297.463 3206.96 312.206 3221.03 329.519C3235.09 346.561 3245.78 362.657 3253.08 377.805H3261.2V274.74H3406.06V908.144C3406.06 961.435 3393.34 1005.53 3367.92 1040.42C3342.49 1075.32 3307.73 1101.43 3263.63 1118.74C3219.54 1136.05 3169.5 1144.71 3113.5 1144.71ZM3114.72 773.835C3145.83 773.835 3172.34 766.261 3194.25 751.112C3216.16 735.963 3232.79 714.187 3244.16 685.783C3255.52 657.379 3261.2 623.295 3261.2 583.53C3261.2 544.305 3255.52 509.95 3244.16 480.465C3233.07 450.979 3216.56 428.12 3194.65 411.89C3173.01 395.389 3146.37 387.138 3114.72 387.138C3081.98 387.138 3054.66 395.659 3032.75 412.701C3010.84 429.744 2994.34 453.143 2983.25 482.899C2972.16 512.385 2966.61 545.929 2966.61 583.53C2966.61 621.672 2972.16 655.08 2983.25 683.754C2994.61 712.158 3011.25 734.34 3033.16 750.3C3055.34 765.99 3082.53 773.835 3114.72 773.835ZM3647.08 906.927C3622.47 906.927 3601.37 898.271 3583.78 880.958C3566.2 863.645 3557.54 842.545 3557.82 817.658C3557.54 793.312 3566.2 772.482 3583.78 755.17C3601.37 737.857 3622.47 729.2 3647.08 729.2C3670.89 729.2 3691.58 737.857 3709.17 755.17C3727.02 772.482 3736.08 793.312 3736.35 817.658C3736.08 834.159 3731.75 849.173 3723.37 862.698C3715.25 876.224 3704.43 887.044 3690.91 895.16C3677.65 903.004 3663.04 906.927 3647.08 906.927ZM3888.01 274.74H4034.9V933.708C4034.9 978.613 4026.38 1015.67 4009.33 1044.89C3992.29 1074.1 3967.67 1095.88 3935.48 1110.22C3903.29 1124.55 3864.2 1131.72 3818.22 1131.72C3812.81 1131.72 3807.8 1131.59 3803.2 1131.32C3798.6 1131.32 3793.6 1131.18 3788.19 1130.91V1011.21C3792.25 1011.48 3795.9 1011.62 3799.15 1011.62C3802.39 1011.89 3805.77 1012.02 3809.29 1012.02C3837.42 1012.02 3857.58 1005.12 3869.75 991.327C3881.92 977.801 3888.01 957.918 3888.01 931.679V274.74ZM3961.05 186.283C3937.51 186.283 3917.36 178.573 3900.59 163.154C3884.09 147.464 3875.84 128.664 3875.84 106.752C3875.84 84.5701 3884.09 65.7695 3900.59 50.3503C3917.36 34.6606 3937.51 26.8158 3961.05 26.8158C3984.31 26.8158 4004.19 34.6606 4020.7 50.3503C4037.47 65.7695 4045.85 84.5701 4045.85 106.752C4045.85 128.664 4037.47 147.464 4020.7 163.154C4004.19 178.573 3984.31 186.283 3961.05 186.283ZM4332.83 66.9868V898H4185.94V66.9868H4332.83Z" fill="currentColor"/>
            <path d="M4076 108.5C4076 168.424 4027.42 217 3967.5 217C3907.58 217 3859 168.424 3859 108.5C3859 48.5762 3907.58 0 3967.5 0C4027.42 0 4076 48.5762 4076 108.5Z" fill="#389725"/>
            <path d="M3755 814.5C3755 874.424 3706.42 923 3646.5 923C3586.58 923 3538 874.424 3538 814.5C3538 754.576 3586.58 706 3646.5 706C3706.42 706 3755 754.576 3755 814.5Z" fill="#9457B1"/>
            <path d="M2030 108.5C2030 168.424 1981.42 217 1921.5 217C1861.58 217 1813 168.424 1813 108.5C1813 48.5762 1861.58 0 1921.5 0C1981.42 0 2030 48.5762 2030 108.5Z" fill="#CA3B33"/>
        </svg>
    </a>
    <!-- <a class="ext-navbar-title" href="https://turinglang.org/">Turing.jl</a> -->
    
    <ul class="ext-nav-links">
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/getting-started/">Get Started</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/tutorials/">Tutorials</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/faq/">FAQ</a></li>
        <li>
            <p class="ext-nav-link" id="library-handler">Libraries</p>
            <div class="ext-dropdown" id="ext-dropdown-items">
                <ul>
                    <li class="ext-dropdown-item-heading">Modelling Languages</li>
                    <a href="https://turinglang.org/DynamicPPL.jl/"><li>DynamicPPL</li></a>
                    <a href="https://turinglang.org/JuliaBUGS.jl/"><li>JuliaBUGS</li></a>
                    <a href="https://turinglang.org/TuringGLM.jl/"><li>TuringGLM</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">MCMC</li>
                    <a href="https://turinglang.org/AdvancedHMC.jl/"><li>AdvancedHMC</li></a>
                    <a href="https://turinglang.org/AbstractMCMC.jl/"><li>AbstractMCMC</li></a>
                    <a href="https://github.com/theogf/ThermodynamicIntegration.jl"><li>ThermodynamicIntegration</li></a>
                    <a href="https://turinglang.org/AdvancedPS.jl/"><li>AdvancedPS</li></a>
                    <a href="https://turinglang.org/SliceSampling.jl/"><li>SliceSampling</li></a>
                    <a href="https://turinglang.org/EllipticalSliceSampling.jl/"><li>EllipticalSliceSampling</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Diagnostics</li>
                    <a href="https://turinglang.org/MCMCChains.jl/"><li>MCMCChains</li></a>
                    <a href="https://turinglang.org/MCMCDiagnosticTools.jl/"><li>MCMCDiagnosticTools</li></a>
                    <a href="https://turinglang.org/ParetoSmooth.jl/"><li>ParetoSmooth</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Gaussian Processes</li>
                    <a href="https://juliagaussianprocesses.github.io/AbstractGPs.jl/"><li>AbstractGPs</li></a>
                    <a href="https://juliagaussianprocesses.github.io/KernelFunctions.jl/"><li>KernelFunctions</li></a>
                    <a href="https://juliagaussianprocesses.github.io/ApproximateGPs.jl/"><li>ApproximateGPs</li></a>
                </ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Bijectors.jl/">Bijectors</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/TuringCallbacks.jl/">TuringCallbacks</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Deprecated/TuringBenchmarking/">TuringBenchmarking</a><span class="deprecated-badge">Deprecated</span></li></ul>
            </div>
        </li>
        <li><a class="ext-nav-link" href="https://turinglang.org/news/">News</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/team/">Team</a></li>
    </ul>

    <div class="ext-navbar-icons">
        <a href="https://x.com/TuringLang" aria-label="Turing on X"><i class="fa-brands fa-x-twitter"></i></a>
        <a href="https://discourse.julialang.org/c/domain/probprog/48" aria-label="Turing on Discourse"><i class="fa-brands fa-discourse"></i></a>
        <a href="https://julialang.slack.com/archives/CCYDC34A0" aria-label="Turing on Slack"><i class="fa-brands fa-slack"></i></a>
        <a href="https://github.com/TuringLang/" aria-label="Turing.jl on GitHub"><i class="fa-brands fa-github"></i></a>
    </div>

    <span class="ext-menu-toggle"><i class="fa-solid fa-bars"></i></span>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const menuToggle = document.querySelector(".ext-menu-toggle");
        const navLinks = document.querySelector(".ext-nav-links");
        const nav = document.querySelector(".ext-navigation");
        const libraryHandler = document.getElementById("library-handler");
        const dropdownContainer = document.getElementById("ext-dropdown-items");
        let lastScrollY = window.scrollY;

        function closeDropdown() {
            if (dropdownContainer.classList.contains("show")) {
                libraryHandler.classList.remove("open");
                dropdownContainer.classList.remove("show");
                setTimeout(() => {
                    if (!dropdownContainer.classList.contains("show")) {
                        dropdownContainer.style.display = "none";
                    }
                }, 300);
            }
        }

        function openDropdown() {
            dropdownContainer.style.display = "grid";
            libraryHandler.classList.add("open");
            setTimeout(() => {
                dropdownContainer.classList.add("show");
            }, 10);
        }

        function setAppropriateHeight() {
            if (window.innerWidth <= 768) {
                const viewportHeight = window.innerHeight;
                const navHeight = nav.offsetHeight;
                navLinks.style.maxHeight = `${viewportHeight - navHeight}px`;
                navLinks.style.overflowY = "auto";
            } else {
                navLinks.style.maxHeight = "";
                navLinks.style.overflowY = "";
            }
        }

        menuToggle.addEventListener("click", (event) => {
            event.stopPropagation();
            navLinks.classList.toggle("show");
            if (navLinks.classList.contains("show")) {
                setAppropriateHeight();
                closeDropdown();
                dropdownContainer.style.display = "none";
            }
        });

        libraryHandler.addEventListener("click", (event) => {
            event.stopPropagation();
            event.preventDefault();
            if (dropdownContainer.classList.contains("show")) {
                closeDropdown();
            } else {
                openDropdown();
            }
            setAppropriateHeight();
        });

        // Close all menus if a click is registered outside the navigation bar.
        document.addEventListener("click", (event) => {
            if (!nav.contains(event.target)) {
                navLinks.classList.remove("show");
                closeDropdown();
            }
        });

        // Hide navigation bar on scroll down in mobile view.
        window.addEventListener("scroll", () => {
            if (window.innerWidth <= 768) {
                if (window.scrollY > lastScrollY && window.scrollY > nav.offsetHeight){
                    nav.classList.add("hide");
                } else {
                    nav.classList.remove("hide");
                }
                lastScrollY = window.scrollY;
            }
        });

        window.addEventListener("resize", setAppropriateHeight);
    });
</script>
<!-- NAVBAR END -->


<div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AdvancedVI.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">AdvancedVI</a></li><li><a class="tocitem" href="../../general/">General Usage</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../basic/">Basic Example</a></li><li class="is-active"><a class="tocitem" href>Scaling to Large Datasets</a><ul class="internal"><li><a class="tocitem" href="#Setting-Up-Subsampling"><span>Setting Up Subsampling</span></a></li><li><a class="tocitem" href="#Scalable-Inference-via-AdvancedVI"><span>Scalable Inference via AdvancedVI</span></a></li></ul></li><li><a class="tocitem" href="../stan/">Stan Models</a></li><li><a class="tocitem" href="../flows/">Normalizing Flows</a></li><li><a class="tocitem" href="../constrained/">Dealing with Constrained Posteriors</a></li></ul></li><li><span class="tocitem">Algorithms</span><ul><li><a class="tocitem" href="../../klminrepgraddescent/"><code>KLMinRepGradDescent</code></a></li><li><a class="tocitem" href="../../klminrepgradproxdescent/"><code>KLMinRepGradProxDescent</code></a></li><li><a class="tocitem" href="../../klminscoregraddescent/"><code>KLMinScoreGradDescent</code></a></li><li><a class="tocitem" href="../../klminwassfwdbwd/"><code>KLMinWassFwdBwd</code></a></li><li><a class="tocitem" href="../../klminnaturalgraddescent/"><code>KLMinNaturalGradDescent</code></a></li><li><a class="tocitem" href="../../klminsqrtnaturalgraddescent/"><code>KLMinSqrtNaturalGradDescent</code></a></li><li><a class="tocitem" href="../../fisherminbatchmatch/"><code>FisherMinBatchMatch</code></a></li></ul></li><li><a class="tocitem" href="../../families/">Variational Families</a></li><li><a class="tocitem" href="../../optimization/">Optimization</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Scaling to Large Datasets</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Scaling to Large Datasets</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TuringLang/AdvancedVI.jl/blob/main/docs/src/tutorials/subsampling.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Scaling-to-Large-Datasets-with-Subsampling"><a class="docs-heading-anchor" href="#Scaling-to-Large-Datasets-with-Subsampling">Scaling to Large Datasets with Subsampling</a><a id="Scaling-to-Large-Datasets-with-Subsampling-1"></a><a class="docs-heading-anchor-permalink" href="#Scaling-to-Large-Datasets-with-Subsampling" title="Permalink"></a></h1><p>In this tutorial, we will show how to use <code>AdvancedVI</code> on problems with large datasets. Variational inference (VI) has a long and successful history<sup class="footnote-reference"><a id="citeref-HBWP2013" href="#footnote-HBWP2013" class="footnote-ref">[HBWP2013]</a><span class="footnote-preview" id="fn-HBWP2013"></span></sup><sup class="footnote-reference"><a id="citeref-TL2014" href="#footnote-TL2014" class="footnote-ref">[TL2014]</a><span class="footnote-preview" id="fn-TL2014"></span></sup><sup class="footnote-reference"><a id="citeref-HBB2010" href="#footnote-HBB2010" class="footnote-ref">[HBB2010]</a><span class="footnote-preview" id="fn-HBB2010"></span></sup> in large scale inference using (minibatch) subsampling. In this tutorial, we will see how to perform subsampling with <code>KLMinRepGradProxDescent</code>, which was originally described in the paper by Titsias and Lázaro-Gredilla<sup class="footnote-reference"><a id="citeref-TL2014" href="#footnote-TL2014" class="footnote-ref">[TL2014]</a><span class="footnote-preview" id="fn-TL2014"></span></sup>; Kucukelbir <em>et al</em><sup class="footnote-reference"><a id="citeref-KTRGB2017" href="#footnote-KTRGB2017" class="footnote-ref">[KTRGB2017]</a><span class="footnote-preview" id="fn-KTRGB2017"></span></sup>.</p><h2 id="Setting-Up-Subsampling"><a class="docs-heading-anchor" href="#Setting-Up-Subsampling">Setting Up Subsampling</a><a id="Setting-Up-Subsampling-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-Up-Subsampling" title="Permalink"></a></h2><p>We will consider a typical hierarchical logistic regression example.</p><pre><code class="language-julia hljs">using LogDensityProblems: LogDensityProblems
using Distributions
using FillArrays

struct LogReg{XType,YType}
    X::XType
    y::YType
    n_data::Int
end

function LogDensityProblems.logdensity(model::LogReg, θ)
    (; X, y, n_data) = model
    n, d = size(X)
    β, logσ = θ[1:size(X, 2)], θ[end]
    σ = exp(logσ)

    logprior_β = logpdf(MvNormal(Zeros(d), σ), β)
    logprior_σ = logpdf(Normal(0, 3), σ)

    logit = X*β
    loglike_y = mapreduce((li, yi) -&gt; logpdf(BernoulliLogit(li), yi), +, logit, y)
    return n_data/n*loglike_y + logprior_β + logprior_σ
end

function LogDensityProblems.dimension(model::LogReg)
    return size(prob.X, 2) + 1
end

function LogDensityProblems.capabilities(::Type{&lt;:LogReg})
    return LogDensityProblems.LogDensityOrder{0}()
end
nothing</code></pre><p>Notice that, to use subsampling, we need be able to rescale the likelihood strength. That is, for the gradient of the log-density with a batch of data points of size <code>n</code> to be an unbiased estimate of the gradient using the full dataset of size <code>n_data</code>, we need to scale the likelihood by <code>n_data/n</code>. This part is critical to ensure that the algorithm correctly approximates the posterior with the full dataset.</p><p>For the dataset, we will use one that is larger than that used in the <a href="../basic/#basic">Basic Example</a>. This is to properly assess the advantage of subsampling. In particular, we will utilize the &quot;Phishing&quot; dataset<sup class="footnote-reference"><a id="citeref-Tan2018" href="#footnote-Tan2018" class="footnote-ref">[Tan2018]</a><span class="footnote-preview" id="fn-Tan2018"></span></sup>, which consists of 10000 data points, each with 48 features. The goal is to predict whether the features of a specific website indicate whether it is a phishing website or a legitimate one. The <a href="https://www.openml.org/search?type=data&amp;status=active&amp;id=46722">dataset</a> id on the <a href="https://github.com/JuliaAI/OpenML.jl"><code>OpenML</code></a> repository is 46722.</p><pre><code class="language-julia hljs">using OpenML: OpenML
using DataFrames: DataFrames

data = Array(DataFrames.DataFrame(OpenML.load(46722)))
X = Matrix{Float64}(data[:, 2:end])
y = Vector{Bool}(data[:, end])
nothing</code></pre><p>The features start from the seoncd column, while the last column are the class labels.</p><p>Let&#39;s also apply some basic pre-processing.</p><pre><code class="language-julia hljs">using Statistics

X = (X .- mean(X; dims=2)) ./ std(X; dims=2)
X = hcat(X, ones(size(X, 1)))
nothing</code></pre><p>Let&#39;s now istantiate the model and set up automatic differentiation using <a href="https://github.com/tpapp/LogDensityProblemsAD.jl?tab=readme-ov-file"><code>LogDensityProblemsAD</code></a>.</p><pre><code class="language-julia hljs">using ADTypes, ReverseDiff
using LogDensityProblemsAD

prob = LogReg(X, y, size(X, 1))
prob_ad = LogDensityProblemsAD.ADgradient(
    ADTypes.AutoReverseDiff(), prob; x=randn(LogDensityProblems.dimension(prob))
)
nothing</code></pre><p>To enable subsampling, <code>LogReg</code> has to implement the method <code>AdvancedVI.subsample</code>. For our model, this is fairly simple: We only need to select the rows of <code>X</code> and the elements of <code>y</code> corresponding to the batch of data points. As subtle point here is that we wrapped <code>prob</code> with <code>LogDensityProblemsAD.ADgradient</code> into <code>prob_ad</code>. Therefore, <code>AdvancedVI</code> sees <code>prob_ad</code> and not <code>prob</code>. This means we have to specialize <code>AdvancedVI.subsample</code> to <code>typeof(prob_ad)</code> and not <code>LogReg</code>.</p><pre><code class="language-julia hljs">using Accessors
using AdvancedVI

function AdvancedVI.subsample(prob::typeof(prob_ad), idx)
    (; X, y, n_data) = parent(prob_ad)
    prob′ = @set prob.ℓ.X = X[idx, :]
    prob′′ = @set prob′.ℓ.y = y[idx]
    return prob′′
end
nothing</code></pre><div class="admonition is-info" id="Info-2ff349d416b1f545"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-2ff349d416b1f545" title="Permalink"></a></header><div class="admonition-body"><p>The default implementation of <code>AdvancedVI.subsample</code> is <code>AdvancedVI.subsample(model, idx) = model</code>. Therefore, if the specialization of <code>AdvancedVI.subsample</code> is not set up properly, <code>AdvancedVI</code> will silently use full-batch gradients instead of subsampling. It is thus useful to check whether the right specialization of <code>AdvancedVI.subsample</code> is being called.</p></div></div><h2 id="Scalable-Inference-via-AdvancedVI"><a class="docs-heading-anchor" href="#Scalable-Inference-via-AdvancedVI">Scalable Inference via AdvancedVI</a><a id="Scalable-Inference-via-AdvancedVI-1"></a><a class="docs-heading-anchor-permalink" href="#Scalable-Inference-via-AdvancedVI" title="Permalink"></a></h2><p>In this example, we will compare the convergence speed of <code>KLMinRepGradProxDescent</code> with and without subsampling. Subsampling can be turned on by supplying a subsampling strategy. Here, we will use <code>ReshufflingBatchSubsampling</code>, which implements random reshuffling. We will us a batch size of 32, which results in <code>313 = length(subsampling) = ceil(Int, size(X,2)/32)</code> steps per epoch.</p><pre><code class="language-julia hljs">dataset = 1:size(prob.X, 1)
batchsize = 32
subsampling = ReshufflingBatchSubsampling(dataset, batchsize)
alg_sub = KLMinRepGradProxDescent(ADTypes.AutoReverseDiff(; compile=true); subsampling)
nothing</code></pre><p>Recall that each epoch is 313 steps. When using <code>ReshufflingBatchSubsampling</code>, it is best to choose the number of iterations to be a multiple of the number of steps <code>length(subsampling)</code> in an epoch. This is due to a peculiar property of <code>ReshufflingBatchSubsampling</code>: the objective value tends to <em>increase</em> during an epoch, and come down nearing the end. (Theoretically, this is due to conditionally <em>biased</em> nature of random reshuffling<sup class="footnote-reference"><a id="citeref-MKR2020" href="#footnote-MKR2020" class="footnote-ref">[MKR2020]</a><span class="footnote-preview" id="fn-MKR2020"></span></sup>.) Therefore, the objective value is minimized exactly after the last step of each epoch.</p><pre><code class="language-julia hljs">num_epochs = 10
max_iter = num_epochs * length(subsampling)
nothing</code></pre><p>If we don&#39;t supply a subsampling strategy to <code>KLMinRepGradProxDescent</code>, subsampling will not be used.</p><pre><code class="language-julia hljs">alg_full = KLMinRepGradProxDescent(ADTypes.AutoReverseDiff(; compile=true))
nothing</code></pre><p>The variational family will be set up as follows:</p><pre><code class="language-julia hljs">using LinearAlgebra

d = LogDensityProblems.dimension(prob_ad)
q = FullRankGaussian(zeros(d), LowerTriangular(Matrix{Float64}(0.6*I, d, d)))
nothing</code></pre><p>It now remains to run VI. For comparison, we will record both the ELBO (with a large number of Monte Carlo samples) and the prediction accuracy.</p><pre><code class="language-julia hljs">using StatsFuns: StatsFuns

logging_interval = 100
time_begin = nothing

&quot;&quot;&quot;
    logistic_prediction(X, μ_β, Σ_β)

Approximate the posterior predictive probability for a logistic link function using Mackay&#39;s approximation (Bishop p. 220).
&quot;&quot;&quot;
function logistic_prediction(X, μ_β, Σ_β)
    xtΣx = sum((prob.X*Σ_β) .* prob.X; dims=2)[:, 1]
    κ = @. 1/sqrt(1 + π/8*xtΣx)
    return StatsFuns.logistic.(κ .* X*μ_β)
end

function callback(; iteration, averaged_params, restructure, kwargs...)
    if mod(iteration, logging_interval) == 1

        # Use the averaged parameters (the eventual output of the algorithm)
        q_avg = restructure(averaged_params)

        # Compute predictions using
        μ_β = mean(q_avg)[1:(end - 1)] # posterior mean of β
        Σ_β = cov(q_avg)[1:(end - 1), end - 1] # marginal posterior covariance of β
        y_pred = logistic_prediction(X, μ_β, Σ_β) .&gt; 0.5

        # Prediction accuracy
        acc = mean(y_pred .== prob.y)

        # Higher fidelity estimate of the ELBO on the averaged parameters
        n_samples = 256
        elbo_callback = -estimate_objective(alg_full, q_avg, prob; n_samples)

        (elbo_callback=elbo_callback, accuracy=acc, time_elapsed=time() - time_begin)
    else
        nothing
    end
end

time_begin = time()
_, info_full, _ = AdvancedVI.optimize(
    alg_full, max_iter, prob_ad, q; show_progress=true, callback
);

time_begin = time()
_, info_sub, _ = AdvancedVI.optimize(
    alg_sub, max_iter, prob_ad, q; show_progress=true, callback
);
nothing</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Optimizing   0%|                               |  ETA: 0:37:32 ( 0.72  s/it)
        elbo: -27899.02636195412
   iteration: 2

Optimizing   3%|▉                              |  ETA: 0:01:29 (29.21 ms/it)
        elbo: -32260.23967873108
   iteration: 92

Optimizing   4%|█▍                             |  ETA: 0:01:08 (22.68 ms/it)
        elbo: -7738.7316092579385
   iteration: 137

Optimizing   5%|█▌                             |  ETA: 0:01:03 (21.29 ms/it)
        elbo: -29082.37940352366
   iteration: 151

Optimizing   5%|█▋                             |  ETA: 0:01:00 (20.14 ms/it)
        elbo: -13732.889422994891
   iteration: 165

Optimizing   6%|█▊                             |  ETA: 0:00:56 (19.14 ms/it)
        elbo: -7182.130083098077
   iteration: 179

Optimizing   6%|█▉                             |  ETA: 0:00:54 (18.38 ms/it)
        elbo: -7736.742052346971
   iteration: 192

Optimizing   7%|██                             |  ETA: 0:00:53 (18.11 ms/it)
        elbo: -7471.370040547753
   iteration: 205

Optimizing   7%|██▏                            |  ETA: 0:00:51 (17.42 ms/it)
        elbo: -13557.09575610094
   iteration: 219

Optimizing   7%|██▎                            |  ETA: 0:00:49 (16.83 ms/it)
        elbo: -7245.0565949009515
   iteration: 233

Optimizing   8%|██▌                            |  ETA: 0:00:47 (16.30 ms/it)
        elbo: -7605.040172171177
   iteration: 247

Optimizing   8%|██▋                            |  ETA: 0:00:46 (15.88 ms/it)
        elbo: -17787.041873670503
   iteration: 260

Optimizing   9%|██▊                            |  ETA: 0:00:44 (15.44 ms/it)
        elbo: -7394.199499090392
   iteration: 274

Optimizing   9%|██▉                            |  ETA: 0:00:43 (15.06 ms/it)
        elbo: -8017.206748172784
   iteration: 288

Optimizing  10%|███                            |  ETA: 0:00:42 (15.01 ms/it)
   elbo_callback: -7577.287655731537
        accuracy: 0.6941
    time_elapsed: 4.642220973968506
            elbo: -7744.563557383123
       iteration: 301




Optimizing  10%|███▏                           |  ETA: 0:00:41 (14.68 ms/it)
        elbo: -6724.259226531229
   iteration: 315

Optimizing  11%|███▎                           |  ETA: 0:00:40 (14.36 ms/it)
        elbo: -6579.179471348951
   iteration: 329

Optimizing  11%|███▍                           |  ETA: 0:00:39 (14.09 ms/it)
        elbo: -6790.575290230647
   iteration: 343

Optimizing  11%|███▌                           |  ETA: 0:00:38 (13.82 ms/it)
        elbo: -13262.590992499805
   iteration: 357

Optimizing  12%|███▋                           |  ETA: 0:00:37 (13.59 ms/it)
        elbo: -6514.4518283713805
   iteration: 371

Optimizing  12%|███▉                           |  ETA: 0:00:37 (13.36 ms/it)
        elbo: -8994.133020614625
   iteration: 385

Optimizing  13%|████                           |  ETA: 0:00:36 (13.16 ms/it)
        elbo: -7147.672828638118
   iteration: 399

Optimizing  13%|████▏                          |  ETA: 0:00:36 (13.20 ms/it)
        elbo: -7547.60807908296
   iteration: 412

Optimizing  14%|████▎                          |  ETA: 0:00:35 (13.01 ms/it)
        elbo: -6883.546746747571
   iteration: 426

Optimizing  14%|████▍                          |  ETA: 0:00:35 (12.84 ms/it)
        elbo: -6521.226761646675
   iteration: 440

Optimizing  15%|████▌                          |  ETA: 0:00:34 (12.68 ms/it)
        elbo: -6851.749220805141
   iteration: 454

Optimizing  15%|████▋                          |  ETA: 0:00:33 (12.53 ms/it)
        elbo: -6564.463686012597
   iteration: 468

Optimizing  15%|████▊                          |  ETA: 0:00:33 (12.41 ms/it)
        elbo: -8830.73549702062
   iteration: 481

Optimizing  16%|████▉                          |  ETA: 0:00:32 (12.27 ms/it)
        elbo: -7771.509496123134
   iteration: 495

Optimizing  16%|█████                          |  ETA: 0:00:32 (12.33 ms/it)
        elbo: -6452.328551895401
   iteration: 508

Optimizing  17%|█████▏                         |  ETA: 0:00:32 (12.19 ms/it)
        elbo: -8076.07920776209
   iteration: 522

Optimizing  17%|█████▎                         |  ETA: 0:00:31 (12.07 ms/it)
        elbo: -7478.911647699505
   iteration: 536

Optimizing  18%|█████▌                         |  ETA: 0:00:31 (11.95 ms/it)
        elbo: -6795.165738732849
   iteration: 550

Optimizing  18%|█████▋                         |  ETA: 0:00:30 (11.86 ms/it)
        elbo: -8153.651668679121
   iteration: 563

Optimizing  18%|█████▊                         |  ETA: 0:00:30 (11.75 ms/it)
        elbo: -7535.852226037132
   iteration: 577

Optimizing  19%|█████▉                         |  ETA: 0:00:30 (11.65 ms/it)
        elbo: -6920.883192474458
   iteration: 591

Optimizing  19%|██████                         |  ETA: 0:00:30 (11.71 ms/it)
        elbo: -6634.050909461621
   iteration: 603

Optimizing  20%|██████▏                        |  ETA: 0:00:29 (11.62 ms/it)
        elbo: -6910.35271976712
   iteration: 617

Optimizing  20%|██████▎                        |  ETA: 0:00:29 (11.59 ms/it)
        elbo: -6198.013539856704
   iteration: 630

Optimizing  20%|██████▍                        |  ETA: 0:00:31 (12.36 ms/it)
        elbo: -6289.015106369998
   iteration: 640

Optimizing  21%|██████▌                        |  ETA: 0:00:30 (12.27 ms/it)
        elbo: -6495.394039094589
   iteration: 653

Optimizing  21%|██████▋                        |  ETA: 0:00:30 (12.19 ms/it)
        elbo: -6276.43659218526
   iteration: 666

Optimizing  22%|██████▊                        |  ETA: 0:00:30 (12.09 ms/it)
        elbo: -6814.740086768152
   iteration: 680

Optimizing  22%|██████▉                        |  ETA: 0:00:29 (12.02 ms/it)
        elbo: -6628.301945355478
   iteration: 693

Optimizing  23%|███████                        |  ETA: 0:00:29 (12.07 ms/it)
        elbo: -6504.307695023665
   iteration: 706

Optimizing  23%|███████▏                       |  ETA: 0:00:29 (11.98 ms/it)
        elbo: -6433.351351639797
   iteration: 720

Optimizing  23%|███████▎                       |  ETA: 0:00:29 (11.91 ms/it)
        elbo: -6090.105706178299
   iteration: 733

Optimizing  24%|███████▍                       |  ETA: 0:00:28 (11.84 ms/it)
        elbo: -7164.848261844813
   iteration: 746

Optimizing  24%|███████▌                       |  ETA: 0:00:28 (11.77 ms/it)
        elbo: -6707.107068357406
   iteration: 759

Optimizing  25%|███████▋                       |  ETA: 0:00:28 (11.71 ms/it)
        elbo: -7248.699616876958
   iteration: 772

Optimizing  25%|███████▊                       |  ETA: 0:00:27 (11.63 ms/it)
        elbo: -6381.157687401113
   iteration: 786

Optimizing  26%|███████▉                       |  ETA: 0:00:27 (11.57 ms/it)
        elbo: -5819.265678468861
   iteration: 800

Optimizing  26%|████████                       |  ETA: 0:00:27 (11.62 ms/it)
        elbo: -5997.291202105251
   iteration: 812

Optimizing  26%|████████▏                      |  ETA: 0:00:27 (11.56 ms/it)
        elbo: -6469.473339700809
   iteration: 825

Optimizing  27%|████████▎                      |  ETA: 0:00:26 (11.49 ms/it)
        elbo: -6259.125849581246
   iteration: 839

Optimizing  27%|████████▌                      |  ETA: 0:00:26 (11.44 ms/it)
        elbo: -6791.059151685412
   iteration: 852

Optimizing  28%|████████▋                      |  ETA: 0:00:26 (11.38 ms/it)
        elbo: -5976.370842189132
   iteration: 866

Optimizing  28%|████████▊                      |  ETA: 0:00:25 (11.33 ms/it)
        elbo: -5891.854413444457
   iteration: 879

Optimizing  29%|████████▉                      |  ETA: 0:00:25 (11.27 ms/it)
        elbo: -6801.52180621658
   iteration: 893

Optimizing  29%|█████████                      |  ETA: 0:00:25 (11.32 ms/it)
        elbo: -5958.536612109892
   iteration: 905

Optimizing  29%|█████████▏                     |  ETA: 0:00:25 (11.26 ms/it)
        elbo: -6381.924080544401
   iteration: 919

Optimizing  30%|█████████▎                     |  ETA: 0:00:25 (11.21 ms/it)
        elbo: -6199.9950159579475
   iteration: 933

Optimizing  30%|█████████▍                     |  ETA: 0:00:24 (11.16 ms/it)
        elbo: -7060.122002146163
   iteration: 947

Optimizing  31%|█████████▌                     |  ETA: 0:00:24 (11.11 ms/it)
        elbo: -6859.31204257948
   iteration: 960

Optimizing  31%|█████████▋                     |  ETA: 0:00:24 (11.07 ms/it)
        elbo: -6837.572255915516
   iteration: 973

Optimizing  32%|█████████▊                     |  ETA: 0:00:24 (11.02 ms/it)
        elbo: -6348.858543319165
   iteration: 987

Optimizing  32%|█████████▉                     |  ETA: 0:00:24 (11.06 ms/it)
   elbo_callback: -6372.443627289423
        accuracy: 0.7389
    time_elapsed: 11.197877883911133
            elbo: -5978.054422316118
       iteration: 1001




Optimizing  32%|██████████                     |  ETA: 0:00:23 (11.01 ms/it)
        elbo: -6142.601780161133
   iteration: 1015

Optimizing  33%|██████████▏                    |  ETA: 0:00:23 (10.97 ms/it)
        elbo: -5653.693953029838
   iteration: 1028

Optimizing  33%|██████████▍                    |  ETA: 0:00:23 (10.93 ms/it)
        elbo: -6715.646520493508
   iteration: 1042

Optimizing  34%|██████████▌                    |  ETA: 0:00:23 (10.88 ms/it)
        elbo: -6008.976167904981
   iteration: 1056

Optimizing  34%|██████████▋                    |  ETA: 0:00:22 (10.84 ms/it)
        elbo: -6345.827458933833
   iteration: 1070

Optimizing  35%|██████████▊                    |  ETA: 0:00:22 (10.80 ms/it)
        elbo: -6594.0924724189945
   iteration: 1083

Optimizing  35%|██████████▉                    |  ETA: 0:00:22 (10.76 ms/it)
        elbo: -6522.366032220811
   iteration: 1097

Optimizing  35%|███████████                    |  ETA: 0:00:22 (10.80 ms/it)
        elbo: -6245.490618317496
   iteration: 1110

Optimizing  36%|███████████▏                   |  ETA: 0:00:22 (10.76 ms/it)
        elbo: -6183.6061870242675
   iteration: 1124

Optimizing  36%|███████████▎                   |  ETA: 0:00:21 (10.72 ms/it)
        elbo: -6343.275281341638
   iteration: 1138

Optimizing  37%|███████████▍                   |  ETA: 0:00:21 (10.68 ms/it)
        elbo: -6436.042789113369
   iteration: 1152

Optimizing  37%|███████████▌                   |  ETA: 0:00:21 (10.64 ms/it)
        elbo: -5821.123137986822
   iteration: 1166

Optimizing  38%|███████████▋                   |  ETA: 0:00:21 (10.60 ms/it)
        elbo: -7653.347881143429
   iteration: 1180

Optimizing  38%|███████████▉                   |  ETA: 0:00:20 (10.57 ms/it)
        elbo: -7183.658865178076
   iteration: 1194

Optimizing  39%|████████████                   |  ETA: 0:00:20 (10.60 ms/it)
        elbo: -5933.7856619005015
   iteration: 1207

Optimizing  39%|████████████▏                  |  ETA: 0:00:20 (10.56 ms/it)
        elbo: -6761.223491793581
   iteration: 1221

Optimizing  39%|████████████▎                  |  ETA: 0:00:20 (10.53 ms/it)
        elbo: -6343.838257788198
   iteration: 1235

Optimizing  40%|████████████▍                  |  ETA: 0:00:20 (10.50 ms/it)
        elbo: -6162.759663038935
   iteration: 1249

Optimizing  40%|████████████▌                  |  ETA: 0:00:20 (10.47 ms/it)
        elbo: -6927.76429218359
   iteration: 1263

Optimizing  41%|████████████▋                  |  ETA: 0:00:19 (10.43 ms/it)
        elbo: -6413.281588014563
   iteration: 1277

Optimizing  41%|████████████▊                  |  ETA: 0:00:19 (10.41 ms/it)
        elbo: -6841.435636585166
   iteration: 1291

Optimizing  42%|████████████▉                  |  ETA: 0:00:19 (10.45 ms/it)
        elbo: -6248.602655436518
   iteration: 1303

Optimizing  42%|█████████████                  |  ETA: 0:00:19 (10.41 ms/it)
        elbo: -6380.468230921782
   iteration: 1317

Optimizing  43%|█████████████▏                 |  ETA: 0:00:19 (10.38 ms/it)
        elbo: -6374.295147566622
   iteration: 1331

Optimizing  43%|█████████████▍                 |  ETA: 0:00:18 (10.35 ms/it)
        elbo: -5829.649490873445
   iteration: 1345

Optimizing  43%|█████████████▌                 |  ETA: 0:00:18 (10.32 ms/it)
        elbo: -5883.096105461086
   iteration: 1359

Optimizing  44%|█████████████▋                 |  ETA: 0:00:18 (10.29 ms/it)
        elbo: -6242.887195559184
   iteration: 1373

Optimizing  44%|█████████████▊                 |  ETA: 0:00:18 (10.27 ms/it)
        elbo: -6083.428853958701
   iteration: 1387

Optimizing  45%|█████████████▉                 |  ETA: 0:00:18 (10.30 ms/it)
   elbo_callback: -6236.233563677475
        accuracy: 0.7562
    time_elapsed: 14.55565595626831
            elbo: -7648.696330208374
       iteration: 1401




Optimizing  45%|██████████████                 |  ETA: 0:00:18 (10.27 ms/it)
        elbo: -6132.6785380783485
   iteration: 1415

Optimizing  46%|██████████████▏                |  ETA: 0:00:17 (10.25 ms/it)
        elbo: -6720.310288677845
   iteration: 1429

Optimizing  46%|██████████████▎                |  ETA: 0:00:17 (10.22 ms/it)
        elbo: -6748.647236846435
   iteration: 1443

Optimizing  47%|██████████████▍                |  ETA: 0:00:17 (10.20 ms/it)
        elbo: -6116.369700330551
   iteration: 1457

Optimizing  47%|██████████████▋                |  ETA: 0:00:17 (10.17 ms/it)
        elbo: -6592.905492636408
   iteration: 1471

Optimizing  47%|██████████████▊                |  ETA: 0:00:17 (10.15 ms/it)
        elbo: -13122.269975360736
   iteration: 1485

Optimizing  48%|██████████████▉                |  ETA: 0:00:17 (10.12 ms/it)
        elbo: -6513.94866802774
   iteration: 1499

Optimizing  48%|███████████████                |  ETA: 0:00:16 (10.16 ms/it)
        elbo: -6361.90735757515
   iteration: 1511

Optimizing  49%|███████████████▏               |  ETA: 0:00:16 (10.13 ms/it)
        elbo: -7983.407016559961
   iteration: 1525

Optimizing  49%|███████████████▎               |  ETA: 0:00:16 (10.11 ms/it)
        elbo: -5970.939562288285
   iteration: 1539

Optimizing  50%|███████████████▍               |  ETA: 0:00:16 (10.08 ms/it)
        elbo: -6262.3518796720555
   iteration: 1553

Optimizing  50%|███████████████▌               |  ETA: 0:00:16 (10.06 ms/it)
        elbo: -6733.781461731112
   iteration: 1567

Optimizing  51%|███████████████▋               |  ETA: 0:00:16 (10.04 ms/it)
        elbo: -5649.259744052758
   iteration: 1581

Optimizing  51%|███████████████▊               |  ETA: 0:00:15 (10.01 ms/it)
        elbo: -6137.516002122383
   iteration: 1595

Optimizing  51%|███████████████▉               |  ETA: 0:00:15 (10.05 ms/it)
        elbo: -9711.242832144813
   iteration: 1609

Optimizing  52%|████████████████▏              |  ETA: 0:00:15 (10.02 ms/it)
        elbo: -6141.916112899946
   iteration: 1623

Optimizing  52%|████████████████▎              |  ETA: 0:00:15 (10.00 ms/it)
        elbo: -5823.5138401541835
   iteration: 1637

Optimizing  53%|████████████████▍              |  ETA: 0:00:15 ( 9.98 ms/it)
        elbo: -5937.818360886814
   iteration: 1651

Optimizing  53%|████████████████▌              |  ETA: 0:00:15 ( 9.96 ms/it)
        elbo: -9059.098544478336
   iteration: 1665

Optimizing  54%|████████████████▋              |  ETA: 0:00:14 ( 9.93 ms/it)
        elbo: -6980.5711809416325
   iteration: 1679

Optimizing  54%|████████████████▊              |  ETA: 0:00:14 ( 9.91 ms/it)
        elbo: -6554.938555660249
   iteration: 1693

Optimizing  55%|████████████████▉              |  ETA: 0:00:14 ( 9.94 ms/it)
        elbo: -9012.393583398307
   iteration: 1707

Optimizing  55%|█████████████████              |  ETA: 0:00:14 ( 9.92 ms/it)
        elbo: -7156.7687322894035
   iteration: 1722

Optimizing  55%|█████████████████▎             |  ETA: 0:00:14 ( 9.89 ms/it)
        elbo: -7356.902503427443
   iteration: 1737

Optimizing  56%|█████████████████▍             |  ETA: 0:00:14 ( 9.87 ms/it)
        elbo: -6265.487101910783
   iteration: 1752

Optimizing  56%|█████████████████▌             |  ETA: 0:00:13 ( 9.85 ms/it)
        elbo: -5946.159194505429
   iteration: 1766

Optimizing  57%|█████████████████▋             |  ETA: 0:00:13 ( 9.83 ms/it)
        elbo: -6738.922079411816
   iteration: 1780

Optimizing  57%|█████████████████▊             |  ETA: 0:00:13 ( 9.81 ms/it)
        elbo: -5788.861667972426
   iteration: 1794

Optimizing  58%|█████████████████▉             |  ETA: 0:00:13 ( 9.84 ms/it)
        elbo: -6363.537404787323
   iteration: 1808

Optimizing  58%|██████████████████             |  ETA: 0:00:13 ( 9.82 ms/it)
        elbo: -9530.475060952405
   iteration: 1822

Optimizing  59%|██████████████████▏            |  ETA: 0:00:13 ( 9.80 ms/it)
        elbo: -6454.990424525707
   iteration: 1836

Optimizing  59%|██████████████████▍            |  ETA: 0:00:13 ( 9.78 ms/it)
        elbo: -6258.355835949162
   iteration: 1850

Optimizing  60%|██████████████████▌            |  ETA: 0:00:12 ( 9.76 ms/it)
        elbo: -8333.454131711207
   iteration: 1864

Optimizing  60%|██████████████████▋            |  ETA: 0:00:12 ( 9.74 ms/it)
        elbo: -7788.307204386182
   iteration: 1878

Optimizing  60%|██████████████████▊            |  ETA: 0:00:12 ( 9.72 ms/it)
        elbo: -5907.50130885728
   iteration: 1892

Optimizing  61%|██████████████████▉            |  ETA: 0:00:12 ( 9.75 ms/it)
        elbo: -5939.767171580767
   iteration: 1906

Optimizing  61%|███████████████████            |  ETA: 0:00:12 ( 9.73 ms/it)
        elbo: -6156.141465682273
   iteration: 1921

Optimizing  62%|███████████████████▏           |  ETA: 0:00:12 ( 9.71 ms/it)
        elbo: -6664.653252431781
   iteration: 1936

Optimizing  62%|███████████████████▍           |  ETA: 0:00:11 ( 9.69 ms/it)
        elbo: -5853.031602702779
   iteration: 1951

Optimizing  63%|███████████████████▌           |  ETA: 0:00:11 ( 9.67 ms/it)
        elbo: -6808.2699367920895
   iteration: 1966

Optimizing  63%|███████████████████▋           |  ETA: 0:00:11 ( 9.66 ms/it)
        elbo: -8095.815789078481
   iteration: 1980

Optimizing  64%|███████████████████▊           |  ETA: 0:00:11 ( 9.64 ms/it)
        elbo: -7713.10829067268
   iteration: 1994

Optimizing  64%|███████████████████▉           |  ETA: 0:00:11 ( 9.67 ms/it)
        elbo: -5962.968652406329
   iteration: 2008

Optimizing  65%|████████████████████           |  ETA: 0:00:11 ( 9.65 ms/it)
        elbo: -6145.758901965918
   iteration: 2022

Optimizing  65%|████████████████████▏          |  ETA: 0:00:11 ( 9.63 ms/it)
        elbo: -6366.995371541845
   iteration: 2037

Optimizing  66%|████████████████████▍          |  ETA: 0:00:10 ( 9.62 ms/it)
        elbo: -6305.286744039469
   iteration: 2052

Optimizing  66%|████████████████████▌          |  ETA: 0:00:10 ( 9.60 ms/it)
        elbo: -6059.5274381984245
   iteration: 2066

Optimizing  66%|████████████████████▋          |  ETA: 0:00:10 ( 9.58 ms/it)
        elbo: -5413.879786935728
   iteration: 2080

Optimizing  67%|████████████████████▊          |  ETA: 0:00:10 ( 9.57 ms/it)
        elbo: -6411.269094991376
   iteration: 2095

Optimizing  67%|████████████████████▉          |  ETA: 0:00:10 ( 9.59 ms/it)
        elbo: -5615.283649121149
   iteration: 2108

Optimizing  68%|█████████████████████          |  ETA: 0:00:10 ( 9.58 ms/it)
        elbo: -7070.035043287461
   iteration: 2122

Optimizing  68%|█████████████████████▏         |  ETA: 0:00:10 ( 9.56 ms/it)
        elbo: -6040.334721884317
   iteration: 2136

Optimizing  69%|█████████████████████▎         |  ETA: 0:00:09 ( 9.55 ms/it)
        elbo: -7476.488762554648
   iteration: 2150

Optimizing  69%|█████████████████████▍         |  ETA: 0:00:09 ( 9.54 ms/it)
        elbo: -8222.171949503281
   iteration: 2164

Optimizing  70%|█████████████████████▋         |  ETA: 0:00:09 ( 9.52 ms/it)
        elbo: -5728.920366117948
   iteration: 2178

Optimizing  70%|█████████████████████▊         |  ETA: 0:00:09 ( 9.51 ms/it)
        elbo: -6105.337917617719
   iteration: 2192

Optimizing  70%|█████████████████████▉         |  ETA: 0:00:09 ( 9.53 ms/it)
        elbo: -6817.965374315266
   iteration: 2206

Optimizing  71%|██████████████████████         |  ETA: 0:00:09 ( 9.52 ms/it)
        elbo: -5734.981816098861
   iteration: 2220

Optimizing  71%|██████████████████████▏        |  ETA: 0:00:09 ( 9.51 ms/it)
        elbo: -6266.3016952886055
   iteration: 2234

Optimizing  72%|██████████████████████▎        |  ETA: 0:00:08 ( 9.49 ms/it)
        elbo: -5655.1674572762695
   iteration: 2248

Optimizing  72%|██████████████████████▍        |  ETA: 0:00:08 ( 9.48 ms/it)
        elbo: -6489.409461296304
   iteration: 2262

Optimizing  73%|██████████████████████▌        |  ETA: 0:00:08 ( 9.47 ms/it)
        elbo: -5556.979833579535
   iteration: 2276

Optimizing  73%|██████████████████████▋        |  ETA: 0:00:08 ( 9.46 ms/it)
        elbo: -6585.946408498223
   iteration: 2290

Optimizing  74%|██████████████████████▊        |  ETA: 0:00:08 ( 9.48 ms/it)
        elbo: -6994.2092391706365
   iteration: 2303

Optimizing  74%|███████████████████████        |  ETA: 0:00:08 ( 9.47 ms/it)
        elbo: -7007.106812812758
   iteration: 2317

Optimizing  74%|███████████████████████▏       |  ETA: 0:00:08 ( 9.45 ms/it)
        elbo: -5801.162564228717
   iteration: 2331

Optimizing  75%|███████████████████████▎       |  ETA: 0:00:07 ( 9.44 ms/it)
        elbo: -7191.879241382145
   iteration: 2345

Optimizing  75%|███████████████████████▍       |  ETA: 0:00:07 ( 9.43 ms/it)
        elbo: -5812.281257105624
   iteration: 2359

Optimizing  76%|███████████████████████▌       |  ETA: 0:00:07 ( 9.42 ms/it)
        elbo: -5613.89422129312
   iteration: 2373

Optimizing  76%|███████████████████████▋       |  ETA: 0:00:07 ( 9.40 ms/it)
        elbo: -8466.262076591858
   iteration: 2387

Optimizing  77%|███████████████████████▊       |  ETA: 0:00:07 ( 9.43 ms/it)
   elbo_callback: -5846.85283364924
        accuracy: 0.77
    time_elapsed: 22.760154962539673
            elbo: -5927.468268535564
       iteration: 2401




Optimizing  77%|███████████████████████▉       |  ETA: 0:00:07 ( 9.42 ms/it)
        elbo: -5919.882350610298
   iteration: 2415

Optimizing  78%|████████████████████████       |  ETA: 0:00:07 ( 9.41 ms/it)
        elbo: -5813.4201310499175
   iteration: 2429

Optimizing  78%|████████████████████████▎      |  ETA: 0:00:06 ( 9.39 ms/it)
        elbo: -6178.729120590799
   iteration: 2443

Optimizing  78%|████████████████████████▍      |  ETA: 0:00:06 ( 9.38 ms/it)
        elbo: -6226.2126815864285
   iteration: 2457

Optimizing  79%|████████████████████████▌      |  ETA: 0:00:06 ( 9.37 ms/it)
        elbo: -7153.581808553047
   iteration: 2471

Optimizing  79%|████████████████████████▋      |  ETA: 0:00:06 ( 9.36 ms/it)
        elbo: -6317.7037248018105
   iteration: 2485

Optimizing  80%|████████████████████████▊      |  ETA: 0:00:06 ( 9.35 ms/it)
        elbo: -9469.204338443538
   iteration: 2499

Optimizing  80%|████████████████████████▉      |  ETA: 0:00:06 ( 9.38 ms/it)
        elbo: -5571.368969829568
   iteration: 2511

Optimizing  81%|█████████████████████████      |  ETA: 0:00:06 ( 9.37 ms/it)
        elbo: -5699.302149130822
   iteration: 2525

Optimizing  81%|█████████████████████████▏     |  ETA: 0:00:06 ( 9.36 ms/it)
        elbo: -8430.242338425029
   iteration: 2539

Optimizing  82%|█████████████████████████▎     |  ETA: 0:00:05 ( 9.35 ms/it)
        elbo: -5872.9535059838345
   iteration: 2553

Optimizing  82%|█████████████████████████▍     |  ETA: 0:00:05 ( 9.33 ms/it)
        elbo: -6187.086501806454
   iteration: 2567

Optimizing  82%|█████████████████████████▋     |  ETA: 0:00:05 ( 9.32 ms/it)
        elbo: -5378.695479655384
   iteration: 2581

Optimizing  83%|█████████████████████████▊     |  ETA: 0:00:05 ( 9.31 ms/it)
        elbo: -6254.689011922911
   iteration: 2595

Optimizing  83%|█████████████████████████▉     |  ETA: 0:00:05 ( 9.34 ms/it)
        elbo: -6416.904207867409
   iteration: 2609

Optimizing  84%|██████████████████████████     |  ETA: 0:00:05 ( 9.32 ms/it)
        elbo: -5764.2620934072365
   iteration: 2623

Optimizing  84%|██████████████████████████▏    |  ETA: 0:00:05 ( 9.31 ms/it)
        elbo: -5952.540360000035
   iteration: 2638

Optimizing  85%|██████████████████████████▎    |  ETA: 0:00:04 ( 9.30 ms/it)
        elbo: -5486.661723417325
   iteration: 2652

Optimizing  85%|██████████████████████████▍    |  ETA: 0:00:04 ( 9.29 ms/it)
        elbo: -11121.215368295128
   iteration: 2666

Optimizing  86%|██████████████████████████▌    |  ETA: 0:00:04 ( 9.28 ms/it)
        elbo: -5535.462798836525
   iteration: 2680

Optimizing  86%|██████████████████████████▋    |  ETA: 0:00:04 ( 9.27 ms/it)
        elbo: -5570.102984720432
   iteration: 2694

Optimizing  87%|██████████████████████████▉    |  ETA: 0:00:04 ( 9.29 ms/it)
        elbo: -5924.645155838974
   iteration: 2708

Optimizing  87%|███████████████████████████    |  ETA: 0:00:04 ( 9.28 ms/it)
        elbo: -5626.93877861329
   iteration: 2722

Optimizing  87%|███████████████████████████▏   |  ETA: 0:00:04 ( 9.27 ms/it)
        elbo: -5344.026637577634
   iteration: 2736

Optimizing  88%|███████████████████████████▎   |  ETA: 0:00:04 ( 9.26 ms/it)
        elbo: -5991.581966703403
   iteration: 2750

Optimizing  88%|███████████████████████████▍   |  ETA: 0:00:03 ( 9.25 ms/it)
        elbo: -6491.344578828534
   iteration: 2764

Optimizing  89%|███████████████████████████▌   |  ETA: 0:00:03 ( 9.24 ms/it)
        elbo: -5741.077966118329
   iteration: 2778

Optimizing  89%|███████████████████████████▋   |  ETA: 0:00:03 ( 9.23 ms/it)
        elbo: -6430.014246735748
   iteration: 2792

Optimizing  90%|███████████████████████████▊   |  ETA: 0:00:03 ( 9.25 ms/it)
        elbo: -5591.052348975613
   iteration: 2806

Optimizing  90%|███████████████████████████▉   |  ETA: 0:00:03 ( 9.24 ms/it)
        elbo: -6320.509200710492
   iteration: 2820

Optimizing  91%|████████████████████████████▏  |  ETA: 0:00:03 ( 9.23 ms/it)
        elbo: -9848.105111212868
   iteration: 2834

Optimizing  91%|████████████████████████████▎  |  ETA: 0:00:03 ( 9.22 ms/it)
        elbo: -6023.741969711862
   iteration: 2849

Optimizing  91%|████████████████████████████▍  |  ETA: 0:00:02 ( 9.21 ms/it)
        elbo: -5525.3894997718835
   iteration: 2863

Optimizing  92%|████████████████████████████▌  |  ETA: 0:00:02 ( 9.21 ms/it)
        elbo: -5791.561908185016
   iteration: 2877

Optimizing  92%|████████████████████████████▋  |  ETA: 0:00:02 ( 9.20 ms/it)
        elbo: -5912.490448536379
   iteration: 2891

Optimizing  93%|████████████████████████████▊  |  ETA: 0:00:02 ( 9.22 ms/it)
        elbo: -5732.4504211722
   iteration: 2905

Optimizing  93%|████████████████████████████▉  |  ETA: 0:00:02 ( 9.21 ms/it)
        elbo: -7606.196832765634
   iteration: 2919

Optimizing  94%|█████████████████████████████  |  ETA: 0:00:02 ( 9.20 ms/it)
        elbo: -5189.988463527569
   iteration: 2933

Optimizing  94%|█████████████████████████████▎ |  ETA: 0:00:02 ( 9.19 ms/it)
        elbo: -9033.825013398347
   iteration: 2947

Optimizing  95%|█████████████████████████████▍ |  ETA: 0:00:02 ( 9.18 ms/it)
        elbo: -7591.761115264816
   iteration: 2961

Optimizing  95%|█████████████████████████████▌ |  ETA: 0:00:01 ( 9.17 ms/it)
        elbo: -12872.67593914282
   iteration: 2975

Optimizing  95%|█████████████████████████████▋ |  ETA: 0:00:01 ( 9.16 ms/it)
        elbo: -6436.777673647217
   iteration: 2989

Optimizing  96%|█████████████████████████████▊ |  ETA: 0:00:01 ( 9.18 ms/it)
        elbo: -6747.380837166961
   iteration: 3003

Optimizing  96%|█████████████████████████████▉ |  ETA: 0:00:01 ( 9.17 ms/it)
        elbo: -6198.578410769008
   iteration: 3018

Optimizing  97%|██████████████████████████████ |  ETA: 0:00:01 ( 9.17 ms/it)
        elbo: -5431.8366321462645
   iteration: 3032

Optimizing  97%|██████████████████████████████▏|  ETA: 0:00:01 ( 9.16 ms/it)
        elbo: -6071.972453445291
   iteration: 3046

Optimizing  98%|██████████████████████████████▎|  ETA: 0:00:01 ( 9.15 ms/it)
        elbo: -6867.244609251675
   iteration: 3060

Optimizing  98%|██████████████████████████████▌|  ETA: 0:00:01 ( 9.14 ms/it)
        elbo: -5289.733121725727
   iteration: 3074

Optimizing  99%|██████████████████████████████▋|  ETA: 0:00:00 ( 9.14 ms/it)
        elbo: -5567.332530598885
   iteration: 3088

Optimizing  99%|██████████████████████████████▊|  ETA: 0:00:00 ( 9.16 ms/it)
   elbo_callback: -5595.185746835621
        accuracy: 0.8038
    time_elapsed: 28.520591974258423
            elbo: -7143.282033235757
       iteration: 3101




Optimizing  99%|██████████████████████████████▉|  ETA: 0:00:00 ( 9.15 ms/it)
        elbo: -5368.543740080022
   iteration: 3115

Optimizing  99%|███████████████████████████████|  ETA: 0:00:00 ( 9.14 ms/it)
        elbo: -5583.92238522083
   iteration: 3129

Optimizing 100%|███████████████████████████████| Time: 0:00:28 ( 9.14 ms/it)
        elbo: -5433.413912963447
   iteration: 3130
Optimizing   0%|                               |  ETA: 0:17:03 ( 0.33  s/it)
       epoch: 1
        step: 2
        elbo: -8538.457484739396
   iteration: 2



Optimizing   6%|█▊                             |  ETA: 0:00:14 ( 4.71 ms/it)
       epoch: 1
        step: 180
        elbo: -8877.888325983973
   iteration: 180



Optimizing   9%|██▊                            |  ETA: 0:00:10 ( 3.61 ms/it)
       epoch: 1
        step: 273
        elbo: -5550.84736041654
   iteration: 273



Optimizing  11%|███▌                           |  ETA: 0:00:09 ( 3.27 ms/it)
       epoch: 2
        step: 40
        elbo: -7823.242048767374
   iteration: 353



Optimizing  18%|█████▋                         |  ETA: 0:00:06 ( 2.53 ms/it)
       epoch: 2
        step: 253
        elbo: -6130.823090739345
   iteration: 566



Optimizing  21%|██████▍                        |  ETA: 0:00:06 ( 2.41 ms/it)
       epoch: 3
        step: 18
        elbo: -6982.5998938474495
   iteration: 644



Optimizing  23%|███████                        |  ETA: 0:00:06 ( 2.35 ms/it)
       epoch: 3
        step: 83
        elbo: -6987.630461466666
   iteration: 709



Optimizing  28%|████████▉                      |  ETA: 0:00:05 ( 2.06 ms/it)
       epoch: 3
        step: 266
        elbo: -5754.182685241461
   iteration: 892



Optimizing  32%|█████████▉                     |  ETA: 0:00:04 ( 1.98 ms/it)
       epoch: 4
        step: 59
        elbo: -5143.63228879822
   iteration: 998



Optimizing  34%|██████████▋                    |  ETA: 0:00:04 ( 1.95 ms/it)
       epoch: 4
        step: 137
        elbo: -6072.848856679967
   iteration: 1076



Optimizing  36%|███████████▎                   |  ETA: 0:00:04 ( 1.93 ms/it)
       epoch: 4
        step: 203
        elbo: -7942.103697991719
   iteration: 1142



Optimizing  43%|█████████████▍                 |  ETA: 0:00:03 ( 1.83 ms/it)
       epoch: 5
        step: 101
        elbo: -6436.106419088009
   iteration: 1353



Optimizing  46%|██████████████▎                |  ETA: 0:00:03 ( 1.81 ms/it)
       epoch: 5
        step: 181
        elbo: -6741.943021329731
   iteration: 1433



Optimizing  52%|████████████████               |  ETA: 0:00:03 ( 1.76 ms/it)
       epoch: 6
        step: 54
        elbo: -7260.888580882386
   iteration: 1619



Optimizing  59%|██████████████████▏            |  ETA: 0:00:02 ( 1.70 ms/it)
       epoch: 6
        step: 267
        elbo: -6443.273442087893
   iteration: 1832



Optimizing  61%|███████████████████            |  ETA: 0:00:02 ( 1.69 ms/it)
       epoch: 7
        step: 35
        elbo: -8566.670541215533
   iteration: 1913



Optimizing  67%|████████████████████▊          |  ETA: 0:00:02 ( 1.62 ms/it)
       epoch: 7
        step: 222
        elbo: -6492.80122612995
   iteration: 2100



Optimizing  71%|█████████████████████▉         |  ETA: 0:00:02 ( 1.64 ms/it)
       epoch: 8
        step: 16
        elbo: -6379.3703474559725
   iteration: 2207



Optimizing  77%|████████████████████████       |  ETA: 0:00:01 ( 1.61 ms/it)
       epoch: 8
        step: 228
        elbo: -5491.197610038995
   iteration: 2419



Optimizing  84%|██████████████████████████     |  ETA: 0:00:01 ( 1.58 ms/it)
       epoch: 9
        step: 125
        elbo: -6801.813195093232
   iteration: 2629



Optimizing  87%|██████████████████████████▉    |  ETA: 0:00:01 ( 1.58 ms/it)
       epoch: 9
        step: 205
        elbo: -5839.886162645224
   iteration: 2709



Optimizing  92%|████████████████████████████▋  |  ETA: 0:00:00 ( 1.54 ms/it)
       epoch: 10
        step: 76
        elbo: -6339.778973949834
   iteration: 2893



Optimizing  96%|█████████████████████████████▊ |  ETA: 0:00:00 ( 1.53 ms/it)
       epoch: 10
        step: 182
        elbo: -5452.245792114578
   iteration: 2999



Optimizing  98%|██████████████████████████████▌|  ETA: 0:00:00 ( 1.53 ms/it)
       epoch: 10
        step: 263
        elbo: -7485.001265469417
   iteration: 3080



Optimizing 100%|███████████████████████████████| Time: 0:00:04 ( 1.54 ms/it)
       epoch: 10
        step: 313
        elbo: -5001.755458201043
   iteration: 3130</code></pre><p>Let&#39;s visualize the evolution of the ELBO.</p><pre><code class="language-julia hljs">using Plots

t = 1:logging_interval:max_iter
plot(
    [i.iteration for i in info_full[t]],
    [i.elbo_callback for i in info_full[t]];
    xlabel=&quot;Iteration&quot;,
    ylabel=&quot;ELBO&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.iteration for i in info_sub[t]],
    [i.elbo_callback for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_iteration_elbo.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_iteration_elbo.svg" alt/></p><p>According to this plot, it might seem like subsampling has no benefit (if not detrimental). This is, however, because we are plotting against the number of iterations. Subsampling generally converges slower (asymptotically) in terms of iterations. But in return, it reduces the time spent at each iteration. Therefore, we need to plot against the elapsed time:</p><pre><code class="language-julia hljs">plot(
    [i.time_elapsed for i in info_full[t]],
    [i.elbo_callback for i in info_full[t]];
    xlabel=&quot;Wallclock Time (sec)&quot;,
    ylabel=&quot;ELBO&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.time_elapsed for i in info_sub[t]],
    [i.elbo_callback for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_time_elbo.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_time_elbo.svg" alt/></p><p>We can now see the dramatic effect of subsampling. The picture is similar if we visualize the prediction accuracy over time.</p><pre><code class="language-julia hljs">plot(
    [i.time_elapsed for i in info_full[t]],
    [i.accuracy for i in info_full[t]];
    xlabel=&quot;Wallclock Time (sec)&quot;,
    ylabel=&quot;Prediction Accuracy&quot;,
    label=&quot;Full Batch&quot;,
)
plot!(
    [i.time_elapsed for i in info_sub[t]],
    [i.accuracy for i in info_sub[t]];
    label=&quot;Subsampling&quot;,
)
savefig(&quot;subsampling_example_time_accuracy.svg&quot;)
nothing</code></pre><p><img src="../subsampling_example_time_accuracy.svg" alt/></p><p>But remember that subsampling will always be <em>asymptotically</em> slower than no subsampling. That is, as the number of iterations increase, there will be a point where no subsampling will overtake subsampling even in terms of wallclock time. Therefore, subsampling is most beneficial when a crude solution to the VI problem suffices.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-HBB2010"><a class="tag is-link" href="#citeref-HBB2010">HBB2010</a>Hoffman, M., Bach, F., &amp; Blei, D. (2010). Online learning for latent Dirichlet allocation. In <em>Advances in Neural Information Processing Systems</em>, 23.</li><li class="footnote" id="footnote-HBWP2013"><a class="tag is-link" href="#citeref-HBWP2013">HBWP2013</a>Hoffman, M. D., Blei, D. M., Wang, C., &amp; Paisley, J. (2013). Stochastic variational inference. <em>Journal of Machine Learning Research</em>, 14(1), 1303-1347.</li><li class="footnote" id="footnote-TL2014"><a class="tag is-link" href="#citeref-TL2014">TL2014</a>Titsias, M., &amp; Lázaro-Gredilla, M. (2014, June). Doubly stochastic variational Bayes for non-conjugate inference. In <em>Proceedings of the International Conference on Machine Learning</em> (pp. 1971-1979). PMLR.</li><li class="footnote" id="footnote-KTRGB2017"><a class="tag is-link" href="#citeref-KTRGB2017">KTRGB2017</a>Kucukelbir, A., Tran, D., Ranganath, R., Gelman, A., &amp; Blei, D. M. (2017). Automatic differentiation variational inference. <em>Journal of Machine Learning Research</em>, 18(14), 1-45.</li><li class="footnote" id="footnote-Tan2018"><a class="tag is-link" href="#citeref-Tan2018">Tan2018</a>Tan, Choon Lin (2018), &quot;Phishing Dataset for Machine Learning: Feature Evaluation&quot;, Mendeley Data, V1, doi: 10.17632/h3cgnj8hft.1]</li><li class="footnote" id="footnote-MKR2020"><a class="tag is-link" href="#citeref-MKR2020">MKR2020</a>Mishchenko, K., Khaled, A., &amp; Richtárik, P. (2020). Random reshuffling: Simple analysis with vast improvements. Advances in Neural Information Processing Systems, 33, 17309-17320.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basic/">« Basic Example</a><a class="docs-footer-nextpage" href="../stan/">Stan Models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 26 November 2025 12:18">Wednesday 26 November 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
